<!DOCTYPE html>
<html><head><meta charset="utf-8" content="text/html" http-equiv="Content-Type" /><meta content="Save your fork, there's cake!" name="description" /><style type="text/css">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
.syntaxhighlighter a,
.syntaxhighlighter div,
.syntaxhighlighter code,
.syntaxhighlighter table,
.syntaxhighlighter table td,
.syntaxhighlighter table tr,
.syntaxhighlighter table tbody,
.syntaxhighlighter table thead,
.syntaxhighlighter table caption,
.syntaxhighlighter textarea {
  -moz-border-radius: 0 0 0 0 !important;
  -webkit-border-radius: 0 0 0 0 !important;
  background: none !important;
  border: 0 !important;
  bottom: auto !important;
  float: none !important;
  height: auto !important;
  left: auto !important;
  line-height: 1.1em !important;
  margin: 0 !important;
  outline: 0 !important;
  overflow: visible !important;
  padding: 0 !important;
  position: static !important;
  right: auto !important;
  text-align: left !important;
  top: auto !important;
  vertical-align: baseline !important;
  width: auto !important;
  box-sizing: content-box !important;
  font-family: "Consolas", "Bitstream Vera Sans Mono", "Courier New", Courier, monospace !important;
  font-weight: normal !important;
  font-style: normal !important;
  min-height: inherit !important;
  min-height: auto !important;
}

.syntaxhighlighter {
/*  width: 100% !important; */
  margin: 1em 0 1em 0 !important;
  position: relative !important;
  overflow: auto !important;
}
.syntaxhighlighter.source {
  overflow: hidden !important;
}
.syntaxhighlighter .bold {
  font-weight: bold !important;
}
.syntaxhighlighter .italic {
  font-style: italic !important;
}
.syntaxhighlighter .line {
  white-space: pre !important;
}
.syntaxhighlighter table {
/*    width: 100% !important;*/
}
.syntaxhighlighter table caption {
  text-align: left !important;
  padding: .5em 0 0.5em 1em !important;
}
.syntaxhighlighter table td.code {
  width: 100% !important;
}
.syntaxhighlighter table td.code .container {
  position: relative !important;
}
.syntaxhighlighter table td.code .container textarea {
  box-sizing: border-box !important;
  position: absolute !important;
  left: 0 !important;
  top: 0 !important;
  width: 100% !important;
  height: 100% !important;
  border: none !important;
  background: white !important;
  padding-left: 1em !important;
  overflow: hidden !important;
  white-space: pre !important;
}
.syntaxhighlighter table td.gutter .line {
  text-align: right !important;
  padding: 0 0.5em 0 1em !important;
}
.syntaxhighlighter table td.code .line {
  padding: 0 1em !important;
}
.syntaxhighlighter.nogutter td.code .container textarea, .syntaxhighlighter.nogutter td.code .line {
  padding-left: 0em !important;
}
.syntaxhighlighter.show {
  display: block !important;
}
.syntaxhighlighter.collapsed table {
  display: none !important;
}
.syntaxhighlighter.collapsed .toolbar {
    display: none;
/*  padding: 0.1em 0.8em 0em 0.8em !important;
  font-size: 1em !important;
  position: static !important;
  width: auto !important;
  height: auto !important;*/
}
.syntaxhighlighter.collapsed .toolbar span {
  display: inline !important;
  margin-right: 1em !important;
}
.syntaxhighlighter.collapsed .toolbar span a {
  padding: 0 !important;
  display: none !important;
}
.syntaxhighlighter.collapsed .toolbar span a.expandSource {
  display: inline !important;
}
.syntaxhighlighter .toolbar {
    display: none;
/*  position: absolute !important;
  right: 1px !important;
  top: 1px !important;
  width: 11px !important;
  height: 11px !important;
  font-size: 10px !important;
  z-index: 10 !important;*/
}
.syntaxhighlighter .toolbar span.title {
  display: inline !important;
}
.syntaxhighlighter .toolbar a {
  display: block !important;
  text-align: center !important;
  text-decoration: none !important;
  padding-top: 1px !important;
}
.syntaxhighlighter .toolbar a.expandSource {
  display: none !important;
}
.syntaxhighlighter.ie {
  font-size: .9em !important;
  padding: 1px 0 1px 0 !important;
}
.syntaxhighlighter.ie .toolbar {
  line-height: 8px !important;
}
.syntaxhighlighter.ie .toolbar a {
  padding-top: 0px !important;
}
.syntaxhighlighter.printing .line.alt1 .content,
.syntaxhighlighter.printing .line.alt2 .content,
.syntaxhighlighter.printing .line.highlighted .number,
.syntaxhighlighter.printing .line.highlighted.alt1 .content,
.syntaxhighlighter.printing .line.highlighted.alt2 .content {
  background: none !important;
}
.syntaxhighlighter.printing .line .number {
  color: #bbbbbb !important;
}
.syntaxhighlighter.printing .line .content {
  color: black !important;
}
.syntaxhighlighter.printing .toolbar {
  display: none !important;
}
.syntaxhighlighter.printing a {
  text-decoration: none !important;
}
.syntaxhighlighter.printing .plain, .syntaxhighlighter.printing .plain a {
  color: black !important;
}
.syntaxhighlighter.printing .comments, .syntaxhighlighter.printing .comments a {
  color: #008200 !important;
}
.syntaxhighlighter.printing .string, .syntaxhighlighter.printing .string a {
  color: blue !important;
}
.syntaxhighlighter.printing .keyword {
  color: #006699 !important;
  font-weight: bold !important;
}
.syntaxhighlighter.printing .preprocessor {
  color: gray !important;
}
.syntaxhighlighter.printing .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter.printing .value {
  color: #009900 !important;
}
.syntaxhighlighter.printing .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter.printing .constants {
  color: #0066cc !important;
}
.syntaxhighlighter.printing .script {
  font-weight: bold !important;
}
.syntaxhighlighter.printing .color1, .syntaxhighlighter.printing .color1 a {
  color: gray !important;
}
.syntaxhighlighter.printing .color2, .syntaxhighlighter.printing .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter.printing .color3, .syntaxhighlighter.printing .color3 a {
  color: red !important;
}
.syntaxhighlighter.printing .break, .syntaxhighlighter.printing .break a {
  color: black !important;
}
</style><style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style><style type="text/css">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
.syntaxhighlighter {
  background-color: transparent !important;
}
.syntaxhighlighter .line.alt1 {
  background-color: transparent !important;
}
.syntaxhighlighter .line.alt2 {
  background-color: transparent !important;
}
.syntaxhighlighter .line.highlighted.alt1, .syntaxhighlighter .line.highlighted.alt2 {
  background-color: #c3defe !important;
}
.syntaxhighlighter .line.highlighted.number {
  color: white !important;
}
.syntaxhighlighter table caption {
  color: black !important;
}
.syntaxhighlighter .gutter {
  color: #787878 !important;
}
.syntaxhighlighter .gutter .line {
  border-right: 3px solid #d4d0c8 !important;
}
.syntaxhighlighter .gutter .line.highlighted {
  background-color: #d4d0c8 !important;
  color: white !important;
}
.syntaxhighlighter.printing .line .content {
  border: none !important;
}
.syntaxhighlighter.collapsed {
  overflow: visible !important;
}
.syntaxhighlighter.collapsed .toolbar {
  color: #3f5fbf !important;
  background: white !important;
  border: 1px solid #d4d0c8 !important;
}
.syntaxhighlighter.collapsed .toolbar a {
  color: #3f5fbf !important;
}
.syntaxhighlighter.collapsed .toolbar a:hover {
  color: #aa7700 !important;
}
.syntaxhighlighter .toolbar {
  color: #a0a0a0 !important;
  background: #d4d0c8 !important;
  border: none !important;
}
.syntaxhighlighter .toolbar a {
  color: #a0a0a0 !important;
}
.syntaxhighlighter .toolbar a:hover {
  color: red !important;
}
.syntaxhighlighter .plain, .syntaxhighlighter .plain a {
  color: black !important;
}
.syntaxhighlighter .comments, .syntaxhighlighter .comments a {
  color: #3f5fbf !important;
}
.syntaxhighlighter .string, .syntaxhighlighter .string a {
  color: #2a00ff !important;
}
.syntaxhighlighter .keyword {
  color: #7f0055 !important;
}
.syntaxhighlighter .preprocessor {
  color: #646464 !important;
}
.syntaxhighlighter .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter .value {
  color: #009900 !important;
}
.syntaxhighlighter .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter .constants {
  color: #0066cc !important;
}
.syntaxhighlighter .script {
  font-weight: bold !important;
  color: #7f0055 !important;
  background-color: none !important;
}
.syntaxhighlighter .color1, .syntaxhighlighter .color1 a {
  color: gray !important;
}
.syntaxhighlighter .color2, .syntaxhighlighter .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter .color3, .syntaxhighlighter .color3 a {
  color: red !important;
}

.syntaxhighlighter .keyword {
  font-weight: bold !important;
}
.syntaxhighlighter .xml .keyword {
  color: #3f7f7f !important;
  font-weight: normal !important;
}
.syntaxhighlighter .xml .color1, .syntaxhighlighter .xml .color1 a {
  color: #7f007f !important;
}
.syntaxhighlighter .xml .string {
  font-style: italic !important;
  color: #2a00ff !important;
}
</style><style type="text/css">html{margin:0;padding:0;}h1{margin:0;padding:0;}h2{margin:0;padding:0;}h3{margin:0;padding:0;}h4{margin:0;padding:0;}a{color:#261A3B;}a:visited{color:#261A3B;}</style><style type="text/css">.header{margin-top:30px;}h1.project-name{font-size:34px;display:inline;}h2.project-version{font-size:18px;margin-top:0;display:inline;margin-left:10px;}.toc-link{font-size:12px;margin-left:10px;color:#252519;text-decoration:none;}.toc-link:hover{color:#5050A6;}.toc h1{font-size:34px;margin:0;}.docs-header{border-bottom:dotted #aaa 1px;padding-bottom:10px;margin-bottom:25px;}.toc h1{font-size:24px;}.toc{border-bottom:solid #bbb 1px;margin-bottom:40px;}.toc ul{margin-left:20px;padding-left:0px;padding-top:0;margin-top:0;}.toc li{list-style-type:none;padding-left:0;}.dependencies{}.dependencies table{font-size:16px;width:99.99%;border:none;margin-left:20px;}.dependencies td{padding-right:20px;;white-space:nowrap;}.dependencies .dotted{width:99%;}.dependencies .dotted hr{margin-bottom:-6px;noshade:noshade;border-top:none;color:transparent;border-left:none;border-bottom:dotted #bbb 1px;border-right:none;background-color:transparent;height:0;}.dependencies .dep-version{text-align:right;}.plugins ul{margin-left:20px;padding-left:0px;padding-top:0;margin-top:0;}.plugins li{list-style-type:none;padding-left:0;}.header p{margin-left:20px;}</style><style type="text/css">#floating-toc{position:fixed;top:10px;right:20px;height:20px;overflow:hidden;text-align:right;}#floating-toc li{list-style-type:none;margin:0;padding:0;}</style><style type="text/css">body{margin:0;padding:0;font-family:'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;;font-size:16px;color:#252519;}h1{font-size:20px;margin-top:0;}a.anchor{text-decoration:none;color:#252519;}a.anchor:hover{color:#5050A6;}table{border-spacing:0;border-bottom:solid #ddd 1px;;margin-bottom:10px;}code{display:inline;}p{margin-top:8px;}tr{margin:0px;padding:0px;}td.docs{width:410px;max-width:410px;vertical-align:top;margin:0px;padding-left:55px;padding-right:20px;border:none;}td.docs pre{font-size:12px;overflow:hidden;}td.codes{border:none;margin:0px;padding-left:20px;width:55%;border-left:solid #E5E5EE 1px;font-size:10pt;vertical-align:top;overflow:hidden;background-color:#F5F5FF;}td.spacer{padding-bottom:40px;}pre code{display:block;padding:4px;}code{background-color:ghostWhite;border:solid #DEDEDE 1px;padding-left:3px;padding-right:3px;font-size:14px;}.syntaxhighlighter code{font-size:13px;}.footer{text-align:center;}</style><script type="text/javascript">/*!
 * jQuery JavaScript Library v1.4.4
 * http://jquery.com/
 *
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2010, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Thu Nov 11 19:04:53 2010 -0500
 */
(function(E,B){function ka(a,b,d){if(d===B&&a.nodeType===1){d=a.getAttribute("data-"+b);if(typeof d==="string"){try{d=d==="true"?true:d==="false"?false:d==="null"?null:!c.isNaN(d)?parseFloat(d):Ja.test(d)?c.parseJSON(d):d}catch(e){}c.data(a,b,d)}else d=B}return d}function U(){return false}function ca(){return true}function la(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function Ka(a){var b,d,e,f,h,l,k,o,x,r,A,C=[];f=[];h=c.data(this,this.nodeType?"events":"__events__");if(typeof h==="function")h=
h.events;if(!(a.liveFired===this||!h||!h.live||a.button&&a.type==="click")){if(a.namespace)A=RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)");a.liveFired=this;var J=h.live.slice(0);for(k=0;k<J.length;k++){h=J[k];h.origType.replace(X,"")===a.type?f.push(h.selector):J.splice(k--,1)}f=c(a.target).closest(f,a.currentTarget);o=0;for(x=f.length;o<x;o++){r=f[o];for(k=0;k<J.length;k++){h=J[k];if(r.selector===h.selector&&(!A||A.test(h.namespace))){l=r.elem;e=null;if(h.preType==="mouseenter"||
h.preType==="mouseleave"){a.type=h.preType;e=c(a.relatedTarget).closest(h.selector)[0]}if(!e||e!==l)C.push({elem:l,handleObj:h,level:r.level})}}}o=0;for(x=C.length;o<x;o++){f=C[o];if(d&&f.level>d)break;a.currentTarget=f.elem;a.data=f.handleObj.data;a.handleObj=f.handleObj;A=f.handleObj.origHandler.apply(f.elem,arguments);if(A===false||a.isPropagationStopped()){d=f.level;if(A===false)b=false;if(a.isImmediatePropagationStopped())break}}return b}}function Y(a,b){return(a&&a!=="*"?a+".":"")+b.replace(La,
"`").replace(Ma,"&")}function ma(a,b,d){if(c.isFunction(b))return c.grep(a,function(f,h){return!!b.call(f,h,f)===d});else if(b.nodeType)return c.grep(a,function(f){return f===b===d});else if(typeof b==="string"){var e=c.grep(a,function(f){return f.nodeType===1});if(Na.test(b))return c.filter(b,e,!d);else b=c.filter(b,e)}return c.grep(a,function(f){return c.inArray(f,b)>=0===d})}function na(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var e=c.data(a[d++]),f=c.data(this,
e);if(e=e&&e.events){delete f.handle;f.events={};for(var h in e)for(var l in e[h])c.event.add(this,h,e[h][l],e[h][l].data)}}})}function Oa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:"script"}):c.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function oa(a,b,d){var e=b==="width"?a.offsetWidth:a.offsetHeight;if(d==="border")return e;c.each(b==="width"?Pa:Qa,function(){d||(e-=parseFloat(c.css(a,"padding"+this))||0);if(d==="margin")e+=parseFloat(c.css(a,
"margin"+this))||0;else e-=parseFloat(c.css(a,"border"+this+"Width"))||0});return e}function da(a,b,d,e){if(c.isArray(b)&&b.length)c.each(b,function(f,h){d||Ra.test(a)?e(a,h):da(a+"["+(typeof h==="object"||c.isArray(h)?f:"")+"]",h,d,e)});else if(!d&&b!=null&&typeof b==="object")c.isEmptyObject(b)?e(a,""):c.each(b,function(f,h){da(a+"["+f+"]",h,d,e)});else e(a,b)}function S(a,b){var d={};c.each(pa.concat.apply([],pa.slice(0,b)),function(){d[this]=a});return d}function qa(a){if(!ea[a]){var b=c("<"+
a+">").appendTo("body"),d=b.css("display");b.remove();if(d==="none"||d==="")d="block";ea[a]=d}return ea[a]}function fa(a){return c.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var t=E.document,c=function(){function a(){if(!b.isReady){try{t.documentElement.doScroll("left")}catch(j){setTimeout(a,1);return}b.ready()}}var b=function(j,s){return new b.fn.init(j,s)},d=E.jQuery,e=E.$,f,h=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/,l=/\S/,k=/^\s+/,o=/\s+$/,x=/\W/,r=/\d/,A=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,
C=/^[\],:{}\s]*$/,J=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,w=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,I=/(?:^|:|,)(?:\s*\[)+/g,L=/(webkit)[ \/]([\w.]+)/,g=/(opera)(?:.*version)?[ \/]([\w.]+)/,i=/(msie) ([\w.]+)/,n=/(mozilla)(?:.*? rv:([\w.]+))?/,m=navigator.userAgent,p=false,q=[],u,y=Object.prototype.toString,F=Object.prototype.hasOwnProperty,M=Array.prototype.push,N=Array.prototype.slice,O=String.prototype.trim,D=Array.prototype.indexOf,R={};b.fn=b.prototype={init:function(j,
s){var v,z,H;if(!j)return this;if(j.nodeType){this.context=this[0]=j;this.length=1;return this}if(j==="body"&&!s&&t.body){this.context=t;this[0]=t.body;this.selector="body";this.length=1;return this}if(typeof j==="string")if((v=h.exec(j))&&(v[1]||!s))if(v[1]){H=s?s.ownerDocument||s:t;if(z=A.exec(j))if(b.isPlainObject(s)){j=[t.createElement(z[1])];b.fn.attr.call(j,s,true)}else j=[H.createElement(z[1])];else{z=b.buildFragment([v[1]],[H]);j=(z.cacheable?z.fragment.cloneNode(true):z.fragment).childNodes}return b.merge(this,
j)}else{if((z=t.getElementById(v[2]))&&z.parentNode){if(z.id!==v[2])return f.find(j);this.length=1;this[0]=z}this.context=t;this.selector=j;return this}else if(!s&&!x.test(j)){this.selector=j;this.context=t;j=t.getElementsByTagName(j);return b.merge(this,j)}else return!s||s.jquery?(s||f).find(j):b(s).find(j);else if(b.isFunction(j))return f.ready(j);if(j.selector!==B){this.selector=j.selector;this.context=j.context}return b.makeArray(j,this)},selector:"",jquery:"1.4.4",length:0,size:function(){return this.length},
toArray:function(){return N.call(this,0)},get:function(j){return j==null?this.toArray():j<0?this.slice(j)[0]:this[j]},pushStack:function(j,s,v){var z=b();b.isArray(j)?M.apply(z,j):b.merge(z,j);z.prevObject=this;z.context=this.context;if(s==="find")z.selector=this.selector+(this.selector?" ":"")+v;else if(s)z.selector=this.selector+"."+s+"("+v+")";return z},each:function(j,s){return b.each(this,j,s)},ready:function(j){b.bindReady();if(b.isReady)j.call(t,b);else q&&q.push(j);return this},eq:function(j){return j===
-1?this.slice(j):this.slice(j,+j+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(N.apply(this,arguments),"slice",N.call(arguments).join(","))},map:function(j){return this.pushStack(b.map(this,function(s,v){return j.call(s,v,s)}))},end:function(){return this.prevObject||b(null)},push:M,sort:[].sort,splice:[].splice};b.fn.init.prototype=b.fn;b.extend=b.fn.extend=function(){var j,s,v,z,H,G=arguments[0]||{},K=1,Q=arguments.length,ga=false;
if(typeof G==="boolean"){ga=G;G=arguments[1]||{};K=2}if(typeof G!=="object"&&!b.isFunction(G))G={};if(Q===K){G=this;--K}for(;K<Q;K++)if((j=arguments[K])!=null)for(s in j){v=G[s];z=j[s];if(G!==z)if(ga&&z&&(b.isPlainObject(z)||(H=b.isArray(z)))){if(H){H=false;v=v&&b.isArray(v)?v:[]}else v=v&&b.isPlainObject(v)?v:{};G[s]=b.extend(ga,v,z)}else if(z!==B)G[s]=z}return G};b.extend({noConflict:function(j){E.$=e;if(j)E.jQuery=d;return b},isReady:false,readyWait:1,ready:function(j){j===true&&b.readyWait--;
if(!b.readyWait||j!==true&&!b.isReady){if(!t.body)return setTimeout(b.ready,1);b.isReady=true;if(!(j!==true&&--b.readyWait>0))if(q){var s=0,v=q;for(q=null;j=v[s++];)j.call(t,b);b.fn.trigger&&b(t).trigger("ready").unbind("ready")}}},bindReady:function(){if(!p){p=true;if(t.readyState==="complete")return setTimeout(b.ready,1);if(t.addEventListener){t.addEventListener("DOMContentLoaded",u,false);E.addEventListener("load",b.ready,false)}else if(t.attachEvent){t.attachEvent("onreadystatechange",u);E.attachEvent("onload",
b.ready);var j=false;try{j=E.frameElement==null}catch(s){}t.documentElement.doScroll&&j&&a()}}},isFunction:function(j){return b.type(j)==="function"},isArray:Array.isArray||function(j){return b.type(j)==="array"},isWindow:function(j){return j&&typeof j==="object"&&"setInterval"in j},isNaN:function(j){return j==null||!r.test(j)||isNaN(j)},type:function(j){return j==null?String(j):R[y.call(j)]||"object"},isPlainObject:function(j){if(!j||b.type(j)!=="object"||j.nodeType||b.isWindow(j))return false;if(j.constructor&&
!F.call(j,"constructor")&&!F.call(j.constructor.prototype,"isPrototypeOf"))return false;for(var s in j);return s===B||F.call(j,s)},isEmptyObject:function(j){for(var s in j)return false;return true},error:function(j){throw j;},parseJSON:function(j){if(typeof j!=="string"||!j)return null;j=b.trim(j);if(C.test(j.replace(J,"@").replace(w,"]").replace(I,"")))return E.JSON&&E.JSON.parse?E.JSON.parse(j):(new Function("return "+j))();else b.error("Invalid JSON: "+j)},noop:function(){},globalEval:function(j){if(j&&
l.test(j)){var s=t.getElementsByTagName("head")[0]||t.documentElement,v=t.createElement("script");v.type="text/javascript";if(b.support.scriptEval)v.appendChild(t.createTextNode(j));else v.text=j;s.insertBefore(v,s.firstChild);s.removeChild(v)}},nodeName:function(j,s){return j.nodeName&&j.nodeName.toUpperCase()===s.toUpperCase()},each:function(j,s,v){var z,H=0,G=j.length,K=G===B||b.isFunction(j);if(v)if(K)for(z in j){if(s.apply(j[z],v)===false)break}else for(;H<G;){if(s.apply(j[H++],v)===false)break}else if(K)for(z in j){if(s.call(j[z],
z,j[z])===false)break}else for(v=j[0];H<G&&s.call(v,H,v)!==false;v=j[++H]);return j},trim:O?function(j){return j==null?"":O.call(j)}:function(j){return j==null?"":j.toString().replace(k,"").replace(o,"")},makeArray:function(j,s){var v=s||[];if(j!=null){var z=b.type(j);j.length==null||z==="string"||z==="function"||z==="regexp"||b.isWindow(j)?M.call(v,j):b.merge(v,j)}return v},inArray:function(j,s){if(s.indexOf)return s.indexOf(j);for(var v=0,z=s.length;v<z;v++)if(s[v]===j)return v;return-1},merge:function(j,
s){var v=j.length,z=0;if(typeof s.length==="number")for(var H=s.length;z<H;z++)j[v++]=s[z];else for(;s[z]!==B;)j[v++]=s[z++];j.length=v;return j},grep:function(j,s,v){var z=[],H;v=!!v;for(var G=0,K=j.length;G<K;G++){H=!!s(j[G],G);v!==H&&z.push(j[G])}return z},map:function(j,s,v){for(var z=[],H,G=0,K=j.length;G<K;G++){H=s(j[G],G,v);if(H!=null)z[z.length]=H}return z.concat.apply([],z)},guid:1,proxy:function(j,s,v){if(arguments.length===2)if(typeof s==="string"){v=j;j=v[s];s=B}else if(s&&!b.isFunction(s)){v=
s;s=B}if(!s&&j)s=function(){return j.apply(v||this,arguments)};if(j)s.guid=j.guid=j.guid||s.guid||b.guid++;return s},access:function(j,s,v,z,H,G){var K=j.length;if(typeof s==="object"){for(var Q in s)b.access(j,Q,s[Q],z,H,v);return j}if(v!==B){z=!G&&z&&b.isFunction(v);for(Q=0;Q<K;Q++)H(j[Q],s,z?v.call(j[Q],Q,H(j[Q],s)):v,G);return j}return K?H(j[0],s):B},now:function(){return(new Date).getTime()},uaMatch:function(j){j=j.toLowerCase();j=L.exec(j)||g.exec(j)||i.exec(j)||j.indexOf("compatible")<0&&n.exec(j)||
[];return{browser:j[1]||"",version:j[2]||"0"}},browser:{}});b.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(j,s){R["[object "+s+"]"]=s.toLowerCase()});m=b.uaMatch(m);if(m.browser){b.browser[m.browser]=true;b.browser.version=m.version}if(b.browser.webkit)b.browser.safari=true;if(D)b.inArray=function(j,s){return D.call(s,j)};if(!/\s/.test("\u00a0")){k=/^[\s\xA0]+/;o=/[\s\xA0]+$/}f=b(t);if(t.addEventListener)u=function(){t.removeEventListener("DOMContentLoaded",u,
false);b.ready()};else if(t.attachEvent)u=function(){if(t.readyState==="complete"){t.detachEvent("onreadystatechange",u);b.ready()}};return E.jQuery=E.$=b}();(function(){c.support={};var a=t.documentElement,b=t.createElement("script"),d=t.createElement("div"),e="script"+c.now();d.style.display="none";d.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var f=d.getElementsByTagName("*"),h=d.getElementsByTagName("a")[0],l=t.createElement("select"),
k=l.appendChild(t.createElement("option"));if(!(!f||!f.length||!h)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/red/.test(h.getAttribute("style")),hrefNormalized:h.getAttribute("href")==="/a",opacity:/^0.55$/.test(h.style.opacity),cssFloat:!!h.style.cssFloat,checkOn:d.getElementsByTagName("input")[0].value==="on",optSelected:k.selected,deleteExpando:true,optDisabled:false,checkClone:false,
scriptEval:false,noCloneEvent:true,boxModel:null,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableHiddenOffsets:true};l.disabled=true;c.support.optDisabled=!k.disabled;b.type="text/javascript";try{b.appendChild(t.createTextNode("window."+e+"=1;"))}catch(o){}a.insertBefore(b,a.firstChild);if(E[e]){c.support.scriptEval=true;delete E[e]}try{delete b.test}catch(x){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent("onclick",function r(){c.support.noCloneEvent=
false;d.detachEvent("onclick",r)});d.cloneNode(true).fireEvent("onclick")}d=t.createElement("div");d.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=t.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var r=t.createElement("div");r.style.width=r.style.paddingLeft="1px";t.body.appendChild(r);c.boxModel=c.support.boxModel=r.offsetWidth===2;if("zoom"in r.style){r.style.display="inline";r.style.zoom=
1;c.support.inlineBlockNeedsLayout=r.offsetWidth===2;r.style.display="";r.innerHTML="<div style='width:4px;'></div>";c.support.shrinkWrapBlocks=r.offsetWidth!==2}r.innerHTML="<table><tr><td style='padding:0;display:none'></td><td>t</td></tr></table>";var A=r.getElementsByTagName("td");c.support.reliableHiddenOffsets=A[0].offsetHeight===0;A[0].style.display="";A[1].style.display="none";c.support.reliableHiddenOffsets=c.support.reliableHiddenOffsets&&A[0].offsetHeight===0;r.innerHTML="";t.body.removeChild(r).style.display=
"none"});a=function(r){var A=t.createElement("div");r="on"+r;var C=r in A;if(!C){A.setAttribute(r,"return;");C=typeof A[r]==="function"}return C};c.support.submitBubbles=a("submit");c.support.changeBubbles=a("change");a=b=d=f=h=null}})();var ra={},Ja=/^(?:\{.*\}|\[.*\])$/;c.extend({cache:{},uuid:0,expando:"jQuery"+c.now(),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},data:function(a,b,d){if(c.acceptData(a)){a=a==E?ra:a;var e=a.nodeType,f=e?a[c.expando]:null,h=
c.cache;if(!(e&&!f&&typeof b==="string"&&d===B)){if(e)f||(a[c.expando]=f=++c.uuid);else h=a;if(typeof b==="object")if(e)h[f]=c.extend(h[f],b);else c.extend(h,b);else if(e&&!h[f])h[f]={};a=e?h[f]:h;if(d!==B)a[b]=d;return typeof b==="string"?a[b]:a}}},removeData:function(a,b){if(c.acceptData(a)){a=a==E?ra:a;var d=a.nodeType,e=d?a[c.expando]:a,f=c.cache,h=d?f[e]:e;if(b){if(h){delete h[b];d&&c.isEmptyObject(h)&&c.removeData(a)}}else if(d&&c.support.deleteExpando)delete a[c.expando];else if(a.removeAttribute)a.removeAttribute(c.expando);
else if(d)delete f[e];else for(var l in a)delete a[l]}},acceptData:function(a){if(a.nodeName){var b=c.noData[a.nodeName.toLowerCase()];if(b)return!(b===true||a.getAttribute("classid")!==b)}return true}});c.fn.extend({data:function(a,b){var d=null;if(typeof a==="undefined"){if(this.length){var e=this[0].attributes,f;d=c.data(this[0]);for(var h=0,l=e.length;h<l;h++){f=e[h].name;if(f.indexOf("data-")===0){f=f.substr(5);ka(this[0],f,d[f])}}}return d}else if(typeof a==="object")return this.each(function(){c.data(this,
a)});var k=a.split(".");k[1]=k[1]?"."+k[1]:"";if(b===B){d=this.triggerHandler("getData"+k[1]+"!",[k[0]]);if(d===B&&this.length){d=c.data(this[0],a);d=ka(this[0],a,d)}return d===B&&k[1]?this.data(k[0]):d}else return this.each(function(){var o=c(this),x=[k[0],b];o.triggerHandler("setData"+k[1]+"!",x);c.data(this,a,b);o.triggerHandler("changeData"+k[1]+"!",x)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||"fx")+"queue";var e=
c.data(a,b);if(!d)return e||[];if(!e||c.isArray(d))e=c.data(a,b,c.makeArray(d));else e.push(d);return e}},dequeue:function(a,b){b=b||"fx";var d=c.queue(a,b),e=d.shift();if(e==="inprogress")e=d.shift();if(e){b==="fx"&&d.unshift("inprogress");e.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===B)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,
a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var sa=/[\n\t]/g,ha=/\s+/,Sa=/\r/g,Ta=/^(?:href|src|style)$/,Ua=/^(?:button|input)$/i,Va=/^(?:button|input|object|select|textarea)$/i,Wa=/^a(?:rea)?$/i,ta=/^(?:radio|checkbox)$/i;c.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",
colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};c.fn.extend({attr:function(a,b){return c.access(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(x){var r=c(this);r.addClass(a.call(this,x,r.attr("class")))});if(a&&typeof a==="string")for(var b=(a||"").split(ha),d=0,e=this.length;d<e;d++){var f=this[d];if(f.nodeType===
1)if(f.className){for(var h=" "+f.className+" ",l=f.className,k=0,o=b.length;k<o;k++)if(h.indexOf(" "+b[k]+" ")<0)l+=" "+b[k];f.className=c.trim(l)}else f.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(o){var x=c(this);x.removeClass(a.call(this,o,x.attr("class")))});if(a&&typeof a==="string"||a===B)for(var b=(a||"").split(ha),d=0,e=this.length;d<e;d++){var f=this[d];if(f.nodeType===1&&f.className)if(a){for(var h=(" "+f.className+" ").replace(sa," "),
l=0,k=b.length;l<k;l++)h=h.replace(" "+b[l]+" "," ");f.className=c.trim(h)}else f.className=""}return this},toggleClass:function(a,b){var d=typeof a,e=typeof b==="boolean";if(c.isFunction(a))return this.each(function(f){var h=c(this);h.toggleClass(a.call(this,f,h.attr("class"),b),b)});return this.each(function(){if(d==="string")for(var f,h=0,l=c(this),k=b,o=a.split(ha);f=o[h++];){k=e?k:!l.hasClass(f);l[k?"addClass":"removeClass"](f)}else if(d==="undefined"||d==="boolean"){this.className&&c.data(this,
"__className__",this.className);this.className=this.className||a===false?"":c.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,d=this.length;b<d;b++)if((" "+this[b].className+" ").replace(sa," ").indexOf(a)>-1)return true;return false},val:function(a){if(!arguments.length){var b=this[0];if(b){if(c.nodeName(b,"option")){var d=b.attributes.value;return!d||d.specified?b.value:b.text}if(c.nodeName(b,"select")){var e=b.selectedIndex;d=[];var f=b.options;b=b.type==="select-one";
if(e<0)return null;var h=b?e:0;for(e=b?e+1:f.length;h<e;h++){var l=f[h];if(l.selected&&(c.support.optDisabled?!l.disabled:l.getAttribute("disabled")===null)&&(!l.parentNode.disabled||!c.nodeName(l.parentNode,"optgroup"))){a=c(l).val();if(b)return a;d.push(a)}}return d}if(ta.test(b.type)&&!c.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Sa,"")}return B}var k=c.isFunction(a);return this.each(function(o){var x=c(this),r=a;if(this.nodeType===1){if(k)r=
a.call(this,o,x.val());if(r==null)r="";else if(typeof r==="number")r+="";else if(c.isArray(r))r=c.map(r,function(C){return C==null?"":C+""});if(c.isArray(r)&&ta.test(this.type))this.checked=c.inArray(x.val(),r)>=0;else if(c.nodeName(this,"select")){var A=c.makeArray(r);c("option",this).each(function(){this.selected=c.inArray(c(this).val(),A)>=0});if(!A.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},
attr:function(a,b,d,e){if(!a||a.nodeType===3||a.nodeType===8)return B;if(e&&b in c.attrFn)return c(a)[b](d);e=a.nodeType!==1||!c.isXMLDoc(a);var f=d!==B;b=e&&c.props[b]||b;var h=Ta.test(b);if((b in a||a[b]!==B)&&e&&!h){if(f){b==="type"&&Ua.test(a.nodeName)&&a.parentNode&&c.error("type property can't be changed");if(d===null)a.nodeType===1&&a.removeAttribute(b);else a[b]=d}if(c.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&
b.specified?b.value:Va.test(a.nodeName)||Wa.test(a.nodeName)&&a.href?0:B;return a[b]}if(!c.support.style&&e&&b==="style"){if(f)a.style.cssText=""+d;return a.style.cssText}f&&a.setAttribute(b,""+d);if(!a.attributes[b]&&a.hasAttribute&&!a.hasAttribute(b))return B;a=!c.support.hrefNormalized&&e&&h?a.getAttribute(b,2):a.getAttribute(b);return a===null?B:a}});var X=/\.(.*)$/,ia=/^(?:textarea|input|select)$/i,La=/\./g,Ma=/ /g,Xa=/[^\w\s.|`]/g,Ya=function(a){return a.replace(Xa,"\\$&")},ua={focusin:0,focusout:0};
c.event={add:function(a,b,d,e){if(!(a.nodeType===3||a.nodeType===8)){if(c.isWindow(a)&&a!==E&&!a.frameElement)a=E;if(d===false)d=U;else if(!d)return;var f,h;if(d.handler){f=d;d=f.handler}if(!d.guid)d.guid=c.guid++;if(h=c.data(a)){var l=a.nodeType?"events":"__events__",k=h[l],o=h.handle;if(typeof k==="function"){o=k.handle;k=k.events}else if(!k){a.nodeType||(h[l]=h=function(){});h.events=k={}}if(!o)h.handle=o=function(){return typeof c!=="undefined"&&!c.event.triggered?c.event.handle.apply(o.elem,
arguments):B};o.elem=a;b=b.split(" ");for(var x=0,r;l=b[x++];){h=f?c.extend({},f):{handler:d,data:e};if(l.indexOf(".")>-1){r=l.split(".");l=r.shift();h.namespace=r.slice(0).sort().join(".")}else{r=[];h.namespace=""}h.type=l;if(!h.guid)h.guid=d.guid;var A=k[l],C=c.event.special[l]||{};if(!A){A=k[l]=[];if(!C.setup||C.setup.call(a,e,r,o)===false)if(a.addEventListener)a.addEventListener(l,o,false);else a.attachEvent&&a.attachEvent("on"+l,o)}if(C.add){C.add.call(a,h);if(!h.handler.guid)h.handler.guid=
d.guid}A.push(h);c.event.global[l]=true}a=null}}},global:{},remove:function(a,b,d,e){if(!(a.nodeType===3||a.nodeType===8)){if(d===false)d=U;var f,h,l=0,k,o,x,r,A,C,J=a.nodeType?"events":"__events__",w=c.data(a),I=w&&w[J];if(w&&I){if(typeof I==="function"){w=I;I=I.events}if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(f in I)c.event.remove(a,f+b)}else{for(b=b.split(" ");f=b[l++];){r=f;k=f.indexOf(".")<0;o=[];if(!k){o=f.split(".");f=o.shift();x=RegExp("(^|\\.)"+
c.map(o.slice(0).sort(),Ya).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(A=I[f])if(d){r=c.event.special[f]||{};for(h=e||0;h<A.length;h++){C=A[h];if(d.guid===C.guid){if(k||x.test(C.namespace)){e==null&&A.splice(h--,1);r.remove&&r.remove.call(a,C)}if(e!=null)break}}if(A.length===0||e!=null&&A.length===1){if(!r.teardown||r.teardown.call(a,o)===false)c.removeEvent(a,f,w.handle);delete I[f]}}else for(h=0;h<A.length;h++){C=A[h];if(k||x.test(C.namespace)){c.event.remove(a,r,C.handler,h);A.splice(h--,1)}}}if(c.isEmptyObject(I)){if(b=
w.handle)b.elem=null;delete w.events;delete w.handle;if(typeof w==="function")c.removeData(a,J);else c.isEmptyObject(w)&&c.removeData(a)}}}}},trigger:function(a,b,d,e){var f=a.type||a;if(!e){a=typeof a==="object"?a[c.expando]?a:c.extend(c.Event(f),a):c.Event(f);if(f.indexOf("!")>=0){a.type=f=f.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[f]&&c.each(c.cache,function(){this.events&&this.events[f]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===
8)return B;a.result=B;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(e=d.nodeType?c.data(d,"handle"):(c.data(d,"__events__")||{}).handle)&&e.apply(d,b);e=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d["on"+f]&&d["on"+f].apply(d,b)===false){a.result=false;a.preventDefault()}}catch(h){}if(!a.isPropagationStopped()&&e)c.event.trigger(a,b,e,true);else if(!a.isDefaultPrevented()){var l;e=a.target;var k=f.replace(X,""),o=c.nodeName(e,"a")&&k===
"click",x=c.event.special[k]||{};if((!x._default||x._default.call(d,a)===false)&&!o&&!(e&&e.nodeName&&c.noData[e.nodeName.toLowerCase()])){try{if(e[k]){if(l=e["on"+k])e["on"+k]=null;c.event.triggered=true;e[k]()}}catch(r){}if(l)e["on"+k]=l;c.event.triggered=false}}},handle:function(a){var b,d,e,f;d=[];var h=c.makeArray(arguments);a=h[0]=c.event.fix(a||E.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;if(!b){e=a.type.split(".");a.type=e.shift();d=e.slice(0).sort();e=RegExp("(^|\\.)"+
d.join("\\.(?:.*\\.)?")+"(\\.|$)")}a.namespace=a.namespace||d.join(".");f=c.data(this,this.nodeType?"events":"__events__");if(typeof f==="function")f=f.events;d=(f||{})[a.type];if(f&&d){d=d.slice(0);f=0;for(var l=d.length;f<l;f++){var k=d[f];if(b||e.test(k.namespace)){a.handler=k.handler;a.data=k.data;a.handleObj=k;k=k.handler.apply(this,h);if(k!==B){a.result=k;if(k===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[c.expando])return a;var b=a;a=c.Event(b);for(var d=this.props.length,e;d;){e=this.props[--d];a[e]=b[e]}if(!a.target)a.target=a.srcElement||t;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=t.documentElement;d=t.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||
d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(a.which==null&&(a.charCode!=null||a.keyCode!=null))a.which=a.charCode!=null?a.charCode:a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==B)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,Y(a.origType,a.selector),c.extend({},a,{handler:Ka,guid:a.handler.guid}))},remove:function(a){c.event.remove(this,
Y(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,d){if(c.isWindow(this))this.onbeforeunload=d},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};c.removeEvent=t.removeEventListener?function(a,b,d){a.removeEventListener&&a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent&&a.detachEvent("on"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=a;this.type=a.type}else this.type=a;this.timeStamp=
c.now();this[c.expando]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=ca;var a=this.originalEvent;if(a)if(a.preventDefault)a.preventDefault();else a.returnValue=false},stopPropagation:function(){this.isPropagationStopped=ca;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ca;this.stopPropagation()},isDefaultPrevented:U,isPropagationStopped:U,isImmediatePropagationStopped:U};
var va=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},wa=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?wa:va,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?wa:va)}}});if(!c.support.submitBubbles)c.event.special.submit={setup:function(){if(this.nodeName.toLowerCase()!==
"form"){c.event.add(this,"click.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="submit"||d==="image")&&c(b).closest("form").length){a.liveFired=B;return la("submit",this,arguments)}});c.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="text"||d==="password")&&c(b).closest("form").length&&a.keyCode===13){a.liveFired=B;return la("submit",this,arguments)}})}else return false},teardown:function(){c.event.remove(this,".specialSubmit")}};if(!c.support.changeBubbles){var V,
xa=function(a){var b=a.type,d=a.value;if(b==="radio"||b==="checkbox")d=a.checked;else if(b==="select-multiple")d=a.selectedIndex>-1?c.map(a.options,function(e){return e.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")d=a.selectedIndex;return d},Z=function(a,b){var d=a.target,e,f;if(!(!ia.test(d.nodeName)||d.readOnly)){e=c.data(d,"_change_data");f=xa(d);if(a.type!=="focusout"||d.type!=="radio")c.data(d,"_change_data",f);if(!(e===B||f===e))if(e!=null||f){a.type="change";a.liveFired=
B;return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:Z,beforedeactivate:Z,click:function(a){var b=a.target,d=b.type;if(d==="radio"||d==="checkbox"||b.nodeName.toLowerCase()==="select")return Z.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(d==="checkbox"||d==="radio")||d==="select-multiple")return Z.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,"_change_data",xa(a))}},setup:function(){if(this.type===
"file")return false;for(var a in V)c.event.add(this,a+".specialChange",V[a]);return ia.test(this.nodeName)},teardown:function(){c.event.remove(this,".specialChange");return ia.test(this.nodeName)}};V=c.event.special.change.filters;V.focus=V.beforeactivate}t.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(e){e=c.event.fix(e);e.type=b;return c.event.trigger(e,null,e.target)}c.event.special[b]={setup:function(){ua[b]++===0&&t.addEventListener(a,d,true)},teardown:function(){--ua[b]===
0&&t.removeEventListener(a,d,true)}}});c.each(["bind","one"],function(a,b){c.fn[b]=function(d,e,f){if(typeof d==="object"){for(var h in d)this[b](h,e,d[h],f);return this}if(c.isFunction(e)||e===false){f=e;e=B}var l=b==="one"?c.proxy(f,function(o){c(this).unbind(o,l);return f.apply(this,arguments)}):f;if(d==="unload"&&b!=="one")this.one(d,e,f);else{h=0;for(var k=this.length;h<k;h++)c.event.add(this[h],d,l,e)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a==="object"&&!a.preventDefault)for(var d in a)this.unbind(d,
a[d]);else{d=0;for(var e=this.length;d<e;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,e){return this.live(b,d,e,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind("live"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){var d=c.Event(a);d.preventDefault();d.stopPropagation();c.event.trigger(d,b,this[0]);return d.result}},toggle:function(a){for(var b=arguments,d=
1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(e){var f=(c.data(this,"lastToggle"+a.guid)||0)%d;c.data(this,"lastToggle"+a.guid,f+1);e.preventDefault();return b[f].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var ya={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};c.each(["live","die"],function(a,b){c.fn[b]=function(d,e,f,h){var l,k=0,o,x,r=h||this.selector;h=h?this:c(this.context);if(typeof d===
"object"&&!d.preventDefault){for(l in d)h[b](l,e,d[l],r);return this}if(c.isFunction(e)){f=e;e=B}for(d=(d||"").split(" ");(l=d[k++])!=null;){o=X.exec(l);x="";if(o){x=o[0];l=l.replace(X,"")}if(l==="hover")d.push("mouseenter"+x,"mouseleave"+x);else{o=l;if(l==="focus"||l==="blur"){d.push(ya[l]+x);l+=x}else l=(ya[l]||l)+x;if(b==="live"){x=0;for(var A=h.length;x<A;x++)c.event.add(h[x],"live."+Y(l,r),{data:e,selector:r,handler:f,origType:l,origHandler:f,preType:o})}else h.unbind("live."+Y(l,r),f)}}return this}});
c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){c.fn[b]=function(d,e){if(e==null){e=d;d=null}return arguments.length>0?this.bind(b,d,e):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});E.attachEvent&&!E.addEventListener&&c(E).bind("unload",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});
(function(){function a(g,i,n,m,p,q){p=0;for(var u=m.length;p<u;p++){var y=m[p];if(y){var F=false;for(y=y[g];y;){if(y.sizcache===n){F=m[y.sizset];break}if(y.nodeType===1&&!q){y.sizcache=n;y.sizset=p}if(y.nodeName.toLowerCase()===i){F=y;break}y=y[g]}m[p]=F}}}function b(g,i,n,m,p,q){p=0;for(var u=m.length;p<u;p++){var y=m[p];if(y){var F=false;for(y=y[g];y;){if(y.sizcache===n){F=m[y.sizset];break}if(y.nodeType===1){if(!q){y.sizcache=n;y.sizset=p}if(typeof i!=="string"){if(y===i){F=true;break}}else if(k.filter(i,
[y]).length>0){F=y;break}}y=y[g]}m[p]=F}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,h=false,l=true;[0,0].sort(function(){l=false;return 0});var k=function(g,i,n,m){n=n||[];var p=i=i||t;if(i.nodeType!==1&&i.nodeType!==9)return[];if(!g||typeof g!=="string")return n;var q,u,y,F,M,N=true,O=k.isXML(i),D=[],R=g;do{d.exec("");if(q=d.exec(R)){R=q[3];D.push(q[1]);if(q[2]){F=q[3];
break}}}while(q);if(D.length>1&&x.exec(g))if(D.length===2&&o.relative[D[0]])u=L(D[0]+D[1],i);else for(u=o.relative[D[0]]?[i]:k(D.shift(),i);D.length;){g=D.shift();if(o.relative[g])g+=D.shift();u=L(g,u)}else{if(!m&&D.length>1&&i.nodeType===9&&!O&&o.match.ID.test(D[0])&&!o.match.ID.test(D[D.length-1])){q=k.find(D.shift(),i,O);i=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]}if(i){q=m?{expr:D.pop(),set:C(m)}:k.find(D.pop(),D.length===1&&(D[0]==="~"||D[0]==="+")&&i.parentNode?i.parentNode:i,O);u=q.expr?k.filter(q.expr,
q.set):q.set;if(D.length>0)y=C(u);else N=false;for(;D.length;){q=M=D.pop();if(o.relative[M])q=D.pop();else M="";if(q==null)q=i;o.relative[M](y,q,O)}}else y=[]}y||(y=u);y||k.error(M||g);if(f.call(y)==="[object Array]")if(N)if(i&&i.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&k.contains(i,y[g])))n.push(u[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&n.push(u[g]);else n.push.apply(n,y);else C(y,n);if(F){k(F,p,n,m);k.uniqueSort(n)}return n};k.uniqueSort=function(g){if(w){h=
l;g.sort(w);if(h)for(var i=1;i<g.length;i++)g[i]===g[i-1]&&g.splice(i--,1)}return g};k.matches=function(g,i){return k(g,null,null,i)};k.matchesSelector=function(g,i){return k(i,null,null,[g]).length>0};k.find=function(g,i,n){var m;if(!g)return[];for(var p=0,q=o.order.length;p<q;p++){var u,y=o.order[p];if(u=o.leftMatch[y].exec(g)){var F=u[1];u.splice(1,1);if(F.substr(F.length-1)!=="\\"){u[1]=(u[1]||"").replace(/\\/g,"");m=o.find[y](u,i,n);if(m!=null){g=g.replace(o.match[y],"");break}}}}m||(m=i.getElementsByTagName("*"));
return{set:m,expr:g}};k.filter=function(g,i,n,m){for(var p,q,u=g,y=[],F=i,M=i&&i[0]&&k.isXML(i[0]);g&&i.length;){for(var N in o.filter)if((p=o.leftMatch[N].exec(g))!=null&&p[2]){var O,D,R=o.filter[N];D=p[1];q=false;p.splice(1,1);if(D.substr(D.length-1)!=="\\"){if(F===y)y=[];if(o.preFilter[N])if(p=o.preFilter[N](p,F,n,y,m,M)){if(p===true)continue}else q=O=true;if(p)for(var j=0;(D=F[j])!=null;j++)if(D){O=R(D,p,j,F);var s=m^!!O;if(n&&O!=null)if(s)q=true;else F[j]=false;else if(s){y.push(D);q=true}}if(O!==
B){n||(F=y);g=g.replace(o.match[N],"");if(!q)return[];break}}}if(g===u)if(q==null)k.error(g);else break;u=g}return F};k.error=function(g){throw"Syntax error, unrecognized expression: "+g;};var o=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},relative:{"+":function(g,i){var n=typeof i==="string",m=n&&!/\W/.test(i);n=n&&!m;if(m)i=i.toLowerCase();m=0;for(var p=g.length,q;m<p;m++)if(q=g[m]){for(;(q=q.previousSibling)&&q.nodeType!==1;);g[m]=n||q&&q.nodeName.toLowerCase()===
i?q||false:q===i}n&&k.filter(i,g,true)},">":function(g,i){var n,m=typeof i==="string",p=0,q=g.length;if(m&&!/\W/.test(i))for(i=i.toLowerCase();p<q;p++){if(n=g[p]){n=n.parentNode;g[p]=n.nodeName.toLowerCase()===i?n:false}}else{for(;p<q;p++)if(n=g[p])g[p]=m?n.parentNode:n.parentNode===i;m&&k.filter(i,g,true)}},"":function(g,i,n){var m,p=e++,q=b;if(typeof i==="string"&&!/\W/.test(i)){m=i=i.toLowerCase();q=a}q("parentNode",i,p,g,m,n)},"~":function(g,i,n){var m,p=e++,q=b;if(typeof i==="string"&&!/\W/.test(i)){m=
i=i.toLowerCase();q=a}q("previousSibling",i,p,g,m,n)}},find:{ID:function(g,i,n){if(typeof i.getElementById!=="undefined"&&!n)return(g=i.getElementById(g[1]))&&g.parentNode?[g]:[]},NAME:function(g,i){if(typeof i.getElementsByName!=="undefined"){for(var n=[],m=i.getElementsByName(g[1]),p=0,q=m.length;p<q;p++)m[p].getAttribute("name")===g[1]&&n.push(m[p]);return n.length===0?null:n}},TAG:function(g,i){return i.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,i,n,m,p,q){g=" "+g[1].replace(/\\/g,
"")+" ";if(q)return g;q=0;for(var u;(u=i[q])!=null;q++)if(u)if(p^(u.className&&(" "+u.className+" ").replace(/[\t\n]/g," ").indexOf(g)>=0))n||m.push(u);else if(n)i[q]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g){return g[1].toLowerCase()},CHILD:function(g){if(g[1]==="nth"){var i=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=i[1]+(i[2]||1)-0;g[3]=i[3]-0}g[0]=e++;return g},ATTR:function(g,i,n,
m,p,q){i=g[1].replace(/\\/g,"");if(!q&&o.attrMap[i])g[1]=o.attrMap[i];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,i,n,m,p){if(g[1]==="not")if((d.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=k(g[3],null,null,i);else{g=k.filter(g[3],i,n,true^p);n||m.push.apply(m,g);return false}else if(o.match.POS.test(g[0])||o.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!=="hidden"},disabled:function(g){return g.disabled===
true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,i,n){return!!k(n[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===
g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toLowerCase()==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},setFilters:{first:function(g,i){return i===0},last:function(g,i,n,m){return i===m.length-1},even:function(g,i){return i%2===0},odd:function(g,i){return i%2===1},lt:function(g,i,n){return i<n[3]-0},gt:function(g,i,n){return i>n[3]-0},nth:function(g,i,n){return n[3]-
0===i},eq:function(g,i,n){return n[3]-0===i}},filter:{PSEUDO:function(g,i,n,m){var p=i[1],q=o.filters[p];if(q)return q(g,n,i,m);else if(p==="contains")return(g.textContent||g.innerText||k.getText([g])||"").indexOf(i[3])>=0;else if(p==="not"){i=i[3];n=0;for(m=i.length;n<m;n++)if(i[n]===g)return false;return true}else k.error("Syntax error, unrecognized expression: "+p)},CHILD:function(g,i){var n=i[1],m=g;switch(n){case "only":case "first":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(n===
"first")return true;m=g;case "last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case "nth":n=i[2];var p=i[3];if(n===1&&p===0)return true;var q=i[0],u=g.parentNode;if(u&&(u.sizcache!==q||!g.nodeIndex)){var y=0;for(m=u.firstChild;m;m=m.nextSibling)if(m.nodeType===1)m.nodeIndex=++y;u.sizcache=q}m=g.nodeIndex-p;return n===0?m===0:m%n===0&&m/n>=0}},ID:function(g,i){return g.nodeType===1&&g.getAttribute("id")===i},TAG:function(g,i){return i==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===
i},CLASS:function(g,i){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(i)>-1},ATTR:function(g,i){var n=i[1];n=o.attrHandle[n]?o.attrHandle[n](g):g[n]!=null?g[n]:g.getAttribute(n);var m=n+"",p=i[2],q=i[4];return n==null?p==="!=":p==="="?m===q:p==="*="?m.indexOf(q)>=0:p==="~="?(" "+m+" ").indexOf(q)>=0:!q?m&&n!==false:p==="!="?m!==q:p==="^="?m.indexOf(q)===0:p==="$="?m.substr(m.length-q.length)===q:p==="|="?m===q||m.substr(0,q.length+1)===q+"-":false},POS:function(g,i,n,m){var p=o.setFilters[i[2]];
if(p)return p(g,n,i,m)}}},x=o.match.POS,r=function(g,i){return"\\"+(i-0+1)},A;for(A in o.match){o.match[A]=RegExp(o.match[A].source+/(?![^\[]*\])(?![^\(]*\))/.source);o.leftMatch[A]=RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[A].source.replace(/\\(\d+)/g,r))}var C=function(g,i){g=Array.prototype.slice.call(g,0);if(i){i.push.apply(i,g);return i}return g};try{Array.prototype.slice.call(t.documentElement.childNodes,0)}catch(J){C=function(g,i){var n=0,m=i||[];if(f.call(g)==="[object Array]")Array.prototype.push.apply(m,
g);else if(typeof g.length==="number")for(var p=g.length;n<p;n++)m.push(g[n]);else for(;g[n];n++)m.push(g[n]);return m}}var w,I;if(t.documentElement.compareDocumentPosition)w=function(g,i){if(g===i){h=true;return 0}if(!g.compareDocumentPosition||!i.compareDocumentPosition)return g.compareDocumentPosition?-1:1;return g.compareDocumentPosition(i)&4?-1:1};else{w=function(g,i){var n,m,p=[],q=[];n=g.parentNode;m=i.parentNode;var u=n;if(g===i){h=true;return 0}else if(n===m)return I(g,i);else if(n){if(!m)return 1}else return-1;
for(;u;){p.unshift(u);u=u.parentNode}for(u=m;u;){q.unshift(u);u=u.parentNode}n=p.length;m=q.length;for(u=0;u<n&&u<m;u++)if(p[u]!==q[u])return I(p[u],q[u]);return u===n?I(g,q[u],-1):I(p[u],i,1)};I=function(g,i,n){if(g===i)return n;for(g=g.nextSibling;g;){if(g===i)return-1;g=g.nextSibling}return 1}}k.getText=function(g){for(var i="",n,m=0;g[m];m++){n=g[m];if(n.nodeType===3||n.nodeType===4)i+=n.nodeValue;else if(n.nodeType!==8)i+=k.getText(n.childNodes)}return i};(function(){var g=t.createElement("div"),
i="script"+(new Date).getTime(),n=t.documentElement;g.innerHTML="<a name='"+i+"'/>";n.insertBefore(g,n.firstChild);if(t.getElementById(i)){o.find.ID=function(m,p,q){if(typeof p.getElementById!=="undefined"&&!q)return(p=p.getElementById(m[1]))?p.id===m[1]||typeof p.getAttributeNode!=="undefined"&&p.getAttributeNode("id").nodeValue===m[1]?[p]:B:[]};o.filter.ID=function(m,p){var q=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&q&&q.nodeValue===p}}n.removeChild(g);
n=g=null})();(function(){var g=t.createElement("div");g.appendChild(t.createComment(""));if(g.getElementsByTagName("*").length>0)o.find.TAG=function(i,n){var m=n.getElementsByTagName(i[1]);if(i[1]==="*"){for(var p=[],q=0;m[q];q++)m[q].nodeType===1&&p.push(m[q]);m=p}return m};g.innerHTML="<a href='#'></a>";if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")o.attrHandle.href=function(i){return i.getAttribute("href",2)};g=null})();t.querySelectorAll&&
function(){var g=k,i=t.createElement("div");i.innerHTML="<p class='TEST'></p>";if(!(i.querySelectorAll&&i.querySelectorAll(".TEST").length===0)){k=function(m,p,q,u){p=p||t;m=m.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!u&&!k.isXML(p))if(p.nodeType===9)try{return C(p.querySelectorAll(m),q)}catch(y){}else if(p.nodeType===1&&p.nodeName.toLowerCase()!=="object"){var F=p.getAttribute("id"),M=F||"__sizzle__";F||p.setAttribute("id",M);try{return C(p.querySelectorAll("#"+M+" "+m),q)}catch(N){}finally{F||
p.removeAttribute("id")}}return g(m,p,q,u)};for(var n in g)k[n]=g[n];i=null}}();(function(){var g=t.documentElement,i=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.msMatchesSelector,n=false;try{i.call(t.documentElement,"[test!='']:sizzle")}catch(m){n=true}if(i)k.matchesSelector=function(p,q){q=q.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(p))try{if(n||!o.match.PSEUDO.test(q)&&!/!=/.test(q))return i.call(p,q)}catch(u){}return k(q,null,null,[p]).length>0}})();(function(){var g=
t.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){o.order.splice(1,0,"CLASS");o.find.CLASS=function(i,n,m){if(typeof n.getElementsByClassName!=="undefined"&&!m)return n.getElementsByClassName(i[1])};g=null}}})();k.contains=t.documentElement.contains?function(g,i){return g!==i&&(g.contains?g.contains(i):true)}:t.documentElement.compareDocumentPosition?
function(g,i){return!!(g.compareDocumentPosition(i)&16)}:function(){return false};k.isXML=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!=="HTML":false};var L=function(g,i){for(var n,m=[],p="",q=i.nodeType?[i]:i;n=o.match.PSEUDO.exec(g);){p+=n[0];g=g.replace(o.match.PSEUDO,"")}g=o.relative[g]?g+"*":g;n=0;for(var u=q.length;n<u;n++)k(g,q[n],m);return k.filter(p,m)};c.find=k;c.expr=k.selectors;c.expr[":"]=c.expr.filters;c.unique=k.uniqueSort;c.text=k.getText;c.isXMLDoc=k.isXML;
c.contains=k.contains})();var Za=/Until$/,$a=/^(?:parents|prevUntil|prevAll)/,ab=/,/,Na=/^.[^:#\[\.,]*$/,bb=Array.prototype.slice,cb=c.expr.match.POS;c.fn.extend({find:function(a){for(var b=this.pushStack("","find",a),d=0,e=0,f=this.length;e<f;e++){d=b.length;c.find(a,this[e],b);if(e>0)for(var h=d;h<b.length;h++)for(var l=0;l<d;l++)if(b[l]===b[h]){b.splice(h--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,e=b.length;d<e;d++)if(c.contains(this,b[d]))return true})},
not:function(a){return this.pushStack(ma(this,a,false),"not",a)},filter:function(a){return this.pushStack(ma(this,a,true),"filter",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){var d=[],e,f,h=this[0];if(c.isArray(a)){var l,k={},o=1;if(h&&a.length){e=0;for(f=a.length;e<f;e++){l=a[e];k[l]||(k[l]=c.expr.match.POS.test(l)?c(l,b||this.context):l)}for(;h&&h.ownerDocument&&h!==b;){for(l in k){e=k[l];if(e.jquery?e.index(h)>-1:c(h).is(e))d.push({selector:l,elem:h,level:o})}h=
h.parentNode;o++}}return d}l=cb.test(a)?c(a,b||this.context):null;e=0;for(f=this.length;e<f;e++)for(h=this[e];h;)if(l?l.index(h)>-1:c.find.matchesSelector(h,a)){d.push(h);break}else{h=h.parentNode;if(!h||!h.ownerDocument||h===b)break}d=d.length>1?c.unique(d):d;return this.pushStack(d,"closest",a)},index:function(a){if(!a||typeof a==="string")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var d=typeof a==="string"?c(a,b||this.context):
c.makeArray(a),e=c.merge(this.get(),d);return this.pushStack(!d[0]||!d[0].parentNode||d[0].parentNode.nodeType===11||!e[0]||!e[0].parentNode||e[0].parentNode.nodeType===11?e:c.unique(e))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",d)},next:function(a){return c.nth(a,2,"nextSibling")},prev:function(a){return c.nth(a,
2,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,
b){c.fn[a]=function(d,e){var f=c.map(this,b,d);Za.test(a)||(e=d);if(e&&typeof e==="string")f=c.filter(e,f);f=this.length>1?c.unique(f):f;if((this.length>1||ab.test(e))&&$a.test(a))f=f.reverse();return this.pushStack(f,a,bb.call(arguments).join(","))}});c.extend({filter:function(a,b,d){if(d)a=":not("+a+")";return b.length===1?c.find.matchesSelector(b[0],a)?[b[0]]:[]:c.find.matches(a,b)},dir:function(a,b,d){var e=[];for(a=a[b];a&&a.nodeType!==9&&(d===B||a.nodeType!==1||!c(a).is(d));){a.nodeType===1&&
e.push(a);a=a[b]}return e},nth:function(a,b,d){b=b||1;for(var e=0;a;a=a[d])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var za=/ jQuery\d+="(?:\d+|null)"/g,$=/^\s+/,Aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Ba=/<([\w:]+)/,db=/<tbody/i,eb=/<|&#?\w+;/,Ca=/<(?:script|object|embed|option|style)/i,Da=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/\=([^="'>\s]+\/)>/g,P={option:[1,
"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};P.optgroup=P.option;P.tbody=P.tfoot=P.colgroup=P.caption=P.thead;P.th=P.td;if(!c.support.htmlSerialize)P._default=[1,"div<div>","</div>"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=
c(this);d.text(a.call(this,b,d.text()))});if(typeof a!=="object"&&a!==B)return this.empty().append((this[0]&&this[0].ownerDocument||t).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},
wrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},
prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,
this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,e;(e=this[d])!=null;d++)if(!a||c.filter(a,[e]).length){if(!b&&e.nodeType===1){c.cleanData(e.getElementsByTagName("*"));c.cleanData([e])}e.parentNode&&e.parentNode.removeChild(e)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);
return this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,e=this.ownerDocument;if(!d){d=e.createElement("div");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(za,"").replace(fb,'="$1">').replace($,"")],e)[0]}else return this.cloneNode(true)});if(a===true){na(this,b);na(this.find("*"),b.find("*"))}return b},html:function(a){if(a===B)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(za,""):null;
else if(typeof a==="string"&&!Ca.test(a)&&(c.support.leadingWhitespace||!$.test(a))&&!P[(Ba.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Aa,"<$1></$2>");try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(e){this.empty().append(a)}}else c.isFunction(a)?this.each(function(f){var h=c(this);h.html(a.call(this,f,h.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=
c(this),e=d.html();d.replaceWith(a.call(this,b,e))});if(typeof a!=="string")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){var e,f,h,l=a[0],k=[];if(!c.support.checkClone&&arguments.length===3&&typeof l==="string"&&Da.test(l))return this.each(function(){c(this).domManip(a,
b,d,true)});if(c.isFunction(l))return this.each(function(x){var r=c(this);a[0]=l.call(this,x,b?r.html():B);r.domManip(a,b,d)});if(this[0]){e=l&&l.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:c.buildFragment(a,this,k);h=e.fragment;if(f=h.childNodes.length===1?h=h.firstChild:h.firstChild){b=b&&c.nodeName(f,"tr");f=0;for(var o=this.length;f<o;f++)d.call(b?c.nodeName(this[f],"table")?this[f].getElementsByTagName("tbody")[0]||this[f].appendChild(this[f].ownerDocument.createElement("tbody")):
this[f]:this[f],f>0||e.cacheable||this.length>1?h.cloneNode(true):h)}k.length&&c.each(k,Oa)}return this}});c.buildFragment=function(a,b,d){var e,f,h;b=b&&b[0]?b[0].ownerDocument||b[0]:t;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===t&&!Ca.test(a[0])&&(c.support.checkClone||!Da.test(a[0]))){f=true;if(h=c.fragments[a[0]])if(h!==1)e=h}if(!e){e=b.createDocumentFragment();c.clean(a,b,e,d)}if(f)c.fragments[a[0]]=h?e:1;return{fragment:e,cacheable:f}};c.fragments={};c.each({appendTo:"append",
prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(d){var e=[];d=c(d);var f=this.length===1&&this[0].parentNode;if(f&&f.nodeType===11&&f.childNodes.length===1&&d.length===1){d[b](this[0]);return this}else{f=0;for(var h=d.length;f<h;f++){var l=(f>0?this.clone(true):this).get();c(d[f])[b](l);e=e.concat(l)}return this.pushStack(e,a,d.selector)}}});c.extend({clean:function(a,b,d,e){b=b||t;if(typeof b.createElement==="undefined")b=b.ownerDocument||
b[0]&&b[0].ownerDocument||t;for(var f=[],h=0,l;(l=a[h])!=null;h++){if(typeof l==="number")l+="";if(l){if(typeof l==="string"&&!eb.test(l))l=b.createTextNode(l);else if(typeof l==="string"){l=l.replace(Aa,"<$1></$2>");var k=(Ba.exec(l)||["",""])[1].toLowerCase(),o=P[k]||P._default,x=o[0],r=b.createElement("div");for(r.innerHTML=o[1]+l+o[2];x--;)r=r.lastChild;if(!c.support.tbody){x=db.test(l);k=k==="table"&&!x?r.firstChild&&r.firstChild.childNodes:o[1]==="<table>"&&!x?r.childNodes:[];for(o=k.length-
1;o>=0;--o)c.nodeName(k[o],"tbody")&&!k[o].childNodes.length&&k[o].parentNode.removeChild(k[o])}!c.support.leadingWhitespace&&$.test(l)&&r.insertBefore(b.createTextNode($.exec(l)[0]),r.firstChild);l=r.childNodes}if(l.nodeType)f.push(l);else f=c.merge(f,l)}}if(d)for(h=0;f[h];h++)if(e&&c.nodeName(f[h],"script")&&(!f[h].type||f[h].type.toLowerCase()==="text/javascript"))e.push(f[h].parentNode?f[h].parentNode.removeChild(f[h]):f[h]);else{f[h].nodeType===1&&f.splice.apply(f,[h+1,0].concat(c.makeArray(f[h].getElementsByTagName("script"))));
d.appendChild(f[h])}return f},cleanData:function(a){for(var b,d,e=c.cache,f=c.event.special,h=c.support.deleteExpando,l=0,k;(k=a[l])!=null;l++)if(!(k.nodeName&&c.noData[k.nodeName.toLowerCase()]))if(d=k[c.expando]){if((b=e[d])&&b.events)for(var o in b.events)f[o]?c.event.remove(k,o):c.removeEvent(k,o,b.handle);if(h)delete k[c.expando];else k.removeAttribute&&k.removeAttribute(c.expando);delete e[d]}}});var Ea=/alpha\([^)]*\)/i,gb=/opacity=([^)]*)/,hb=/-([a-z])/ig,ib=/([A-Z])/g,Fa=/^-?\d+(?:px)?$/i,
jb=/^-?\d/,kb={position:"absolute",visibility:"hidden",display:"block"},Pa=["Left","Right"],Qa=["Top","Bottom"],W,Ga,aa,lb=function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){if(arguments.length===2&&b===B)return this;return c.access(this,a,b,true,function(d,e,f){return f!==B?c.style(d,e,f):c.css(d,e)})};c.extend({cssHooks:{opacity:{get:function(a,b){if(b){var d=W(a,"opacity","opacity");return d===""?"1":d}else return a.style.opacity}}},cssNumber:{zIndex:true,fontWeight:true,opacity:true,
zoom:true,lineHeight:true},cssProps:{"float":c.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,d,e){if(!(!a||a.nodeType===3||a.nodeType===8||!a.style)){var f,h=c.camelCase(b),l=a.style,k=c.cssHooks[h];b=c.cssProps[h]||h;if(d!==B){if(!(typeof d==="number"&&isNaN(d)||d==null)){if(typeof d==="number"&&!c.cssNumber[h])d+="px";if(!k||!("set"in k)||(d=k.set(a,d))!==B)try{l[b]=d}catch(o){}}}else{if(k&&"get"in k&&(f=k.get(a,false,e))!==B)return f;return l[b]}}},css:function(a,b,d){var e,f=c.camelCase(b),
h=c.cssHooks[f];b=c.cssProps[f]||f;if(h&&"get"in h&&(e=h.get(a,true,d))!==B)return e;else if(W)return W(a,b,f)},swap:function(a,b,d){var e={},f;for(f in b){e[f]=a.style[f];a.style[f]=b[f]}d.call(a);for(f in b)a.style[f]=e[f]},camelCase:function(a){return a.replace(hb,lb)}});c.curCSS=c.css;c.each(["height","width"],function(a,b){c.cssHooks[b]={get:function(d,e,f){var h;if(e){if(d.offsetWidth!==0)h=oa(d,b,f);else c.swap(d,kb,function(){h=oa(d,b,f)});if(h<=0){h=W(d,b,b);if(h==="0px"&&aa)h=aa(d,b,b);
if(h!=null)return h===""||h==="auto"?"0px":h}if(h<0||h==null){h=d.style[b];return h===""||h==="auto"?"0px":h}return typeof h==="string"?h:h+"px"}},set:function(d,e){if(Fa.test(e)){e=parseFloat(e);if(e>=0)return e+"px"}else return e}}});if(!c.support.opacity)c.cssHooks.opacity={get:function(a,b){return gb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var d=a.style;d.zoom=1;var e=c.isNaN(b)?"":"alpha(opacity="+b*100+")",f=
d.filter||"";d.filter=Ea.test(f)?f.replace(Ea,e):d.filter+" "+e}};if(t.defaultView&&t.defaultView.getComputedStyle)Ga=function(a,b,d){var e;d=d.replace(ib,"-$1").toLowerCase();if(!(b=a.ownerDocument.defaultView))return B;if(b=b.getComputedStyle(a,null)){e=b.getPropertyValue(d);if(e===""&&!c.contains(a.ownerDocument.documentElement,a))e=c.style(a,d)}return e};if(t.documentElement.currentStyle)aa=function(a,b){var d,e,f=a.currentStyle&&a.currentStyle[b],h=a.style;if(!Fa.test(f)&&jb.test(f)){d=h.left;
e=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;h.left=b==="fontSize"?"1em":f||0;f=h.pixelLeft+"px";h.left=d;a.runtimeStyle.left=e}return f===""?"auto":f};W=Ga||aa;if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=a.offsetHeight;return a.offsetWidth===0&&b===0||!c.support.reliableHiddenOffsets&&(a.style.display||c.css(a,"display"))==="none"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var mb=c.now(),nb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
ob=/^(?:select|textarea)/i,pb=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,qb=/^(?:GET|HEAD)$/,Ra=/\[\]$/,T=/\=\?(&|$)/,ja=/\?/,rb=/([?&])_=[^&]*/,sb=/^(\w+:)?\/\/([^\/?#]+)/,tb=/%20/g,ub=/#.*$/,Ha=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!=="string"&&Ha)return Ha.apply(this,arguments);else if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var f=a.slice(e,a.length);a=a.slice(0,e)}e="GET";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b===
"object"){b=c.param(b,c.ajaxSettings.traditional);e="POST"}var h=this;c.ajax({url:a,type:e,dataType:"html",data:b,complete:function(l,k){if(k==="success"||k==="notmodified")h.html(f?c("<div>").append(l.responseText.replace(nb,"")).find(f):l.responseText);d&&h.each(d,[l.responseText,k,l])}});return this},serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&
!this.disabled&&(this.checked||ob.test(this.nodeName)||pb.test(this.type))}).map(function(a,b){var d=c(this).val();return d==null?null:c.isArray(d)?c.map(d,function(e){return{name:b.name,value:e}}):{name:b.name,value:d}}).get()}});c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,e){if(c.isFunction(b)){e=e||d;d=b;b=null}return c.ajax({type:"GET",url:a,data:b,success:d,dataType:e})},
getScript:function(a,b){return c.get(a,null,b,"script")},getJSON:function(a,b,d){return c.get(a,b,d,"json")},post:function(a,b,d,e){if(c.isFunction(b)){e=e||d;d=b;b={}}return c.ajax({type:"POST",url:a,data:b,success:d,dataType:e})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return new E.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",
script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},ajax:function(a){var b=c.extend(true,{},c.ajaxSettings,a),d,e,f,h=b.type.toUpperCase(),l=qb.test(h);b.url=b.url.replace(ub,"");b.context=a&&a.context!=null?a.context:b;if(b.data&&b.processData&&typeof b.data!=="string")b.data=c.param(b.data,b.traditional);if(b.dataType==="jsonp"){if(h==="GET")T.test(b.url)||(b.url+=(ja.test(b.url)?"&":"?")+(b.jsonp||"callback")+"=?");else if(!b.data||
!T.test(b.data))b.data=(b.data?b.data+"&":"")+(b.jsonp||"callback")+"=?";b.dataType="json"}if(b.dataType==="json"&&(b.data&&T.test(b.data)||T.test(b.url))){d=b.jsonpCallback||"jsonp"+mb++;if(b.data)b.data=(b.data+"").replace(T,"="+d+"$1");b.url=b.url.replace(T,"="+d+"$1");b.dataType="script";var k=E[d];E[d]=function(m){if(c.isFunction(k))k(m);else{E[d]=B;try{delete E[d]}catch(p){}}f=m;c.handleSuccess(b,w,e,f);c.handleComplete(b,w,e,f);r&&r.removeChild(A)}}if(b.dataType==="script"&&b.cache===null)b.cache=
false;if(b.cache===false&&l){var o=c.now(),x=b.url.replace(rb,"$1_="+o);b.url=x+(x===b.url?(ja.test(b.url)?"&":"?")+"_="+o:"")}if(b.data&&l)b.url+=(ja.test(b.url)?"&":"?")+b.data;b.global&&c.active++===0&&c.event.trigger("ajaxStart");o=(o=sb.exec(b.url))&&(o[1]&&o[1].toLowerCase()!==location.protocol||o[2].toLowerCase()!==location.host);if(b.dataType==="script"&&h==="GET"&&o){var r=t.getElementsByTagName("head")[0]||t.documentElement,A=t.createElement("script");if(b.scriptCharset)A.charset=b.scriptCharset;
A.src=b.url;if(!d){var C=false;A.onload=A.onreadystatechange=function(){if(!C&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){C=true;c.handleSuccess(b,w,e,f);c.handleComplete(b,w,e,f);A.onload=A.onreadystatechange=null;r&&A.parentNode&&r.removeChild(A)}}}r.insertBefore(A,r.firstChild);return B}var J=false,w=b.xhr();if(w){b.username?w.open(h,b.url,b.async,b.username,b.password):w.open(h,b.url,b.async);try{if(b.data!=null&&!l||a&&a.contentType)w.setRequestHeader("Content-Type",
b.contentType);if(b.ifModified){c.lastModified[b.url]&&w.setRequestHeader("If-Modified-Since",c.lastModified[b.url]);c.etag[b.url]&&w.setRequestHeader("If-None-Match",c.etag[b.url])}o||w.setRequestHeader("X-Requested-With","XMLHttpRequest");w.setRequestHeader("Accept",b.dataType&&b.accepts[b.dataType]?b.accepts[b.dataType]+", */*; q=0.01":b.accepts._default)}catch(I){}if(b.beforeSend&&b.beforeSend.call(b.context,w,b)===false){b.global&&c.active--===1&&c.event.trigger("ajaxStop");w.abort();return false}b.global&&
c.triggerGlobal(b,"ajaxSend",[w,b]);var L=w.onreadystatechange=function(m){if(!w||w.readyState===0||m==="abort"){J||c.handleComplete(b,w,e,f);J=true;if(w)w.onreadystatechange=c.noop}else if(!J&&w&&(w.readyState===4||m==="timeout")){J=true;w.onreadystatechange=c.noop;e=m==="timeout"?"timeout":!c.httpSuccess(w)?"error":b.ifModified&&c.httpNotModified(w,b.url)?"notmodified":"success";var p;if(e==="success")try{f=c.httpData(w,b.dataType,b)}catch(q){e="parsererror";p=q}if(e==="success"||e==="notmodified")d||
c.handleSuccess(b,w,e,f);else c.handleError(b,w,e,p);d||c.handleComplete(b,w,e,f);m==="timeout"&&w.abort();if(b.async)w=null}};try{var g=w.abort;w.abort=function(){w&&Function.prototype.call.call(g,w);L("abort")}}catch(i){}b.async&&b.timeout>0&&setTimeout(function(){w&&!J&&L("timeout")},b.timeout);try{w.send(l||b.data==null?null:b.data)}catch(n){c.handleError(b,w,null,n);c.handleComplete(b,w,e,f)}b.async||L();return w}},param:function(a,b){var d=[],e=function(h,l){l=c.isFunction(l)?l():l;d[d.length]=
encodeURIComponent(h)+"="+encodeURIComponent(l)};if(b===B)b=c.ajaxSettings.traditional;if(c.isArray(a)||a.jquery)c.each(a,function(){e(this.name,this.value)});else for(var f in a)da(f,a[f],b,e);return d.join("&").replace(tb,"+")}});c.extend({active:0,lastModified:{},etag:{},handleError:function(a,b,d,e){a.error&&a.error.call(a.context,b,d,e);a.global&&c.triggerGlobal(a,"ajaxError",[b,a,e])},handleSuccess:function(a,b,d,e){a.success&&a.success.call(a.context,e,d,b);a.global&&c.triggerGlobal(a,"ajaxSuccess",
[b,a])},handleComplete:function(a,b,d){a.complete&&a.complete.call(a.context,b,d);a.global&&c.triggerGlobal(a,"ajaxComplete",[b,a]);a.global&&c.active--===1&&c.event.trigger("ajaxStop")},triggerGlobal:function(a,b,d){(a.context&&a.context.url==null?c(a.context):c.event).trigger(b,d)},httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader("Last-Modified"),
e=a.getResponseHeader("Etag");if(d)c.lastModified[b]=d;if(e)c.etag[b]=e;return a.status===304},httpData:function(a,b,d){var e=a.getResponseHeader("content-type")||"",f=b==="xml"||!b&&e.indexOf("xml")>=0;a=f?a.responseXML:a.responseText;f&&a.documentElement.nodeName==="parsererror"&&c.error("parsererror");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a==="string")if(b==="json"||!b&&e.indexOf("json")>=0)a=c.parseJSON(a);else if(b==="script"||!b&&e.indexOf("javascript")>=0)c.globalEval(a);return a}});
if(E.ActiveXObject)c.ajaxSettings.xhr=function(){if(E.location.protocol!=="file:")try{return new E.XMLHttpRequest}catch(a){}try{return new E.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}};c.support.ajax=!!c.ajaxSettings.xhr();var ea={},vb=/^(?:toggle|show|hide)$/,wb=/^([+\-]=)?([\d+.\-]+)(.*)$/,ba,pa=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];c.fn.extend({show:function(a,b,d){if(a||a===0)return this.animate(S("show",
3),a,b,d);else{d=0;for(var e=this.length;d<e;d++){a=this[d];b=a.style.display;if(!c.data(a,"olddisplay")&&b==="none")b=a.style.display="";b===""&&c.css(a,"display")==="none"&&c.data(a,"olddisplay",qa(a.nodeName))}for(d=0;d<e;d++){a=this[d];b=a.style.display;if(b===""||b==="none")a.style.display=c.data(a,"olddisplay")||""}return this}},hide:function(a,b,d){if(a||a===0)return this.animate(S("hide",3),a,b,d);else{a=0;for(b=this.length;a<b;a++){d=c.css(this[a],"display");d!=="none"&&c.data(this[a],"olddisplay",
d)}for(a=0;a<b;a++)this[a].style.display="none";return this}},_toggle:c.fn.toggle,toggle:function(a,b,d){var e=typeof a==="boolean";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||e?this.each(function(){var f=e?a:c(this).is(":hidden");c(this)[f?"show":"hide"]()}):this.animate(S("toggle",3),a,b,d);return this},fadeTo:function(a,b,d,e){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,d,e)},animate:function(a,b,d,e){var f=c.speed(b,
d,e);if(c.isEmptyObject(a))return this.each(f.complete);return this[f.queue===false?"each":"queue"](function(){var h=c.extend({},f),l,k=this.nodeType===1,o=k&&c(this).is(":hidden"),x=this;for(l in a){var r=c.camelCase(l);if(l!==r){a[r]=a[l];delete a[l];l=r}if(a[l]==="hide"&&o||a[l]==="show"&&!o)return h.complete.call(this);if(k&&(l==="height"||l==="width")){h.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(c.css(this,"display")==="inline"&&c.css(this,"float")==="none")if(c.support.inlineBlockNeedsLayout)if(qa(this.nodeName)===
"inline")this.style.display="inline-block";else{this.style.display="inline";this.style.zoom=1}else this.style.display="inline-block"}if(c.isArray(a[l])){(h.specialEasing=h.specialEasing||{})[l]=a[l][1];a[l]=a[l][0]}}if(h.overflow!=null)this.style.overflow="hidden";h.curAnim=c.extend({},a);c.each(a,function(A,C){var J=new c.fx(x,h,A);if(vb.test(C))J[C==="toggle"?o?"show":"hide":C](a);else{var w=wb.exec(C),I=J.cur()||0;if(w){var L=parseFloat(w[2]),g=w[3]||"px";if(g!=="px"){c.style(x,A,(L||1)+g);I=(L||
1)/J.cur()*I;c.style(x,A,I+g)}if(w[1])L=(w[1]==="-="?-1:1)*L+I;J.custom(I,L,g)}else J.custom(I,C,"")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);this.each(function(){for(var e=d.length-1;e>=0;e--)if(d[e].elem===this){b&&d[e](true);d.splice(e,1)}});b||this.dequeue();return this}});c.each({slideDown:S("show",1),slideUp:S("hide",1),slideToggle:S("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){c.fn[a]=function(d,e,f){return this.animate(b,
d,e,f)}});c.extend({speed:function(a,b,d){var e=a&&typeof a==="object"?c.extend({},a):{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};e.duration=c.fx.off?0:typeof e.duration==="number"?e.duration:e.duration in c.fx.speeds?c.fx.speeds[e.duration]:c.fx.speeds._default;e.old=e.complete;e.complete=function(){e.queue!==false&&c(this).dequeue();c.isFunction(e.old)&&e.old.call(this)};return e},easing:{linear:function(a,b,d,e){return d+e*a},swing:function(a,b,d,e){return(-Math.cos(a*
Math.PI)/2+0.5)*e+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||c.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a=parseFloat(c.css(this.elem,this.prop));return a&&a>-1E4?a:0},custom:function(a,b,d){function e(l){return f.step(l)}
var f=this,h=c.fx;this.startTime=c.now();this.start=a;this.end=b;this.unit=d||this.unit||"px";this.now=this.start;this.pos=this.state=0;e.elem=this.elem;if(e()&&c.timers.push(e)&&!ba)ba=setInterval(h.tick,h.interval)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;
this.custom(this.cur(),0)},step:function(a){var b=c.now(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var e in this.options.curAnim)if(this.options.curAnim[e]!==true)d=false;if(d){if(this.options.overflow!=null&&!c.support.shrinkWrapBlocks){var f=this.elem,h=this.options;c.each(["","X","Y"],function(k,o){f.style["overflow"+o]=h.overflow[k]})}this.options.hide&&c(this.elem).hide();if(this.options.hide||
this.options.show)for(var l in this.options.curAnim)c.style(this.elem,l,this.options.orig[l]);this.options.complete.call(this.elem)}return false}else{a=b-this.startTime;this.state=a/this.options.duration;b=this.options.easing||(c.easing.swing?"swing":"linear");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||b](this.state,a,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=
c.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||c.fx.stop()},interval:13,stop:function(){clearInterval(ba);ba=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===
b.elem}).length};var xb=/^t(?:able|d|h)$/i,Ia=/^(?:body|html)$/i;c.fn.offset="getBoundingClientRect"in t.documentElement?function(a){var b=this[0],d;if(a)return this.each(function(l){c.offset.setOffset(this,a,l)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);try{d=b.getBoundingClientRect()}catch(e){}var f=b.ownerDocument,h=f.documentElement;if(!d||!c.contains(h,b))return d||{top:0,left:0};b=f.body;f=fa(f);return{top:d.top+(f.pageYOffset||c.support.boxModel&&
h.scrollTop||b.scrollTop)-(h.clientTop||b.clientTop||0),left:d.left+(f.pageXOffset||c.support.boxModel&&h.scrollLeft||b.scrollLeft)-(h.clientLeft||b.clientLeft||0)}}:function(a){var b=this[0];if(a)return this.each(function(x){c.offset.setOffset(this,a,x)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d,e=b.offsetParent,f=b.ownerDocument,h=f.documentElement,l=f.body;d=(f=f.defaultView)?f.getComputedStyle(b,null):b.currentStyle;
for(var k=b.offsetTop,o=b.offsetLeft;(b=b.parentNode)&&b!==l&&b!==h;){if(c.offset.supportsFixedPosition&&d.position==="fixed")break;d=f?f.getComputedStyle(b,null):b.currentStyle;k-=b.scrollTop;o-=b.scrollLeft;if(b===e){k+=b.offsetTop;o+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&xb.test(b.nodeName))){k+=parseFloat(d.borderTopWidth)||0;o+=parseFloat(d.borderLeftWidth)||0}e=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"){k+=
parseFloat(d.borderTopWidth)||0;o+=parseFloat(d.borderLeftWidth)||0}d=d}if(d.position==="relative"||d.position==="static"){k+=l.offsetTop;o+=l.offsetLeft}if(c.offset.supportsFixedPosition&&d.position==="fixed"){k+=Math.max(h.scrollTop,l.scrollTop);o+=Math.max(h.scrollLeft,l.scrollLeft)}return{top:k,left:o}};c.offset={initialize:function(){var a=t.body,b=t.createElement("div"),d,e,f,h=parseFloat(c.css(a,"marginTop"))||0;c.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",
height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";a.insertBefore(b,a.firstChild);d=b.firstChild;e=d.firstChild;f=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=e.offsetTop!==5;this.doesAddBorderForTableAndCells=
f.offsetTop===5;e.style.position="fixed";e.style.top="20px";this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15;e.style.position=e.style.top="";d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==h;a.removeChild(b);c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.css(a,
"marginTop"))||0;d+=parseFloat(c.css(a,"marginLeft"))||0}return{top:b,left:d}},setOffset:function(a,b,d){var e=c.css(a,"position");if(e==="static")a.style.position="relative";var f=c(a),h=f.offset(),l=c.css(a,"top"),k=c.css(a,"left"),o=e==="absolute"&&c.inArray("auto",[l,k])>-1;e={};var x={};if(o)x=f.position();l=o?x.top:parseInt(l,10)||0;k=o?x.left:parseInt(k,10)||0;if(c.isFunction(b))b=b.call(a,d,h);if(b.top!=null)e.top=b.top-h.top+l;if(b.left!=null)e.left=b.left-h.left+k;"using"in b?b.using.call(a,
e):f.css(e)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),e=Ia.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.css(a,"marginTop"))||0;d.left-=parseFloat(c.css(a,"marginLeft"))||0;e.top+=parseFloat(c.css(b[0],"borderTopWidth"))||0;e.left+=parseFloat(c.css(b[0],"borderLeftWidth"))||0;return{top:d.top-e.top,left:d.left-e.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||t.body;a&&!Ia.test(a.nodeName)&&
c.css(a,"position")==="static";)a=a.offsetParent;return a})}});c.each(["Left","Top"],function(a,b){var d="scroll"+b;c.fn[d]=function(e){var f=this[0],h;if(!f)return null;if(e!==B)return this.each(function(){if(h=fa(this))h.scrollTo(!a?e:c(h).scrollLeft(),a?e:c(h).scrollTop());else this[d]=e});else return(h=fa(f))?"pageXOffset"in h?h[a?"pageYOffset":"pageXOffset"]:c.support.boxModel&&h.document.documentElement[d]||h.document.body[d]:f[d]}});c.each(["Height","Width"],function(a,b){var d=b.toLowerCase();
c.fn["inner"+b]=function(){return this[0]?parseFloat(c.css(this[0],d,"padding")):null};c.fn["outer"+b]=function(e){return this[0]?parseFloat(c.css(this[0],d,e?"margin":"border")):null};c.fn[d]=function(e){var f=this[0];if(!f)return e==null?null:this;if(c.isFunction(e))return this.each(function(l){var k=c(this);k[d](e.call(this,l,k[d]()))});if(c.isWindow(f))return f.document.compatMode==="CSS1Compat"&&f.document.documentElement["client"+b]||f.document.body["client"+b];else if(f.nodeType===9)return Math.max(f.documentElement["client"+
b],f.body["scroll"+b],f.documentElement["scroll"+b],f.body["offset"+b],f.documentElement["offset"+b]);else if(e===B){f=c.css(f,d);var h=parseFloat(f);return c.isNaN(h)?f:h}else return this.css(d,typeof e==="string"?e:e+"px")}})})(window);
</script><script type="text/javascript">//XRegExp 1.5.0 <xregexp.com> MIT License
var XRegExp;if(XRegExp){throw Error("can't load XRegExp twice in the same frame")}(function(){XRegExp=function(w,r){var q=[],u=XRegExp.OUTSIDE_CLASS,x=0,p,s,v,t,y;if(XRegExp.isRegExp(w)){if(r!==undefined){throw TypeError("can't supply flags when constructing one RegExp from another")}return j(w)}if(g){throw Error("can't call the XRegExp constructor within token definition functions")}r=r||"";p={hasNamedCapture:false,captureNames:[],hasFlag:function(z){return r.indexOf(z)>-1},setFlag:function(z){r+=z}};while(x<w.length){s=o(w,x,u,p);if(s){q.push(s.output);x+=(s.match[0].length||1)}else{if(v=m.exec.call(i[u],w.slice(x))){q.push(v[0]);x+=v[0].length}else{t=w.charAt(x);if(t==="["){u=XRegExp.INSIDE_CLASS}else{if(t==="]"){u=XRegExp.OUTSIDE_CLASS}}q.push(t);x++}}}y=RegExp(q.join(""),m.replace.call(r,h,""));y._xregexp={source:w,captureNames:p.hasNamedCapture?p.captureNames:null};return y};XRegExp.version="1.5.0";XRegExp.INSIDE_CLASS=1;XRegExp.OUTSIDE_CLASS=2;var c=/\$(?:(\d\d?|[$&`'])|{([$\w]+)})/g,h=/[^gimy]+|([\s\S])(?=[\s\S]*\1)/g,n=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,g=false,k=[],m={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},a=m.exec.call(/()??/,"")[1]===undefined,e=function(){var p=/^/g;m.test.call(p,"");return !p.lastIndex}(),f=function(){var p=/x/g;m.replace.call("x",p,"");return !p.lastIndex}(),b=RegExp.prototype.sticky!==undefined,i={};i[XRegExp.INSIDE_CLASS]=/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/;i[XRegExp.OUTSIDE_CLASS]=/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/;XRegExp.addToken=function(s,r,q,p){k.push({pattern:j(s,"g"+(b?"y":"")),handler:r,scope:q||XRegExp.OUTSIDE_CLASS,trigger:p||null})};XRegExp.cache=function(r,p){var q=r+"/"+(p||"");return XRegExp.cache[q]||(XRegExp.cache[q]=XRegExp(r,p))};XRegExp.copyAsGlobal=function(p){return j(p,"g")};XRegExp.escape=function(p){return p.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};XRegExp.execAt=function(s,r,t,q){r=j(r,"g"+((q&&b)?"y":""));r.lastIndex=t=t||0;var p=r.exec(s);if(q){return(p&&p.index===t)?p:null}else{return p}};XRegExp.freezeTokens=function(){XRegExp.addToken=function(){throw Error("can't run addToken after freezeTokens")}};XRegExp.isRegExp=function(p){return Object.prototype.toString.call(p)==="[object RegExp]"};XRegExp.iterate=function(u,p,v,s){var t=j(p,"g"),r=-1,q;while(q=t.exec(u)){v.call(s,q,++r,u,t);if(t.lastIndex===q.index){t.lastIndex++}}if(p.global){p.lastIndex=0}};XRegExp.matchChain=function(q,p){return function r(s,x){var v=p[x].regex?p[x]:{regex:p[x]},u=j(v.regex,"g"),w=[],t;for(t=0;t<s.length;t++){XRegExp.iterate(s[t],u,function(y){w.push(v.backref?(y[v.backref]||""):y[0])})}return((x===p.length-1)||!w.length)?w:r(w,x+1)}([q],0)};RegExp.prototype.apply=function(q,p){return this.exec(p[0])};RegExp.prototype.call=function(p,q){return this.exec(q)};RegExp.prototype.exec=function(t){var r=m.exec.apply(this,arguments),q,p;if(r){if(!a&&r.length>1&&l(r,"")>-1){p=RegExp(this.source,m.replace.call(d(this),"g",""));m.replace.call(t.slice(r.index),p,function(){for(var u=1;u<arguments.length-2;u++){if(arguments[u]===undefined){r[u]=undefined}}})}if(this._xregexp&&this._xregexp.captureNames){for(var s=1;s<r.length;s++){q=this._xregexp.captureNames[s-1];if(q){r[q]=r[s]}}}if(!e&&this.global&&!r[0].length&&(this.lastIndex>r.index)){this.lastIndex--}}return r};if(!e){RegExp.prototype.test=function(q){var p=m.exec.call(this,q);if(p&&this.global&&!p[0].length&&(this.lastIndex>p.index)){this.lastIndex--}return !!p}}String.prototype.match=function(q){if(!XRegExp.isRegExp(q)){q=RegExp(q)}if(q.global){var p=m.match.apply(this,arguments);q.lastIndex=0;return p}return q.exec(this)};String.prototype.replace=function(r,s){var t=XRegExp.isRegExp(r),q,p,u;if(t&&typeof s.valueOf()==="string"&&s.indexOf("${")===-1&&f){return m.replace.apply(this,arguments)}if(!t){r=r+""}else{if(r._xregexp){q=r._xregexp.captureNames}}if(typeof s==="function"){p=m.replace.call(this,r,function(){if(q){arguments[0]=new String(arguments[0]);for(var v=0;v<q.length;v++){if(q[v]){arguments[0][q[v]]=arguments[v+1]}}}if(t&&r.global){r.lastIndex=arguments[arguments.length-2]+arguments[0].length}return s.apply(null,arguments)})}else{u=this+"";p=m.replace.call(u,r,function(){var v=arguments;return m.replace.call(s,c,function(x,w,A){if(w){switch(w){case"$":return"$";case"&":return v[0];case"`":return v[v.length-1].slice(0,v[v.length-2]);case"'":return v[v.length-1].slice(v[v.length-2]+v[0].length);default:var y="";w=+w;if(!w){return x}while(w>v.length-3){y=String.prototype.slice.call(w,-1)+y;w=Math.floor(w/10)}return(w?v[w]||"":"$")+y}}else{var z=+A;if(z<=v.length-3){return v[z]}z=q?l(q,A):-1;return z>-1?v[z+1]:x}})})}if(t&&r.global){r.lastIndex=0}return p};String.prototype.split=function(u,p){if(!XRegExp.isRegExp(u)){return m.split.apply(this,arguments)}var w=this+"",r=[],v=0,t,q;if(p===undefined||+p<0){p=Infinity}else{p=Math.floor(+p);if(!p){return[]}}u=XRegExp.copyAsGlobal(u);while(t=u.exec(w)){if(u.lastIndex>v){r.push(w.slice(v,t.index));if(t.length>1&&t.index<w.length){Array.prototype.push.apply(r,t.slice(1))}q=t[0].length;v=u.lastIndex;if(r.length>=p){break}}if(u.lastIndex===t.index){u.lastIndex++}}if(v===w.length){if(!m.test.call(u,"")||q){r.push("")}}else{r.push(w.slice(v))}return r.length>p?r.slice(0,p):r};function j(r,q){if(!XRegExp.isRegExp(r)){throw TypeError("type RegExp expected")}var p=r._xregexp;r=XRegExp(r.source,d(r)+(q||""));if(p){r._xregexp={source:p.source,captureNames:p.captureNames?p.captureNames.slice(0):null}}return r}function d(p){return(p.global?"g":"")+(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.extended?"x":"")+(p.sticky?"y":"")}function o(v,u,w,p){var r=k.length,y,s,x;g=true;try{while(r--){x=k[r];if((w&x.scope)&&(!x.trigger||x.trigger.call(p))){x.pattern.lastIndex=u;s=x.pattern.exec(v);if(s&&s.index===u){y={output:x.handler.call(p,s,w),match:s};break}}}}catch(q){throw q}finally{g=false}return y}function l(s,q,r){if(Array.prototype.indexOf){return s.indexOf(q,r)}for(var p=r||0;p<s.length;p++){if(s[p]===q){return p}}return -1}XRegExp.addToken(/\(\?#[^)]*\)/,function(p){return m.test.call(n,p.input.slice(p.index+p[0].length))?"":"(?:)"});XRegExp.addToken(/\((?!\?)/,function(){this.captureNames.push(null);return"("});XRegExp.addToken(/\(\?<([$\w]+)>/,function(p){this.captureNames.push(p[1]);this.hasNamedCapture=true;return"("});XRegExp.addToken(/\\k<([\w$]+)>/,function(q){var p=l(this.captureNames,q[1]);return p>-1?"\\"+(p+1)+(isNaN(q.input.charAt(q.index+q[0].length))?"":"(?:)"):q[0]});XRegExp.addToken(/\[\^?]/,function(p){return p[0]==="[]"?"\\b\\B":"[\\s\\S]"});XRegExp.addToken(/^\(\?([imsx]+)\)/,function(p){this.setFlag(p[1]);return""});XRegExp.addToken(/(?:\s+|#.*)+/,function(p){return m.test.call(n,p.input.slice(p.index+p[0].length))?"":"(?:)"},XRegExp.OUTSIDE_CLASS,function(){return this.hasFlag("x")});XRegExp.addToken(/\./,function(){return"[\\s\\S]"},XRegExp.OUTSIDE_CLASS,function(){return this.hasFlag("s")})})();
</script><script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
//
// Begin anonymous function. This is used to contain local scope variables without polutting global scope.
//
var SyntaxHighlighter = function() { 

// CommonJS
if (typeof(require) != 'undefined' && typeof(XRegExp) == 'undefined')
{
	XRegExp = require('XRegExp').XRegExp;
}

// Shortcut object which will be assigned to the SyntaxHighlighter variable.
// This is a shorthand for local reference in order to avoid long namespace 
// references to SyntaxHighlighter.whatever...
var sh = {
	defaults : {
		/** Additional CSS class names to be added to highlighter elements. */
		'class-name' : '',
		
		/** First line number. */
		'first-line' : 1,
		
		/**
		 * Pads line numbers. Possible values are:
		 *
		 *   false - don't pad line numbers.
		 *   true  - automaticaly pad numbers with minimum required number of leading zeroes.
		 *   [int] - length up to which pad line numbers.
		 */
		'pad-line-numbers' : false,
		
		/** Lines to highlight. */
		'highlight' : null,
		
		/** Title to be displayed above the code block. */
		'title' : null,
		
		/** Enables or disables smart tabs. */
		'smart-tabs' : true,
		
		/** Gets or sets tab size. */
		'tab-size' : 4,
		
		/** Enables or disables gutter. */
		'gutter' : true,
		
		/** Enables or disables toolbar. */
		'toolbar' : true,
		
		/** Enables quick code copy and paste from double click. */
		'quick-code' : true,
		
		/** Forces code view to be collapsed. */
		'collapse' : false,
		
		/** Enables or disables automatic links. */
		'auto-links' : true,
		
		/** Gets or sets light mode. Equavalent to turning off gutter and toolbar. */
		'light' : false,
		
		'html-script' : false
	},
	
	config : {
		space : '&nbsp;',
		
		/** Enables use of <SCRIPT type="syntaxhighlighter" /> tags. */
		useScriptTags : true,
		
		/** Blogger mode flag. */
		bloggerMode : false,
		
		stripBrs : false,
		
		/** Name of the tag that SyntaxHighlighter will automatically look for. */
		tagName : 'pre',
		
		strings : {
			expandSource : 'expand source',
			help : '?',
			alert: 'SyntaxHighlighter\n\n',
			noBrush : 'Can\'t find brush for: ',
			brushNotHtmlScript : 'Brush wasn\'t configured for html-script option: ',
			
			// this is populated by the build script
			aboutDialog : '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>About SyntaxHighlighter</title></head><body style="font-family:Geneva,Arial,Helvetica,sans-serif;background-color:#fff;color:#000;font-size:1em;text-align:center;"><div style="text-align:center;margin-top:1.5em;"><div style="font-size:xx-large;">SyntaxHighlighter</div><div style="font-size:.75em;margin-bottom:3em;"><div>version 3.0.83 (July 02 2010)</div><div><a href="http://alexgorbatchev.com/SyntaxHighlighter" target="_blank" style="color:#005896">http://alexgorbatchev.com/SyntaxHighlighter</a></div><div>JavaScript code syntax highlighter.</div><div>Copyright 2004-2010 Alex Gorbatchev.</div></div><div>If you like this script, please <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2930402" style="color:#005896">donate</a> to <br/>keep development active!</div></div></body></html>'
		}
	},
	
	/** Internal 'global' variables. */
	vars : {
		discoveredBrushes : null,
		highlighters : {}
	},
	
	/** This object is populated by user included external brush files. */
	brushes : {},

	/** Common regular expressions. */
	regexLib : {
		multiLineCComments			: /\/\*[\s\S]*?\*\//gm,
		singleLineCComments			: /\/\/.*$/gm,
		singleLinePerlComments		: /#.*$/gm,
		doubleQuotedString			: /"([^\\"\n]|\\.)*"/g,
		singleQuotedString			: /'([^\\'\n]|\\.)*'/g,
		multiLineDoubleQuotedString	: new XRegExp('"([^\\\\"]|\\\\.)*"', 'gs'),
		multiLineSingleQuotedString	: new XRegExp("'([^\\\\']|\\\\.)*'", 'gs'),
		xmlComments					: /(&lt;|<)!--[\s\S]*?--(&gt;|>)/gm,
		url							: /\w+:\/\/[\w-.\/?%&=:@;]*/g,
		
		/** <?= ?> tags. */
		phpScriptTags 				: { left: /(&lt;|<)\?=?/g, right: /\?(&gt;|>)/g },
		
		/** <%= %> tags. */
		aspScriptTags				: { left: /(&lt;|<)%=?/g, right: /%(&gt;|>)/g },
		
		scriptScriptTags			: { left: /(&lt;|<)\s*script.*?(&gt;|>)/gi, right: /(&lt;|<)\/\s*script\s*(&gt;|>)/gi }
	},

	toolbar: {
		/**
		 * Generates HTML markup for the toolbar.
		 * @param {Highlighter} highlighter Highlighter instance.
		 * @return {String} Returns HTML markup.
		 */
		getHtml: function(highlighter)
		{
			var html = '<div class="toolbar">',
				items = sh.toolbar.items,
				list = items.list
				;
			
			function defaultGetHtml(highlighter, name)
			{
				return sh.toolbar.getButtonHtml(highlighter, name, sh.config.strings[name]);
			};
			
			for (var i = 0; i < list.length; i++)
				html += (items[list[i]].getHtml || defaultGetHtml)(highlighter, list[i]);
			
			html += '</div>';
			
			return html;
		},
		
		/**
		 * Generates HTML markup for a regular button in the toolbar.
		 * @param {Highlighter} highlighter Highlighter instance.
		 * @param {String} commandName		Command name that would be executed.
		 * @param {String} label			Label text to display.
		 * @return {String}					Returns HTML markup.
		 */
		getButtonHtml: function(highlighter, commandName, label)
		{
			return '<span><a href="#" class="toolbar_item'
				+ ' command_' + commandName
				+ ' ' + commandName
				+ '">' + label + '</a></span>'
				;
		},
		
		/**
		 * Event handler for a toolbar anchor.
		 */
		handler: function(e)
		{
			var target = e.target,
				className = target.className || ''
				;

			function getValue(name)
			{
				var r = new RegExp(name + '_(\\w+)'),
					match = r.exec(className)
					;

				return match ? match[1] : null;
			};
			
			var highlighter = getHighlighterById(findParentElement(target, '.syntaxhighlighter').id),
				commandName = getValue('command')
				;
			
			// execute the toolbar command
			if (highlighter && commandName)
				sh.toolbar.items[commandName].execute(highlighter);

			// disable default A click behaviour
			e.preventDefault();
		},
		
		/** Collection of toolbar items. */
		items : {
			// Ordered lis of items in the toolbar. Can't expect `for (var n in items)` to be consistent.
			list: ['expandSource', 'help'],

			expandSource: {
				getHtml: function(highlighter)
				{
					if (highlighter.getParam('collapse') != true)
						return '';
						
					var title = highlighter.getParam('title');
					return sh.toolbar.getButtonHtml(highlighter, 'expandSource', title ? title : sh.config.strings.expandSource);
				},
			
				execute: function(highlighter)
				{
					var div = getHighlighterDivById(highlighter.id);
					removeClass(div, 'collapsed');
				}
			},

			/** Command to display the about dialog window. */
			help: {
				execute: function(highlighter)
				{	
					var wnd = popup('', '_blank', 500, 250, 'scrollbars=0'),
						doc = wnd.document
						;
					
					doc.write(sh.config.strings.aboutDialog);
					doc.close();
					wnd.focus();
				}
			}
		}
	},

	/**
	 * Finds all elements on the page which should be processes by SyntaxHighlighter.
	 *
	 * @param {Object} globalParams		Optional parameters which override element's 
	 * 									parameters. Only used if element is specified.
	 * 
	 * @param {Object} element	Optional element to highlight. If none is
	 * 							provided, all elements in the current document 
	 * 							are returned which qualify.
	 *
	 * @return {Array}	Returns list of <code>{ target: DOMElement, params: Object }</code> objects.
	 */
	findElements: function(globalParams, element)
	{
		var elements = element ? [element] : toArray(document.getElementsByTagName(sh.config.tagName)), 
			conf = sh.config,
			result = []
			;

		// support for <SCRIPT TYPE="syntaxhighlighter" /> feature
		if (conf.useScriptTags)
			elements = elements.concat(getSyntaxHighlighterScriptTags());

		if (elements.length === 0) 
			return result;
	
		for (var i = 0; i < elements.length; i++) 
		{
			var item = {
				target: elements[i], 
				// local params take precedence over globals
				params: merge(globalParams, parseParams(elements[i].className))
			};

			if (item.params['brush'] == null)
				continue;
				
			result.push(item);
		}
		
		return result;
	},

	/**
	 * Shorthand to highlight all elements on the page that are marked as 
	 * SyntaxHighlighter source code.
	 * 
	 * @param {Object} globalParams		Optional parameters which override element's 
	 * 									parameters. Only used if element is specified.
	 * 
	 * @param {Object} element	Optional element to highlight. If none is
	 * 							provided, all elements in the current document 
	 * 							are highlighted.
	 */ 
	highlight: function(globalParams, element)
	{
		var elements = this.findElements(globalParams, element),
			propertyName = 'innerHTML', 
			highlighter = null,
			conf = sh.config
			;

		if (elements.length === 0) 
			return;
	
		for (var i = 0; i < elements.length; i++) 
		{
			var element = elements[i],
				target = element.target,
				params = element.params,
				brushName = params.brush,
				code
				;

			if (brushName == null)
				continue;

			// Instantiate a brush
			if (params['html-script'] == 'true' || sh.defaults['html-script'] == true) 
			{
				highlighter = new sh.HtmlScript(brushName);
				brushName = 'htmlscript';
			}
			else
			{
				var brush = findBrush(brushName);
				
				if (brush)
					highlighter = new brush();
				else
					continue;
			}
			
			code = target[propertyName];
			
			// remove CDATA from <SCRIPT/> tags if it's present
			if (conf.useScriptTags)
				code = stripCData(code);
				
			// Inject title if the attribute is present
			if ((target.title || '') != '')
				params.title = target.title;
				
			params['brush'] = brushName;
			highlighter.init(params);
			element = highlighter.getDiv(code);
			
			// carry over ID
			if ((target.id || '') != '')
				element.id = target.id;
			
			target.parentNode.replaceChild(element, target);
		}
	},

	/**
	 * Main entry point for the SyntaxHighlighter.
	 * @param {Object} params Optional params to apply to all highlighted elements.
	 */
	all: function(params)
	{
		attachEvent(
			window,
			'load',
			function() { sh.highlight(params); }
		);
	}
}; // end of sh

sh['all']			= sh.all;
sh['highlight']		= sh.highlight;

/**
 * Checks if target DOM elements has specified CSS class.
 * @param {DOMElement} target Target DOM element to check.
 * @param {String} className Name of the CSS class to check for.
 * @return {Boolean} Returns true if class name is present, false otherwise.
 */
function hasClass(target, className)
{
	return target.className.indexOf(className) != -1;
};

/**
 * Adds CSS class name to the target DOM element.
 * @param {DOMElement} target Target DOM element.
 * @param {String} className New CSS class to add.
 */
function addClass(target, className)
{
	if (!hasClass(target, className))
		target.className += ' ' + className;
};

/**
 * Removes CSS class name from the target DOM element.
 * @param {DOMElement} target Target DOM element.
 * @param {String} className CSS class to remove.
 */
function removeClass(target, className)
{
	target.className = target.className.replace(className, '');
};

/**
 * Converts the source to array object. Mostly used for function arguments and 
 * lists returned by getElementsByTagName() which aren't Array objects.
 * @param {List} source Source list.
 * @return {Array} Returns array.
 */
function toArray(source)
{
	var result = [];
	
	for (var i = 0; i < source.length; i++) 
		result.push(source[i]);
		
	return result;
};

/**
 * Splits block of text into lines.
 * @param {String} block Block of text.
 * @return {Array} Returns array of lines.
 */
function splitLines(block)
{
	return block.split('\n');
}

/**
 * Generates HTML ID for the highlighter.
 * @param {String} highlighterId Highlighter ID.
 * @return {String} Returns HTML ID.
 */
function getHighlighterId(id)
{
	var prefix = 'highlighter_';
	return id.indexOf(prefix) == 0 ? id : prefix + id;
};

/**
 * Finds Highlighter instance by ID.
 * @param {String} highlighterId Highlighter ID.
 * @return {Highlighter} Returns instance of the highlighter.
 */
function getHighlighterById(id)
{
	return sh.vars.highlighters[getHighlighterId(id)];
};

/**
 * Finds highlighter's DIV container.
 * @param {String} highlighterId Highlighter ID.
 * @return {Element} Returns highlighter's DIV element.
 */
function getHighlighterDivById(id)
{
	return document.getElementById(getHighlighterId(id));
};

/**
 * Stores highlighter so that getHighlighterById() can do its thing. Each
 * highlighter must call this method to preserve itself.
 * @param {Highilghter} highlighter Highlighter instance.
 */
function storeHighlighter(highlighter)
{
	sh.vars.highlighters[getHighlighterId(highlighter.id)] = highlighter;
};

/**
 * Looks for a child or parent node which has specified classname.
 * Equivalent to jQuery's $(container).find(".className")
 * @param {Element} target Target element.
 * @param {String} search Class name or node name to look for.
 * @param {Boolean} reverse If set to true, will go up the node tree instead of down.
 * @return {Element} Returns found child or parent element on null.
 */
function findElement(target, search, reverse /* optional */)
{
	if (target == null)
		return null;
		
	var nodes			= reverse != true ? target.childNodes : [ target.parentNode ],
		propertyToFind	= { '#' : 'id', '.' : 'className' }[search.substr(0, 1)] || 'nodeName',
		expectedValue,
		found
		;

	expectedValue = propertyToFind != 'nodeName'
		? search.substr(1)
		: search.toUpperCase()
		;
		
	// main return of the found node
	if ((target[propertyToFind] || '').indexOf(expectedValue) != -1)
		return target;
	
	for (var i = 0; nodes && i < nodes.length && found == null; i++)
		found = findElement(nodes[i], search, reverse);
	
	return found;
};

/**
 * Looks for a parent node which has specified classname.
 * This is an alias to <code>findElement(container, className, true)</code>.
 * @param {Element} target Target element.
 * @param {String} className Class name to look for.
 * @return {Element} Returns found parent element on null.
 */
function findParentElement(target, className)
{
	return findElement(target, className, true);
};

/**
 * Finds an index of element in the array.
 * @ignore
 * @param {Object} searchElement
 * @param {Number} fromIndex
 * @return {Number} Returns index of element if found; -1 otherwise.
 */
function indexOf(array, searchElement, fromIndex)
{
	fromIndex = Math.max(fromIndex || 0, 0);

	for (var i = fromIndex; i < array.length; i++)
		if(array[i] == searchElement)
			return i;
	
	return -1;
};

/**
 * Generates a unique element ID.
 */
function guid(prefix)
{
	return (prefix || '') + Math.round(Math.random() * 1000000).toString();
};

/**
 * Merges two objects. Values from obj2 override values in obj1.
 * Function is NOT recursive and works only for one dimensional objects.
 * @param {Object} obj1 First object.
 * @param {Object} obj2 Second object.
 * @return {Object} Returns combination of both objects.
 */
function merge(obj1, obj2)
{
	var result = {}, name;

	for (name in obj1) 
		result[name] = obj1[name];
	
	for (name in obj2) 
		result[name] = obj2[name];
		
	return result;
};

/**
 * Attempts to convert string to boolean.
 * @param {String} value Input string.
 * @return {Boolean} Returns true if input was "true", false if input was "false" and value otherwise.
 */
function toBoolean(value)
{
	var result = { "true" : true, "false" : false }[value];
	return result == null ? value : result;
};

/**
 * Opens up a centered popup window.
 * @param {String} url		URL to open in the window.
 * @param {String} name		Popup name.
 * @param {int} width		Popup width.
 * @param {int} height		Popup height.
 * @param {String} options	window.open() options.
 * @return {Window}			Returns window instance.
 */
function popup(url, name, width, height, options)
{
	var x = (screen.width - width) / 2,
		y = (screen.height - height) / 2
		;
		
	options +=	', left=' + x + 
				', top=' + y +
				', width=' + width +
				', height=' + height
		;
	options = options.replace(/^,/, '');

	var win = window.open(url, name, options);
	win.focus();
	return win;
};

/**
 * Adds event handler to the target object.
 * @param {Object} obj		Target object.
 * @param {String} type		Name of the event.
 * @param {Function} func	Handling function.
 */
function attachEvent(obj, type, func, scope)
{
	function handler(e)
	{
		e = e || window.event;
		
		if (!e.target)
		{
			e.target = e.srcElement;
			e.preventDefault = function()
			{
				this.returnValue = false;
			};
		}
			
		func.call(scope || window, e);
	};
	
	if (obj.attachEvent) 
	{
		obj.attachEvent('on' + type, handler);
	}
	else 
	{
		obj.addEventListener(type, handler, false);
	}
};

/**
 * Displays an alert.
 * @param {String} str String to display.
 */
function alert(str)
{
	window.alert(sh.config.strings.alert + str);
};

/**
 * Finds a brush by its alias.
 *
 * @param {String} alias		Brush alias.
 * @param {Boolean} showAlert	Suppresses the alert if false.
 * @return {Brush}				Returns bursh constructor if found, null otherwise.
 */
function findBrush(alias, showAlert)
{
	var brushes = sh.vars.discoveredBrushes,
		result = null
		;
	
	if (brushes == null) 
	{
		brushes = {};
		
		// Find all brushes
		for (var brush in sh.brushes) 
		{
			var info = sh.brushes[brush],
				aliases = info.aliases
				;
			
			if (aliases == null) 
				continue;
			
			// keep the brush name
			info.brushName = brush.toLowerCase();
			
			for (var i = 0; i < aliases.length; i++) 
				brushes[aliases[i]] = brush;
		}
		
		sh.vars.discoveredBrushes = brushes;
	}
	
	result = sh.brushes[brushes[alias]];

	if (result == null && showAlert != false)
		alert(sh.config.strings.noBrush + alias);
	
	return result;
};

/**
 * Executes a callback on each line and replaces each line with result from the callback.
 * @param {Object} str			Input string.
 * @param {Object} callback		Callback function taking one string argument and returning a string.
 */
function eachLine(str, callback)
{
	var lines = splitLines(str);
	
	for (var i = 0; i < lines.length; i++)
		lines[i] = callback(lines[i], i);
		
	return lines.join('\n');
};

/**
 * This is a special trim which only removes first and last empty lines
 * and doesn't affect valid leading space on the first line.
 * 
 * @param {String} str   Input string
 * @return {String}      Returns string without empty first and last lines.
 */
function trimFirstAndLastLines(str)
{
	return str.replace(/^[ ]*[\n]+|[\n]*[ ]*$/g, '');
};

/**
 * Parses key/value pairs into hash object.
 * 
 * Understands the following formats:
 * - name: word;
 * - name: [word, word];
 * - name: "string";
 * - name: 'string';
 * 
 * For example:
 *   name1: value; name2: [value, value]; name3: 'value'
 *   
 * @param {String} str    Input string.
 * @return {Object}       Returns deserialized object.
 */
function parseParams(str)
{
	var match, 
		result = {},
		arrayRegex = new XRegExp("^\\[(?<values>(.*?))\\]$"),
		regex = new XRegExp(
			"(?<name>[\\w-]+)" +
			"\\s*:\\s*" +
			"(?<value>" +
				"[\\w-%#]+|" +		// word
				"\\[.*?\\]|" +		// [] array
				'".*?"|' +			// "" string
				"'.*?'" +			// '' string
			")\\s*;?",
			"g"
		)
		;

	while ((match = regex.exec(str)) != null) 
	{
		var value = match.value
			.replace(/^['"]|['"]$/g, '') // strip quotes from end of strings
			;
		
		// try to parse array value
		if (value != null && arrayRegex.test(value))
		{
			var m = arrayRegex.exec(value);
			value = m.values.length > 0 ? m.values.split(/\s*,\s*/) : [];
		}
		
		result[match.name] = value;
	}
	
	return result;
};

/**
 * Wraps each line of the string into <code/> tag with given style applied to it.
 * 
 * @param {String} str   Input string.
 * @param {String} css   Style name to apply to the string.
 * @return {String}      Returns input string with each line surrounded by <span/> tag.
 */
function wrapLinesWithCode(str, css)
{
	if (str == null || str.length == 0 || str == '\n') 
		return str;

	str = str.replace(/</g, '&lt;');

	// Replace two or more sequential spaces with &nbsp; leaving last space untouched.
	str = str.replace(/ {2,}/g, function(m)
	{
		var spaces = '';
		
		for (var i = 0; i < m.length - 1; i++)
			spaces += sh.config.space;
		
		return spaces + ' ';
	});

	// Split each line and apply <span class="...">...</span> to them so that
	// leading spaces aren't included.
	if (css != null) 
		str = eachLine(str, function(line)
		{
			if (line.length == 0) 
				return '';
			
			var spaces = '';
			
			line = line.replace(/^(&nbsp;| )+/, function(s)
			{
				spaces = s;
				return '';
			});
			
			if (line.length == 0) 
				return spaces;
			
			return spaces + '<code class="' + css + '">' + line + '</code>';
		});

	return str;
};

/**
 * Pads number with zeros until it's length is the same as given length.
 * 
 * @param {Number} number	Number to pad.
 * @param {Number} length	Max string length with.
 * @return {String}			Returns a string padded with proper amount of '0'.
 */
function padNumber(number, length)
{
	var result = number.toString();
	
	while (result.length < length)
		result = '0' + result;
	
	return result;
};

/**
 * Replaces tabs with spaces.
 * 
 * @param {String} code		Source code.
 * @param {Number} tabSize	Size of the tab.
 * @return {String}			Returns code with all tabs replaces by spaces.
 */
function processTabs(code, tabSize)
{
	var tab = '';
	
	for (var i = 0; i < tabSize; i++)
		tab += ' ';

	return code.replace(/\t/g, tab);
};

/**
 * Replaces tabs with smart spaces.
 * 
 * @param {String} code    Code to fix the tabs in.
 * @param {Number} tabSize Number of spaces in a column.
 * @return {String}        Returns code with all tabs replaces with roper amount of spaces.
 */
function processSmartTabs(code, tabSize)
{
	var lines = splitLines(code),
		tab = '\t',
		spaces = ''
		;
	
	// Create a string with 1000 spaces to copy spaces from... 
	// It's assumed that there would be no indentation longer than that.
	for (var i = 0; i < 50; i++) 
		spaces += '                    '; // 20 spaces * 50
			
	// This function inserts specified amount of spaces in the string
	// where a tab is while removing that given tab.
	function insertSpaces(line, pos, count)
	{
		return line.substr(0, pos)
			+ spaces.substr(0, count)
			+ line.substr(pos + 1, line.length) // pos + 1 will get rid of the tab
			;
	};

	// Go through all the lines and do the 'smart tabs' magic.
	code = eachLine(code, function(line)
	{
		if (line.indexOf(tab) == -1) 
			return line;
		
		var pos = 0;
		
		while ((pos = line.indexOf(tab)) != -1) 
		{
			// This is pretty much all there is to the 'smart tabs' logic.
			// Based on the position within the line and size of a tab,
			// calculate the amount of spaces we need to insert.
			var spaces = tabSize - pos % tabSize;
			line = insertSpaces(line, pos, spaces);
		}
		
		return line;
	});
	
	return code;
};

/**
 * Performs various string fixes based on configuration.
 */
function fixInputString(str)
{
	var br = /<br\s*\/?>|&lt;br\s*\/?&gt;/gi;
	
	if (sh.config.bloggerMode == true)
		str = str.replace(br, '\n');

	if (sh.config.stripBrs == true)
		str = str.replace(br, '');
		
	return str;
};

/**
 * Removes all white space at the begining and end of a string.
 * 
 * @param {String} str   String to trim.
 * @return {String}      Returns string without leading and following white space characters.
 */
function trim(str)
{
	return str.replace(/^\s+|\s+$/g, '');
};

/**
 * Unindents a block of text by the lowest common indent amount.
 * @param {String} str   Text to unindent.
 * @return {String}      Returns unindented text block.
 */
function unindent(str)
{
	var lines = splitLines(fixInputString(str)),
		indents = new Array(),
		regex = /^\s*/,
		min = 1000
		;
	
	// go through every line and check for common number of indents
	for (var i = 0; i < lines.length && min > 0; i++) 
	{
		var line = lines[i];
		
		if (trim(line).length == 0) 
			continue;
		
		var matches = regex.exec(line);
		
		// In the event that just one line doesn't have leading white space
		// we can't unindent anything, so bail completely.
		if (matches == null) 
			return str;
			
		min = Math.min(matches[0].length, min);
	}
	
	// trim minimum common number of white space from the begining of every line
	if (min > 0) 
		for (var i = 0; i < lines.length; i++) 
			lines[i] = lines[i].substr(min);
	
	return lines.join('\n');
};

/**
 * Callback method for Array.sort() which sorts matches by
 * index position and then by length.
 * 
 * @param {Match} m1	Left object.
 * @param {Match} m2    Right object.
 * @return {Number}     Returns -1, 0 or -1 as a comparison result.
 */
function matchesSortCallback(m1, m2)
{
	// sort matches by index first
	if(m1.index < m2.index)
		return -1;
	else if(m1.index > m2.index)
		return 1;
	else
	{
		// if index is the same, sort by length
		if(m1.length < m2.length)
			return -1;
		else if(m1.length > m2.length)
			return 1;
	}
	
	return 0;
};

/**
 * Executes given regular expression on provided code and returns all
 * matches that are found.
 * 
 * @param {String} code    Code to execute regular expression on.
 * @param {Object} regex   Regular expression item info from <code>regexList</code> collection.
 * @return {Array}         Returns a list of Match objects.
 */ 
function getMatches(code, regexInfo)
{
	function defaultAdd(match, regexInfo)
	{
		return match[0];
	};
	
	var index = 0,
		match = null,
		matches = [],
		func = regexInfo.func ? regexInfo.func : defaultAdd
		;
	
	while((match = regexInfo.regex.exec(code)) != null)
	{
		var resultMatch = func(match, regexInfo);
		
		if (typeof(resultMatch) == 'string')
			resultMatch = [new sh.Match(resultMatch, match.index, regexInfo.css)];

		matches = matches.concat(resultMatch);
	}
	
	return matches;
};

/**
 * Turns all URLs in the code into <a/> tags.
 * @param {String} code Input code.
 * @return {String} Returns code with </a> tags.
 */
function processUrls(code)
{
	var gt = /(.*)((&gt;|&lt;).*)/;
	
	return code.replace(sh.regexLib.url, function(m)
	{
		var suffix = '',
			match = null
			;
		
		// We include &lt; and &gt; in the URL for the common cases like <http://google.com>
		// The problem is that they get transformed into &lt;http://google.com&gt;
		// Where as &gt; easily looks like part of the URL string.
	
		if (match = gt.exec(m))
		{
			m = match[1];
			suffix = match[2];
		}
		
		return '<a href="' + m + '">' + m + '</a>' + suffix;
	});
};

/**
 * Finds all <SCRIPT TYPE="syntaxhighlighter" /> elementss.
 * @return {Array} Returns array of all found SyntaxHighlighter tags.
 */
function getSyntaxHighlighterScriptTags()
{
	var tags = document.getElementsByTagName('script'),
		result = []
		;
	
	for (var i = 0; i < tags.length; i++)
		if (tags[i].type == 'syntaxhighlighter')
			result.push(tags[i]);
			
	return result;
};

/**
 * Strips <![CDATA[]]> from <SCRIPT /> content because it should be used
 * there in most cases for XHTML compliance.
 * @param {String} original	Input code.
 * @return {String} Returns code without leading <![CDATA[]]> tags.
 */
function stripCData(original)
{
	var left = '<![CDATA[',
		right = ']]>',
		// for some reason IE inserts some leading blanks here
		copy = trim(original),
		changed = false,
		leftLength = left.length,
		rightLength = right.length
		;
	
	if (copy.indexOf(left) == 0)
	{
		copy = copy.substring(leftLength);
		changed = true;
	}
	
	var copyLength = copy.length;
	
	if (copy.indexOf(right) == copyLength - rightLength)
	{
		copy = copy.substring(0, copyLength - rightLength);
		changed = true;
	}
	
	return changed ? copy : original;
};


/**
 * Quick code mouse double click handler.
 */
function quickCodeHandler(e)
{
	var target = e.target,
		highlighterDiv = findParentElement(target, '.syntaxhighlighter'),
		container = findParentElement(target, '.container'),
		textarea = document.createElement('textarea'),
		highlighter
		;

	if (!container || !highlighterDiv || findElement(container, 'textarea'))
		return;

	highlighter = getHighlighterById(highlighterDiv.id);
	
	// add source class name
	addClass(highlighterDiv, 'source');

	// Have to go over each line and grab it's text, can't just do it on the
	// container because Firefox loses all \n where as Webkit doesn't.
	var lines = container.childNodes,
		code = []
		;
	
	for (var i = 0; i < lines.length; i++)
		code.push(lines[i].innerText || lines[i].textContent);
	
	// using \r instead of \r or \r\n makes this work equally well on IE, FF and Webkit
	code = code.join('\r');
	
	// inject <textarea/> tag
	textarea.appendChild(document.createTextNode(code));
	container.appendChild(textarea);
	
	// preselect all text
	textarea.focus();
	textarea.select();
	
	// set up handler for lost focus
	attachEvent(textarea, 'blur', function(e)
	{
		textarea.parentNode.removeChild(textarea);
		removeClass(highlighterDiv, 'source');
	});
};

/**
 * Match object.
 */
sh.Match = function(value, index, css)
{
	this.value = value;
	this.index = index;
	this.length = value.length;
	this.css = css;
	this.brushName = null;
};

sh.Match.prototype.toString = function()
{
	return this.value;
};

/**
 * Simulates HTML code with a scripting language embedded.
 * 
 * @param {String} scriptBrushName Brush name of the scripting language.
 */
sh.HtmlScript = function(scriptBrushName)
{
	var brushClass = findBrush(scriptBrushName),
		scriptBrush,
		xmlBrush = new sh.brushes.Xml(),
		bracketsRegex = null,
		ref = this,
		methodsToExpose = 'getDiv getHtml init'.split(' ')
		;

	if (brushClass == null)
		return;
	
	scriptBrush = new brushClass();
	
	for(var i = 0; i < methodsToExpose.length; i++)
		// make a closure so we don't lose the name after i changes
		(function() {
			var name = methodsToExpose[i];
			
			ref[name] = function()
			{
				return xmlBrush[name].apply(xmlBrush, arguments);
			};
		})();
	
	if (scriptBrush.htmlScript == null)
	{
		alert(sh.config.strings.brushNotHtmlScript + scriptBrushName);
		return;
	}
	
	xmlBrush.regexList.push(
		{ regex: scriptBrush.htmlScript.code, func: process }
	);
	
	function offsetMatches(matches, offset)
	{
		for (var j = 0; j < matches.length; j++) 
			matches[j].index += offset;
	}
	
	function process(match, info)
	{
		var code = match.code,
			matches = [],
			regexList = scriptBrush.regexList,
			offset = match.index + match.left.length,
			htmlScript = scriptBrush.htmlScript,
			result
			;

		// add all matches from the code
		for (var i = 0; i < regexList.length; i++)
		{
			result = getMatches(code, regexList[i]);
			offsetMatches(result, offset);
			matches = matches.concat(result);
		}
		
		// add left script bracket
		if (htmlScript.left != null && match.left != null)
		{
			result = getMatches(match.left, htmlScript.left);
			offsetMatches(result, match.index);
			matches = matches.concat(result);
		}
		
		// add right script bracket
		if (htmlScript.right != null && match.right != null)
		{
			result = getMatches(match.right, htmlScript.right);
			offsetMatches(result, match.index + match[0].lastIndexOf(match.right));
			matches = matches.concat(result);
		}
		
		for (var j = 0; j < matches.length; j++)
			matches[j].brushName = brushClass.brushName;
			
		return matches;
	}
};

/**
 * Main Highlither class.
 * @constructor
 */
sh.Highlighter = function()
{
	// not putting any code in here because of the prototype inheritance
};

sh.Highlighter.prototype = {
	/**
	 * Returns value of the parameter passed to the highlighter.
	 * @param {String} name				Name of the parameter.
	 * @param {Object} defaultValue		Default value.
	 * @return {Object}					Returns found value or default value otherwise.
	 */
	getParam: function(name, defaultValue)
	{
		var result = this.params[name];
		return toBoolean(result == null ? defaultValue : result);
	},
	
	/**
	 * Shortcut to document.createElement().
	 * @param {String} name		Name of the element to create (DIV, A, etc).
	 * @return {HTMLElement}	Returns new HTML element.
	 */
	create: function(name)
	{
		return document.createElement(name);
	},
	
	/**
	 * Applies all regular expression to the code and stores all found
	 * matches in the `this.matches` array.
	 * @param {Array} regexList		List of regular expressions.
	 * @param {String} code			Source code.
	 * @return {Array}				Returns list of matches.
	 */
	findMatches: function(regexList, code)
	{
		var result = [];
		
		if (regexList != null)
			for (var i = 0; i < regexList.length; i++) 
				// BUG: length returns len+1 for array if methods added to prototype chain (oising@gmail.com)
				if (typeof (regexList[i]) == "object")
					result = result.concat(getMatches(code, regexList[i]));
		
		// sort and remove nested the matches
		return this.removeNestedMatches(result.sort(matchesSortCallback));
	},
	
	/**
	 * Checks to see if any of the matches are inside of other matches. 
	 * This process would get rid of highligted strings inside comments, 
	 * keywords inside strings and so on.
	 */
	removeNestedMatches: function(matches)
	{
		// Optimized by Jose Prado (http://joseprado.com)
		for (var i = 0; i < matches.length; i++) 
		{ 
			if (matches[i] === null)
				continue;
			
			var itemI = matches[i],
				itemIEndPos = itemI.index + itemI.length
				;
			
			for (var j = i + 1; j < matches.length && matches[i] !== null; j++) 
			{
				var itemJ = matches[j];
				
				if (itemJ === null) 
					continue;
				else if (itemJ.index > itemIEndPos) 
					break;
				else if (itemJ.index == itemI.index && itemJ.length > itemI.length)
					matches[i] = null;
				else if (itemJ.index >= itemI.index && itemJ.index < itemIEndPos) 
					matches[j] = null;
			}
		}
		
		return matches;
	},
	
	/**
	 * Creates an array containing integer line numbers starting from the 'first-line' param.
	 * @return {Array} Returns array of integers.
	 */
	figureOutLineNumbers: function(code)
	{
		var lines = [],
			firstLine = parseInt(this.getParam('first-line'))
			;
		
		eachLine(code, function(line, index)
		{
			lines.push(index + firstLine);
		});
		
		return lines;
	},
	
	/**
	 * Determines if specified line number is in the highlighted list.
	 */
	isLineHighlighted: function(lineNumber)
	{
		var list = this.getParam('highlight', []);
		
		if (typeof(list) != 'object' && list.push == null) 
			list = [ list ];
		
		return indexOf(list, lineNumber.toString()) != -1;
	},
	
	/**
	 * Generates HTML markup for a single line of code while determining alternating line style.
	 * @param {Integer} lineNumber	Line number.
	 * @param {String} code Line	HTML markup.
	 * @return {String}				Returns HTML markup.
	 */
	getLineHtml: function(lineIndex, lineNumber, code)
	{
		var classes = [
			'line',
			'number' + lineNumber,
			'index' + lineIndex,
			'alt' + (lineNumber % 2 == 0 ? 1 : 2).toString()
		];
		
		if (this.isLineHighlighted(lineNumber))
		 	classes.push('highlighted');
		
		if (lineNumber == 0)
			classes.push('break');
			
		return '<div class="' + classes.join(' ') + '">' + code + '</div>';
	},
	
	/**
	 * Generates HTML markup for line number column.
	 * @param {String} code			Complete code HTML markup.
	 * @param {Array} lineNumbers	Calculated line numbers.
	 * @return {String}				Returns HTML markup.
	 */
	getLineNumbersHtml: function(code, lineNumbers)
	{
		var html = '',
			count = splitLines(code).length,
			firstLine = parseInt(this.getParam('first-line')),
			pad = this.getParam('pad-line-numbers')
			;
		
		if (pad == true)
			pad = (firstLine + count - 1).toString().length;
		else if (isNaN(pad) == true)
			pad = 0;
			
		for (var i = 0; i < count; i++)
		{
			var lineNumber = lineNumbers ? lineNumbers[i] : firstLine + i,
				code = lineNumber == 0 ? sh.config.space : padNumber(lineNumber, pad)
				;
				
			html += this.getLineHtml(i, lineNumber, code);
		}
		
		return html;
	},
	
	/**
	 * Splits block of text into individual DIV lines.
	 * @param {String} code			Code to highlight.
	 * @param {Array} lineNumbers	Calculated line numbers.
	 * @return {String}				Returns highlighted code in HTML form.
	 */
	getCodeLinesHtml: function(html, lineNumbers)
	{
		html = trim(html);
		
		var lines = splitLines(html),
			padLength = this.getParam('pad-line-numbers'),
			firstLine = parseInt(this.getParam('first-line')),
			html = '',
			brushName = this.getParam('brush')
			;

		for (var i = 0; i < lines.length; i++)
		{
			var line = lines[i],
				indent = /^(&nbsp;|\s)+/.exec(line),
				spaces = null,
				lineNumber = lineNumbers ? lineNumbers[i] : firstLine + i;
				;

			if (indent != null)
			{
				spaces = indent[0].toString();
				line = line.substr(spaces.length);
				spaces = spaces.replace(' ', sh.config.space);
			}

			line = trim(line);
			
			if (line.length == 0)
				line = sh.config.space;
			
			html += this.getLineHtml(
				i,
				lineNumber, 
				(spaces != null ? '<code class="' + brushName + ' spaces">' + spaces + '</code>' : '') + line
			);
		}
		
		return html;
	},
	
	/**
	 * Returns HTML for the table title or empty string if title is null.
	 */
	getTitleHtml: function(title)
	{
		return title ? '<caption>' + title + '</caption>' : '';
	},
	
	/**
	 * Finds all matches in the source code.
	 * @param {String} code		Source code to process matches in.
	 * @param {Array} matches	Discovered regex matches.
	 * @return {String} Returns formatted HTML with processed mathes.
	 */
	getMatchesHtml: function(code, matches)
	{
		var pos = 0, 
			result = '',
			brushName = this.getParam('brush', '')
			;
		
		function getBrushNameCss(match)
		{
			var result = match ? (match.brushName || brushName) : brushName;
			return result ? result + ' ' : '';
		};
		
		// Finally, go through the final list of matches and pull the all
		// together adding everything in between that isn't a match.
		for (var i = 0; i < matches.length; i++) 
		{
			var match = matches[i],
				matchBrushName
				;
			
			if (match === null || match.length === 0) 
				continue;
			
			matchBrushName = getBrushNameCss(match);
			
			result += wrapLinesWithCode(code.substr(pos, match.index - pos), matchBrushName + 'plain')
					+ wrapLinesWithCode(match.value, matchBrushName + match.css)
					;

			pos = match.index + match.length + (match.offset || 0);
		}

		// don't forget to add whatever's remaining in the string
		result += wrapLinesWithCode(code.substr(pos), getBrushNameCss() + 'plain');

		return result;
	},
	
	/**
	 * Generates HTML markup for the whole syntax highlighter.
	 * @param {String} code Source code.
	 * @return {String} Returns HTML markup.
	 */
	getHtml: function(code)
	{
		var html = '',
			classes = [ 'syntaxhighlighter' ],
			tabSize,
			matches,
			lineNumbers
			;
		
		// process light mode
		if (this.getParam('light') == true)
			this.params.toolbar = this.params.gutter = false;

		className = 'syntaxhighlighter';

		if (this.getParam('collapse') == true)
			classes.push('collapsed');
		
		if ((gutter = this.getParam('gutter')) == false)
			classes.push('nogutter');

		// add custom user style name
		classes.push(this.getParam('class-name'));

		// add brush alias to the class name for custom CSS
		classes.push(this.getParam('brush'));

		code = trimFirstAndLastLines(code)
			.replace(/\r/g, ' ') // IE lets these buggers through
			;

		tabSize = this.getParam('tab-size');

		// replace tabs with spaces
		code = this.getParam('smart-tabs') == true
			? processSmartTabs(code, tabSize)
			: processTabs(code, tabSize)
			;

		// unindent code by the common indentation
		code = unindent(code);

		if (gutter)
			lineNumbers = this.figureOutLineNumbers(code);
		
		// find matches in the code using brushes regex list
		matches = this.findMatches(this.regexList, code);
		// processes found matches into the html
		html = this.getMatchesHtml(code, matches);
		// finally, split all lines so that they wrap well
		html = this.getCodeLinesHtml(html, lineNumbers);

		// finally, process the links
		if (this.getParam('auto-links'))
			html = processUrls(html);
		
		if (typeof(navigator) != 'undefined' && navigator.userAgent && navigator.userAgent.match(/MSIE/))
			classes.push('ie');
		
		html = 
			'<div id="' + getHighlighterId(this.id) + '" class="' + classes.join(' ') + '">'
				+ (this.getParam('toolbar') ? sh.toolbar.getHtml(this) : '')
				+ '<table border="0" cellpadding="0" cellspacing="0">'
					+ this.getTitleHtml(this.getParam('title'))
					+ '<tbody>'
						+ '<tr>'
							+ (gutter ? '<td class="gutter">' + this.getLineNumbersHtml(code) + '</td>' : '')
							+ '<td class="code">'
								+ '<div class="container">'
									+ html
								+ '</div>'
							+ '</td>'
						+ '</tr>'
					+ '</tbody>'
				+ '</table>'
			+ '</div>'
			;
			
		return html;
	},
	
	/**
	 * Highlights the code and returns complete HTML.
	 * @param {String} code     Code to highlight.
	 * @return {Element}        Returns container DIV element with all markup.
	 */
	getDiv: function(code)
	{
		if (code === null) 
			code = '';
		
		this.code = code;

		var div = this.create('div');

		// create main HTML
		div.innerHTML = this.getHtml(code);
		
		// set up click handlers
		if (this.getParam('toolbar'))
			attachEvent(findElement(div, '.toolbar'), 'click', sh.toolbar.handler);
		
		if (this.getParam('quick-code'))
			attachEvent(findElement(div, '.code'), 'dblclick', quickCodeHandler);
		
		return div;
	},
	
	/**
	 * Initializes the highlighter/brush.
	 *
	 * Constructor isn't used for initialization so that nothing executes during necessary
	 * `new SyntaxHighlighter.Highlighter()` call when setting up brush inheritence.
	 *
	 * @param {Hash} params Highlighter parameters.
	 */
	init: function(params)
	{
		this.id = guid();
		
		// register this instance in the highlighters list
		storeHighlighter(this);
		
		// local params take precedence over defaults
		this.params = merge(sh.defaults, params || {})
		
		// process light mode
		if (this.getParam('light') == true)
			this.params.toolbar = this.params.gutter = false;
	},
	
	/**
	 * Converts space separated list of keywords into a regular expression string.
	 * @param {String} str    Space separated keywords.
	 * @return {String}       Returns regular expression string.
	 */
	getKeywords: function(str)
	{
		str = str
			.replace(/^\s+|\s+$/g, '')
			.replace(/\s+/g, '|')
			;
		
		return '\\b(?:' + str + ')\\b';
	},
	
	/**
	 * Makes a brush compatible with the `html-script` functionality.
	 * @param {Object} regexGroup Object containing `left` and `right` regular expressions.
	 */
	forHtmlScript: function(regexGroup)
	{
		this.htmlScript = {
			left : { regex: regexGroup.left, css: 'script' },
			right : { regex: regexGroup.right, css: 'script' },
			code : new XRegExp(
				"(?<left>" + regexGroup.left.source + ")" +
				"(?<code>.*?)" +
				"(?<right>" + regexGroup.right.source + ")",
				"sgi"
				)
		};
	}
}; // end of Highlighter

return sh;
}(); // end of anonymous function

// CommonJS
typeof(exports) != 'undefined' ? exports['SyntaxHighlighter'] = SyntaxHighlighter : null;
</script><script type="text/javascript">/*!
 * Copyright ¬© 2010 Sattvik Software & Technology Resources, Ltd. Co.
 * All rights reserved.
 *
 * sh-clojure may be used under the terms of either the GNU Lesser General Public
 * License (LGPL) or the Eclipse Public License (EPL).  As a recipient of
 * sh-clojure, you may choose which license to receive the code under.  See the
 * LICENSE file distributed with sh-clojure for details.
 *
 * Written by Daniel Solano G√≥mez
 *
 * Version 0.9.1 - 10 Apr 2010
 */

function ClojureRegExp(pattern) {
	pattern = pattern + '(?=[[\\]{}(),\\s])';
	this.regex = new RegExp(pattern, 'g');
	this.lookBehind = /[\[\]{}(),\s]$/;
}

ClojureRegExp.prototype.exec = function (str) {
	var match, leftContext;
	while (match=this.regex.exec(str)) {
		leftContext = str.substring(0, match.index);
		if (this.lookBehind.test(leftContext)) {
			return match;
		}
		else {
			this.regex.lastIndex = match.index + 1;
		}
	}
	return null;
};

SyntaxHighlighter.brushes.Clojure = function () {
	var special_forms =
			'. def do fn if let loop monitor-enter monitor-exit new quote recur set! ' +
			'throw try var',
	    clojure_core =
			'* *1 *2 *3 *agent* *allow-unresolved-vars* *assert* *clojure-version* ' +
			'*command-line-args* *compile-files* *compile-path* *e *err* *file* ' +
			'*flush-on-newline* *in* *macro-meta* *math-context* *ns* *out* ' +
			'*print-dup* *print-length* *print-level* *print-meta* *print-readably* ' +
			'*read-eval* *source-path* *use-context-classloader* ' +
			'*warn-on-reflection* + - -> -&gt; ->> -&gt;&gt; .. / < &lt; <= &lt;= = ' +
			'== > &gt; >= &gt;= accessor aclone ' +
			'add-classpath add-watch agent agent-errors aget alength alias all-ns ' +
			'alter alter-meta! alter-var-root amap ancestors and apply areduce ' +
			'array-map aset aset-boolean aset-byte aset-char aset-double aset-float ' +
			'aset-int aset-long aset-short assert assoc assoc! assoc-in associative? ' +
			'atom await await-for await1 bases bean bigdec bigint binding bit-and ' +
			'bit-and-not bit-clear bit-flip bit-not bit-or bit-set bit-shift-left ' +
			'bit-shift-right bit-test bit-xor boolean boolean-array booleans ' +
			'bound-fn bound-fn* butlast byte byte-array bytes cast char char-array ' +
			'char-escape-string char-name-string char? chars chunk chunk-append ' +
			'chunk-buffer chunk-cons chunk-first chunk-next chunk-rest chunked-seq? ' +
			'class class? clear-agent-errors clojure-version coll? comment commute ' +
			'comp comparator compare compare-and-set! compile complement concat cond ' +
			'condp conj conj! cons constantly construct-proxy contains? count ' +
			'counted? create-ns create-struct cycle dec decimal? declare definline ' +
			'defmacro defmethod defmulti defn defn- defonce defstruct delay delay? ' +
			'deliver deref derive descendants destructure disj disj! dissoc dissoc! ' +
			'distinct distinct? doall doc dorun doseq dosync dotimes doto double ' +
			'double-array doubles drop drop-last drop-while empty empty? ensure ' +
			'enumeration-seq eval even? every? false? ffirst file-seq filter find ' +
			'find-doc find-ns find-var first float float-array float? floats flush ' +
			'fn fn? fnext for force format future future-call future-cancel ' +
			'future-cancelled? future-done? future? gen-class gen-interface gensym ' +
			'get get-in get-method get-proxy-class get-thread-bindings get-validator ' +
			'hash hash-map hash-set identical? identity if-let if-not ifn? import ' +
			'in-ns inc init-proxy instance? int int-array integer? interleave intern ' +
			'interpose into into-array ints io! isa? iterate iterator-seq juxt key ' +
			'keys keyword keyword? last lazy-cat lazy-seq let letfn line-seq list ' +
			'list* list? load load-file load-reader load-string loaded-libs locking ' +
			'long long-array longs loop macroexpand macroexpand-1 make-array ' +
			'make-hierarchy map map? mapcat max max-key memfn memoize merge ' +
			'merge-with meta method-sig methods min min-key mod name namespace neg? ' +
			'newline next nfirst nil? nnext not not-any? not-empty not-every? not= ' +
			'	ns ns-aliases ns-imports ns-interns ns-map ns-name ns-publics ' +
			'ns-refers ns-resolve ns-unalias ns-unmap nth nthnext num number? odd? ' +
			'or parents partial partition pcalls peek persistent! pmap pop pop! ' +
			'pop-thread-bindings pos? pr pr-str prefer-method prefers ' +
			'primitives-classnames print print-ctor print-doc print-dup print-method ' +
			'print-namespace-doc print-simple print-special-doc print-str printf ' +
			'println println-str prn prn-str promise proxy proxy-call-with-super ' +
			'proxy-mappings proxy-name proxy-super push-thread-bindings pvalues quot ' +
			'rand rand-int range ratio? rational? rationalize re-find re-groups ' +
			're-matcher re-matches re-pattern re-seq read read-line read-string ' +
			'reduce ref ref-history-count ref-max-history ref-min-history ref-set ' +
			'refer refer-clojure release-pending-sends rem remove remove-method ' +
			'remove-ns remove-watch repeat repeatedly replace replicate require ' +
			'reset! reset-meta! resolve rest resultset-seq reverse reversible? rseq ' +
			'rsubseq second select-keys send send-off seq seq? seque sequence ' +
			'sequential? set set-validator! set? short short-array shorts ' +
			'shutdown-agents slurp some sort sort-by sorted-map sorted-map-by ' +
			'sorted-set sorted-set-by sorted? special-form-anchor special-symbol? ' +
			'split-at split-with str stream? string? struct struct-map subs subseq ' +
			'subvec supers swap! symbol symbol? sync syntax-symbol-anchor take ' +
			'take-last take-nth take-while test the-ns time to-array to-array-2d ' +
			'trampoline transient tree-seq true? type unchecked-add unchecked-dec ' +
			'unchecked-divide unchecked-inc unchecked-multiply unchecked-negate ' +
			'unchecked-remainder unchecked-subtract underive unquote ' +
			'unquote-splicing update-in update-proxy use val vals var-get var-set ' +
			'var? vary-meta vec vector vector? when when-first when-let when-not ' +
			'while with-bindings with-bindings* with-in-str with-loading-context ' +
			'with-local-vars with-meta with-open with-out-str with-precision xml-seq ' +
			'zero? zipmap ';

	this.getKeywords = function (keywordStr) {
		// quote special characters
		keywordStr = keywordStr.replace(/[\-\[\]{}()*+?.\\\^$|,#]/g, "\\$&");
		// trim whitespace and convert to alternatives
		keywordStr = keywordStr.replace(/^\s+|\s+$/g, '').replace(/\s+/g, '|');
		// create pattern
		return '(?:' + keywordStr + ')';
	};

	this.regexList = [
		// comments
		{ regex: new RegExp(';.*$', 'gm'),
			css: 'comments' },
		// strings
		{ regex: SyntaxHighlighter.regexLib.multiLineDoubleQuotedString,
			css: 'string' },
		// regular expressions
		{ regex: /#"(?:\.|(\\\")|[^\""\n])*"/g,
			css: 'string' },
		// vectors
		{ regex: /\[|\]/g,
			css: 'keyword' },
		// amperstands
		{ regex: /&(amp;)?/g,
			css: 'keyword' },
		// sets and maps
		{ regex: /#?\{|\}/g,
			css: 'keyword' },
		// metadata
		{ regex: /#\^\{/g,
			css: 'keyword' },
		// anonymous fn syntactic sugar
		{ regex: /#\(|%/g,
			css: 'keyword' },
		// deref reader macro
		{ regex: /@/g,
			css: 'keyword' },
		// (un)quoted sexprs
		{ regex: /(['`]|~@?)[\[({]/g,
			css: 'keyword' },
		// lists
		{ regex: /\(|\)/g,
			css: 'keyword' },
		// character literals
		{ regex: /\\.\b/g,
			css: 'value' },
		// hexadecimal literals
		{ regex: /[+\-]?\b0x[0-9A-F]+\b/gi,
			css: 'value' },
		// integer/octal/float/bigdecimal literals
		{ regex: new ClojureRegExp("[+-]?\\b\\d+(\\.\\d*)?([eE][+-]?\\d+|M)?\\b"),
			css: 'value' },
		{ regex: /^[+\-]?\b\d+(\.\d*)?([eE][+\-]?\d+|M)?\b/g,
			css: 'value' },
		// booleans+nil
		{ regex: /\b(true|false|nil)\b/g,
			css: 'value' },
		// (un)quoted symbols
		{ regex: /(`|#?'|~@?)[\w-.A-Za-z0-9_&lt;&gt;\-]+/g,
			css: 'color1' },
		// keywords
		{ regex: /:[A-Za-z0-9_\-]+/g,
			css: 'constants' },
		// special forms
		{ regex: new ClojureRegExp(this.getKeywords(special_forms)),
			css: 'preprocessor' },
		// type hints
		{ regex: /\#\^[A-Za-z]\w*/g,
			css: 'preprocessor' },
		// clojure.core
		{ regex: new ClojureRegExp(this.getKeywords(clojure_core)),
			css: 'functions' },
                { regex: /[A-Za-z0-9_&lt;&gt;\-]+/g,  css: 'plain'}
	];

	this.forHtmlScript(SyntaxHighlighter.regexLib.scriptScriptTags);
};

SyntaxHighlighter.brushes.Clojure.prototype = new SyntaxHighlighter.Highlighter();
SyntaxHighlighter.brushes.Clojure.aliases   = ['clojure', 'Clojure', 'clj'];

// vim: ts=2 sw=2 noet
</script><script type="text/javascript">
// hackity-hack

$(document).ready(function() {
    var ft = $("#floating-toc")
    var ul = ft.find('ul')
    var lis = ft.find('li')

    ul.css('maring', '0px')

    var liHeight = $(lis.get(0)).height()

    ft.css('height', (liHeight) + 'px')


    showNs = function(ns) {
        //this is killing performance, lookup table.
        //var el = $("[id='floating-toc_" + ns + "']")
        //var index = lis.index(el)

        var index = 0

        for(i in nsPositions.nss) {
            if(ns == nsPositions.nss[i]) index = i
        }

        console.log(index)

        if(index == lastNsIndex) return;

        lastNsIndex = index


        ul.animate({marginTop: (-1 * liHeight * index) + 'px'},
               300)
        //        ul.css('margin-top', (-1 * liHeight * index) + 'px')

    }

    var calcNsPositions = function() {
        var nss = []
        var anchors = []
        var positions = []
        $.each(lis, function(i, el) {
            var ns = $(el).attr('id').split('_')[1]
            nss.push(ns)
            var a = $("a[name='"+ns+"']")
            anchors.push(a)
            positions.push(a.offset().top)
            console.log(a.offset().top)
        });

        return {nss: nss, positions: positions}
    }

    var nsPositions = calcNsPositions()

    console.log(nsPositions)

    var lastNsIndex = -1

    var $window = $(window)

    var currentSection = function(nsp) {

        var ps = nsp.positions
        var nss = nsp.nss
        var scroll = $window.scrollTop() + 300
        var nsIndex = -1
        for(var i in ps) {
            var p = ps[i]
            if(p >= scroll) {
                nsIndex = i-1
                break;
            }
                
        }

        if(nsIndex == -1 && scroll >= ps[0]) {
            nsIndex = ps.length-1
        }

        if(nsIndex == -1) nsIndex = 0

        return nss[nsIndex]
    }

    $(window).scroll(function(e) {
        showNs(currentSection(nsPositions))
    })

    ul.css('margin-top', '0px')

})
</script><title>cake -- Marginalia</title></head><body><table><tr><td class="docs"><div class="header"><h1 class="project-name">cake</h1><h2 class="project-version">0.6.4-SNAPSHOT</h2><br /><p>Save your fork, there's cake!</p>
</div><div class="dependencies"><h3>dependencies</h3><table><tr><td class="dep-name">clojure</td><td class="dotted"><hr /></td><td class="dep-version">1.2.0</td></tr><tr><td class="dep-name">clojure-contrib</td><td class="dotted"><hr /></td><td class="dep-version">1.2.0</td></tr><tr><td class="dep-name">uncle</td><td class="dotted"><hr /></td><td class="dep-version">0.2.3</td></tr><tr><td class="dep-name">depot</td><td class="dotted"><hr /></td><td class="dep-version">0.1.3</td></tr><tr><td class="dep-name">classlojure</td><td class="dotted"><hr /></td><td class="dep-version">0.5.2</td></tr><tr><td class="dep-name">useful</td><td class="dotted"><hr /></td><td class="dep-version">0.5.3</td></tr><tr><td class="dep-name">org.clojure/tools.namespace</td><td class="dotted"><hr /></td><td class="dep-version">0.1.1</td></tr><tr><td class="dep-name">org.clojars.ninjudd/java.classpath</td><td class="dotted"><hr /></td><td class="dep-version">0.1.2-SNAPSHOT</td></tr><tr><td class="dep-name">com.jcraft/jsch</td><td class="dotted"><hr /></td><td class="dep-version">0.1.42</td></tr></table></div><div class="dependencies"><h3>dev dependencies</h3><table><tr><td class="dep-name">org.clojars.flatland/cake-marginalia</td><td class="dotted"><hr /></td><td class="dep-version">0.6.1</td></tr></table></div><div class="plugins"><h3>cake plugin namespaces</h3><ul><li>cake-marginalia.tasks</li></ul></div></td><td class="codes" style="text-align: center; vertical-align: middle;color: #666;padding-right:20px"><br /><br /><br />(this space intentionally left almost blank)</td></tr><tr><td class="docs"><div class="toc"><a name="toc"><h3>namespaces</h3></a><ul><li><a href="#cake.core">cake.core</a></li><li><a href="#cake.deps">cake.deps</a></li><li><a href="#cake.file">cake.file</a></li><li><a href="#cake.main">cake.main</a></li><li><a href="#cake.project">cake.project</a></li><li><a href="#cake.server">cake.server</a></li><li><a href="#cake.task">cake.task</a></li><li><a href="#cake.tasks.bake">cake.tasks.bake</a></li><li><a href="#cake.tasks.check">cake.tasks.check</a></li><li><a href="#cake.tasks.classpath">cake.tasks.classpath</a></li><li><a href="#cake.tasks.clojars">cake.tasks.clojars</a></li><li><a href="#cake.tasks.compile">cake.tasks.compile</a></li><li><a href="#cake.tasks.coverage">cake.tasks.coverage</a></li><li><a href="#cake.tasks.default">cake.tasks.default</a></li><li><a href="#cake.tasks.deps">cake.tasks.deps</a></li><li><a href="#cake.tasks.docs">cake.tasks.docs</a></li><li><a href="#cake.tasks.eval">cake.tasks.eval</a></li><li><a href="#cake.tasks.file">cake.tasks.file</a></li><li><a href="#cake.tasks.global">cake.tasks.global</a></li><li><a href="#cake.tasks.help">cake.tasks.help</a></li><li><a href="#cake.tasks.jar">cake.tasks.jar</a></li><li><a href="#cake.tasks.new">cake.tasks.new</a></li><li><a href="#cake.tasks.ng">cake.tasks.ng</a></li><li><a href="#cake.tasks.release">cake.tasks.release</a></li><li><a href="#cake.tasks.swank">cake.tasks.swank</a></li><li><a href="#cake.tasks.test">cake.tasks.test</a></li><li><a href="#cake.tasks.version">cake.tasks.version</a></li><li><a href="#cake.utils.server-socket">cake.utils.server-socket</a></li><li><a href="#cake.utils">cake.utils</a></li></ul></div></td><td class="codes">&nbsp;</td></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.core" name="cake.core"><h1 class="project-name">cake.core</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.core
  (:use cake cake.task
        [cake.file :only [mkdir]]
        [useful.map :only [update into-map merge-in]]
        [useful.utils :only [verify syntax-quote]]
        [clojure.contrib.condition :only [raise]]
        [clojure.string :only [join]]
        [bake.core :only [force?]])
  (:require [cake.project :as project]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro defproject [name &amp; [version &amp; opts :as all]]
  (let [opts (syntax-quote (into-map (if (string? version) (conj opts [:version version]) all)))]
    `(let [project# (project/create '~name ~opts)]
       (alter-var-root #'*context*      (fn [_#] {}))
       (alter-var-root #'*project*      (fn [_#] project#))
       (alter-var-root #'*project-root* (fn [_#] project#)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro defcontext [name &amp; opts]
  (let [opts (syntax-quote opts)]
    `(alter-var-root #'*context* merge-in {'~name (into-map merge-in ~@opts)})))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro undeftask [taskname]
  `(append-task! '~taskname {:replace true}))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro remove-deps [taskname deps]
  `(append-task! '~taskname {:remove-deps ~deps}))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro require-tasks [&amp; namespaces]
  `(require-tasks! ~namespaces))</pre></tr><tr><td class="docs"><p>Define a cake task. Each part of the body is optional. Task definitions can
   be broken up among multiple deftask calls and even multiple files:
   (deftask foo #{bar baz} ; a set of prerequisites for this task
     "Documentation for task."
     {foo :foo} ; destructuring of <em>opts</em>
     (do-something)
     (do-something-else))</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro deftask
  [name &amp; forms]
  (verify (not (implicit-tasks name)) (str &quot;Cannot redefine implicit task: &quot; name))
  (let [{:keys [deps docs actions destruct pred]} (parse-task-opts forms)]
    `(append-task! '~name ~(conj {:deps deps :docs docs}
                                 (when (seq actions)
                                   `{:actions [(fn [~destruct]
                                                 (when ~pred ~@actions))]})))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- in-ts [ts task-decl]
  (conj (drop 2 task-decl)
        (symbol (str ts &quot;.&quot; (second task-decl)))
        (first task-decl)))</pre></tr><tr><td class="docs"><p>Wrap deftask calls with a task namespace. Takes docstrings for the namespace followed by forms.
   Creates a task named after the namespace that prints a list of tasks in that namespace.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro ts
  [ts &amp; forms]
  (let [[docs forms] (split-with string? forms)
        docs (update (vec docs) 0 #(str % &quot; --&quot;))]
    `(do
       (deftask ~ts ~@docs
         (invoke ~'help {:help [~(name ts)]}))
       ~@(map (partial in-ts ts) forms))))</pre></tr><tr><td class="docs"><p>Define a file task. Uses the same syntax as deftask, however the task name
   is a string representing the name of the file to be generated by the body.
   Source files may be specified in the dependencies set, in which case
   the file task will only be ran if the source is newer than the destination.
   Force the file to be generated using -F or --force.
   (defile "main.o" #{"main.c"}
     (sh "cc" "-c" "-o" "main.o" "main.c"))</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro defile
  [filename &amp; forms]
  (let [{:keys [deps docs actions destruct pred]} (parse-task-opts forms)]
    `(append-task! ~filename ~(conj {:deps deps :docs docs}
                                    (when-not (empty? forms)
                                      `{:actions [(fn [~destruct]
                                                    (when (or (force?)
                                                              (and ~pred
                                                                   (run-file-task? *File* ~deps)))
                                                      (mkdir (.getParentFile *File*))
                                                      ~@actions))]})))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro invoke [name &amp; [opts]]
  `(binding [*opts* (or ~opts *opts*)]
     (run-task '~name)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro bake [&amp; args]
  `(project/bake ~@args))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn abort-task [&amp; message]
  (raise {:type :abort-task :message (join &quot; &quot; message)}))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.deps" name="cake.deps"><h1 class="project-name">cake.deps</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.deps
  (:use cake uncle.core
        [cake.file :only [with-root file-exists? rmdir mv file]]
        [cake.utils :only [cake-exec]]
        [bake.core :only [log os-name os-arch]]
        [clojure.java.shell :only [sh]]
        [clojure.string :only [split join]]
        [useful.map :only [map-to]])
  (:require depot.maven
            [depot.deps :as depot])
  (:import [org.apache.tools.ant.taskdefs Copy Delete]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def default-repos
  [[&quot;clojure&quot;           &quot;http://build.clojure.org/releases&quot;]
   [&quot;clojure-snapshots&quot; &quot;http://build.clojure.org/snapshots&quot;]
   [&quot;clojars&quot;           &quot;http://clojars.org/repo&quot;]
   [&quot;maven&quot;             &quot;http://repo1.maven.org/maven2&quot;]])</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def dep-types [:dependencies :dev-dependencies :ext-dependencies :test-dependencies])
(def dep-jars (atom nil))
(def ^{:dynamic true} *overwrite* nil)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn subproject-path [dep]
  (when *config*
    (or (get *config* (str &quot;subproject.&quot; (namespace dep) &quot;.&quot; (name dep)))
        (get *config* (str &quot;subproject.&quot; (name dep))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn install-subprojects! []
  (doseq [type dep-types
          dep  (keys (*project* type))]
    (when-let [path (subproject-path dep)]
      (with-root path
        (cake-exec &quot;install&quot;)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn extract-native! [dest]
  (doseq [jars (vals @dep-jars), jar jars]
    (ant Copy {:todir dest :flatten true}
      (add-zipfileset {:src jar :includes (format &quot;native/%s/%s/*&quot; (os-name) (os-arch))}))
    (ant Copy {:todir dest :flatten true}
      (add-zipfileset {:src jar :includes &quot;lib/*.jar&quot; }))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn auto-exclusions [type]
  (cond (= :dev-dependencies  type) '[org.clojure/clojure org.clojure/clojure-contrib]
        (= :test-dependencies type) '[org.clojure/clojure]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn fetch-deps [type]
  (binding [depot/*repositories* default-repos
            depot/*exclusions*   (auto-exclusions type)]
    (try (depot/fetch-deps *project* type)
         (catch org.apache.tools.ant.BuildException e
           (println &quot;\nUnable to resolve the following dependencies:\n&quot;)
           (doall (map println (filter (partial re-matches #&quot;\d+\) .*&quot;)
                                       (split (.getMessage e) #&quot;\n&quot;))))
           (println)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn deps [type]
  (get @dep-jars type))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- jar-name [jar]
  (if (:long *opts*)
    (.getPath jar)
    (.getName jar)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn print-deps []
  (println)
  (doseq [type dep-types]
    (when-let [jars (seq (deps type))]
      (println (str (name type) &quot;:&quot;))
      (doseq [jar (sort (map jar-name jars))]
        (println &quot; &quot; jar))
      (println))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(let [subdir {:dependencies      
              :dev-dependencies  &quot;dev&quot;
              :ext-dependencies  &quot;ext&quot;
              :test-dependencies &quot;test&quot;}]
  (defn copy-deps [dest]
    (let [build (file &quot;build&quot; &quot;deps&quot;)]
      (when (or *overwrite*
                (not (file-exists? dest)))
        (doseq [type dep-types]
          (when-let [jars (fetch-deps type)]
            (ant Copy {:todir (file build (subdir type)) :flatten true}
              (.addFileset (:fileset (meta jars))))))
        (rmdir dest)
        (mv build dest))
      (map-to #(fileset-seq {:dir (file dest (subdir %)) :includes &quot;*.jar&quot;})
              dep-types))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn fetch-deps! []
  (let [lib (file (first (:library-path *project*)))]
    (install-subprojects!)
    (println &quot;Fetching dependencies...&quot;)
    (reset! dep-jars
            (if (:copy-deps *project*)
              (copy-deps lib)
              (map-to fetch-deps dep-types)))
    (extract-native! (file lib &quot;native&quot;))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn clear-deps! []
  (doseq [type dep-types]
    (depot/clear-deps *project* type)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.file" name="cake.file"><h1 class="project-name">cake.file</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.file
  (:use cake
        [useful.map :only [into-map]]
        [clojure.string :only [join]]
        uncle.core)
  (:import [org.apache.tools.ant.taskdefs Copy Move Touch Delete Mkdir]
           [java.io File]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- expand-path [root path]
  (let [root (or root )]
    (cond (instance? File root)  (cons (.getPath root) path)
          (.startsWith root &quot;/&quot;) (cons root path)
          (.startsWith root &quot;~&quot;) (cons (.replace root &quot;~&quot; (System/getProperty &quot;user.home&quot;)) path)
          :else                  (list* *root* root path))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- substitute-context [path]
  (if-let [context (:context *project*)]
    (.replace (str path) &quot;+context+&quot; (name context))
    path))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn file-name [root &amp; path]
  (join (File/separator)
        (map substitute-context (expand-path root path))))</pre></tr><tr><td class="docs"><p>Create a File object from a string or seq</p>
</td><td class="codes" /><pre class="brush: clojure">(defn file
  ([root]
     (if (instance? File root)
       root
       (File. (file-name root))))
  ([root &amp; path]
     (File. (apply file-name root path))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn path-string [file-or-path]
  (.getPath (file file-or-path)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn file-exists? [&amp; path]
  (.exists (apply file path)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn global-file [&amp; path]
  (apply file *global-root* path))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro with-root [root &amp; forms]
  `(binding [*root* ~root]
     ~@forms))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn cp [from to &amp; opts]
  (ant Copy
    (into-map opts :file from :tofile to)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn mv [from to &amp; opts]
  (ant Move
    (into-map opts :file from :tofile to)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn touch [file &amp; opts]
  (ant Touch
    (into-map opts :file file)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn rm [file &amp; opts]
  (ant Delete
    (into-map opts :file file)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn rmdir [file &amp; opts]
  (ant Delete
    (into-map opts :dir file)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn mkdir [file &amp; opts]
  (ant Mkdir
    (into-map opts :dir file)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn newer? [&amp; args]
  (apply &gt; (for [arg args]
             (if (number? arg)
               arg
               (.lastModified (if (string? arg) (file arg) arg))))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.main" name="cake.main"><h1 class="project-name">cake.main</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.main
  (:use cake
        [cake.deps :only [fetch-deps!]]
        [cake.task :only [run-task run?]]
        [cake.file :only [file global-file]]
        [cake.utils :only [*readline-marker*]]
        [cake.project :only [reload  reset-classloaders! reset-test-classloader! append-dev-dependencies!]]
        [cake.tasks.swank :only [start-swank]]
        [useful.java :only [on-shutdown]]
        [bake.io :only [init-log]]
        [bake.core :only [debug?]]
        [bake.reload :only [reload-project-files]]
        [uncle.core :only [in-project]]
        [clojure.contrib.condition :only [handler-case *condition*]])
  (:require [cake.tasks default global]
            [cake.server :as server]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn process-command [[task readline-marker]]
  (binding [*readline-marker* readline-marker]
    (in-project {:outs *outs* :verbose (debug?) :root *root*}
      (doseq [dir [&quot;lib&quot; &quot;classes&quot; &quot;build&quot;]]
        (.mkdirs (file dir)))
      (handler-case :type
        (if (or (:r *opts*) (:reset *opts*))
          (if (:test *opts*)
            (reset-test-classloader!)
            (reset-classloaders!))
          (reload))
        (run-task (symbol (name task)))
        (handle :abort-task
          (println (name task) &quot;aborted:&quot; (:message *condition*)))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn start-server [port]
  (init-log &quot;.cake/cake.log&quot;)
  (reload-project-files)
  (eval (:startup *project*))
  (on-shutdown #(eval (:shutdown *project*)))
  (in-project {:outs System/out :verbose (debug?) :root *root* :default-task &quot;startup&quot;}
    (fetch-deps!)
    (append-dev-dependencies!)
    (reset-classloaders!)
    (when-let [autostart (get *config* &quot;swank.autostart&quot;)]
      (start-swank autostart))
    (server/create port process-command))
  nil)</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.project" name="cake.project"><h1 class="project-name">cake.project</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.project
  (:use cake
        [cake.deps :only [deps]]
        [classlojure :only [wrap-ext-classloader classlojure eval-in get-classpath base-classloader append-classpath!]]
        [bake.core :only [debug?]]
        [cake.file :only [file global-file path-string]]
        [uncle.core :only [fileset-seq]]
        [clojure.string :only [split join trim-newline]]
        [clojure.java.shell :only [sh]]
        [useful.utils :only [adjoin]]
        [useful.map :only [update into-map]]
        [clojure.java.io :only [reader]])
  (:import [java.io File]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- path-file [path]
  (if-let [[_ dir] (and (string? path) (re-matches #&quot;(.*)/\*&quot; path))]
    (fileset-seq {:dir dir :includes &quot;*.jar&quot;})
    [(file path)]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- path-files [path]
  (when path
    (cond (string?     path) (mapcat path-file (split path (re-pattern File/pathSeparator)))
          (sequential? path) (mapcat path-file path)
          :else              (path-file path))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- to-urls [path]
  (map (fn [file]
         (str &quot;file:&quot; (.getPath file)
              (if (.isDirectory file) &quot;/&quot; )))
       (path-files path)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn classpath [&amp; paths]
  (mapcat to-urls (into [(System/getProperty &quot;bake.path&quot;)
                         (mapcat *project* [:source-path :test-path
                                            :resources-path :dev-resources-path
                                            :compile-path :test-compile-path])
                         (deps :dependencies)
                         (deps :dev-dependencies)
                         (get *config* &quot;project.classpath&quot;)
                         (path-string (global-file &quot;lib/dev/*&quot;))]
                        paths)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn ext-classpath []
  (mapcat to-urls (deps :ext-dependencies)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn make-classloader [&amp; paths]
  (when (:ext-dependencies *project*)
    (wrap-ext-classloader (ext-classpath)))
  (when-let [cl (classlojure (apply classpath paths))]
    (eval-in cl '(do (require 'cake)
                     (require 'bake.io)
                     (require 'bake.reload)
                     (require 'clojure.main)))
    cl))</pre></tr><tr><td class="docs"><p>Set the JVM classpath property to the current clojure classloader.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn set-classpath!
  [classloader]
  (System/setProperty &quot;java.class.path&quot; (join &quot;:&quot; (get-classpath classloader))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn append-dev-dependencies! []
  (apply append-classpath! base-classloader
         (mapcat to-urls (deps :dev-dependencies))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn reset-classloader! []
  (alter-var-root #'*classloader*
    (fn [cl]
      (when cl (eval-in cl '(shutdown-agents)))
      (when-let [classloader (make-classloader)]
        (set-classpath! classloader)
        classloader))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn reset-test-classloader! []
  (alter-var-root #'test-classloader
    (fn [_] (make-classloader (deps :test-dependencies)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn reset-classloaders! []
  (reset-classloader!)
  (reset-test-classloader!))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn reload []
  (when *classloader*
    (try
      (eval-in *classloader* '(bake.reload/reload))
      (catch Exception _ (reset-classloader!))))
  (when test-classloader
    (try
      (eval-in test-classloader '(bake.reload/reload))
      (catch Exception _ (reset-test-classloader!)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro with-classloader [paths &amp; forms]
  `(binding [*classloader* (make-classloader ~@paths)]
     ~@forms))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro with-test-classloader [&amp; forms]
  (if (= &quot;true&quot; (get *config* &quot;disable-test-classloader&quot;))
    `(do ~@forms)
    `(binding [*classloader* test-classloader]
       ~@forms)))</pre></tr><tr><td class="docs"><p>We need to quote the binding keys so they are not evaluated within the bake
   syntax-quote and the binding values so they are not evaluated in the
   project/project-eval syntax-quote. This function makes that possible.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- quote-if
  [pred bindings]
  (reduce
   (fn [v form]
     (if (pred (count v))
       (conj v (list 'quote form))
       (conj v form)))
   [] bindings))</pre></tr><tr><td class="docs"><p>Separate bindings based on whether their value is a Java core type or not, because Java types
   should be passed directly to the project classloader, while other values should be serialized.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- separate-bindings
  [bindings]
  (reduce (fn [b [sym val]]
            (if (and (class val) (.getClassLoader (class val)))
              (update b 0 conj  sym val)
              (update b 1 assoc sym val)))
          [[] {}]
          (partition 2 bindings)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- shared-bindings []
  `[~'cake/*current-task* '~*current-task*
    ~'cake/*project-root* '~*project-root*
    ~'cake/*project*      '~*project*
    ~'cake/*context*      '~*context*
    ~'cake/*script*       '~*script*
    ~'cake/*opts*         '~*opts*
    ~'cake/*pwd*          '~*pwd*
    ~'cake/*env*          '~*env*
    ~'cake/*vars*         '~*vars*])</pre></tr><tr><td class="docs"><p>TODO: this function is insane. make it sane.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn project-eval [ns-forms bindings body]
  (let [[let-bindings object-bindings] (separate-bindings bindings)
        temp-ns (gensym &quot;bake&quot;)
        form
        `(do (ns ~temp-ns
               (:use ~'cake)
               ~@ns-forms)
             (fn [ins# outs# ~@(keys object-bindings)]
               (try
                 (clojure.main/with-bindings
                   (bake.io/with-streams ins# outs#
                     (binding ~(shared-bindings)
                       (let ~(quote-if odd? let-bindings)
                         ~@body))))
                 (finally
                  (remove-ns '~temp-ns)))))]
    (try (apply eval-in *classloader*
                `(clojure.main/with-bindings (eval '~form))
                *ins* *outs* (vals object-bindings))
         (catch Throwable e
           (println &quot;error evaluating:&quot;)
           (prn (if (next body) (cons `do body) (first body)))
           (throw e)))))</pre></tr><tr><td class="docs"><p>Execute code in a your project classloader. Bindings allow passing state to the project
   classloader. Namespace forms like use and require must be specified before bindings.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro bake
  {:arglists '([ns-forms* bindings body*])}
  [&amp; forms]
  (let [[ns-forms [bindings &amp; body]] (split-with (complement vector?) forms)]
    `(project-eval '~ns-forms ~(quote-if even? bindings) '~body)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn group [dep]
  (if ('#{clojure clojure-contrib} dep)
    &quot;org.clojure&quot;
    (some #(% dep) [namespace name])))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-group [dep]
  (symbol (group dep) (name dep)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn dep-map [deps]
  (let [[deps default-opts] (split-with (complement keyword?) deps)]
    (into {}
          (for [[dep version &amp; opts] deps]
            [(add-group dep) (-&gt; (adjoin (into-map default-opts) (into-map opts))
                                 (assoc :version version)
                                 (update :exclusions (partial map add-group)))]))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmulti get-version identity)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod get-version :git [_]
  (:out (sh &quot;git&quot; &quot;describe&quot; &quot;--tags&quot; &quot;--abbrev=0&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod get-version :hg [_]
  (-&gt; &quot;.hgtags&quot; reader line-seq last (.split &quot; &quot;) last))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod get-version :default [r]
  (println &quot;No pre-defined get-version method for that key.&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- assoc-path
  ([opts key default]
     (let [path (or (get opts key) default)]
       (assoc opts key (if (string? path)
                         [path]
                         (vec path)))))
  ([opts key base-key suffix]
     (assoc-path opts key (vec (map #(str (file % suffix))
                                    (get opts base-key))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn create [project-name opts]
  (let [base-version (:version opts)
        version (trim-newline
                 (if (string? base-version)
                   base-version
                   (get-version base-version)))
        artifact (name project-name)
        artifact-version (str artifact &quot;-&quot; version)]
    (-&gt; opts
        (assoc :artifact-id       artifact
               :group-id          (group project-name)
               :version           version
               :name              (or (:name opts) artifact)
               :aot               (or (:aot opts) (:namespaces opts))
               :context           (symbol (or (get *config* &quot;project.context&quot;) (:context opts) &quot;dev&quot;))
               :jar-name          (or (:jar-name opts) artifact-version)
               :war-name          (or (:war-name opts) artifact-version)
               :uberjar-name      (or (:uberjar-name opts) (str artifact-version &quot;-standalone&quot;))
               :dev-dependencies  (dep-map (concat (:dev-dependencies    opts) (:dev-deps    opts)))
               :ext-dependencies  (dep-map (concat (:ext-dependencies    opts) (:ext-deps    opts)))
               :test-dependencies (dep-map (concat (:test-dependencies   opts) (:test-deps   opts)))
               :dependencies      (dep-map (concat (:dependencies        opts) (:deps        opts)
                                                   (:native-dependencies opts) (:native-deps opts))))
        (assoc-path :source-path        &quot;src&quot;)
        (assoc-path :test-path          &quot;test&quot;)
        (assoc-path :resources-path     &quot;resources&quot;)
        (assoc-path :library-path       &quot;lib&quot;)
        (assoc-path :dev-resources-path &quot;dev&quot;)
        (assoc-path :compile-path       &quot;classes&quot;)
        (assoc-path :test-compile-path  :test-path &quot;classes&quot;))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.server" name="cake.server"><h1 class="project-name">cake.server</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.server
  (:use cake
        [cake.project :only [bake]]
        [bake.core :only [with-context current-context print-stacktrace]]
        [clojure.main :only [skip-whitespace]]
        [bake.io :only [with-streams]]
        [bake.reload :only [reload]]
        [useful.utils :only [if-ns]])
  (:require [cake.utils.server-socket :as server-socket]
            [bake.complete :as complete])
  (:import [java.io File PrintStream InputStreamReader OutputStreamWriter PrintWriter OutputStream
                    FileOutputStream ByteArrayInputStream StringReader FileNotFoundException]
           [clojure.lang LineNumberingPushbackReader LispReader$ReaderException]
           [java.net InetAddress]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- read-seq []
  (lazy-seq
   (let [form (read *in* false :cake/EOF)]
     (when-not (= :cake/EOF form)
       (cons form (read-seq))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn validate-form []
  (println
   (try (doall (read-seq))
        &quot;valid&quot;
        (catch RuntimeException e
          (let [cause (.getCause e)]
            (if (and (instance? LispReader$ReaderException cause) (.contains (.getMessage cause) &quot;EOF&quot;))
              &quot;incomplete&quot;
              &quot;invalid&quot;))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn completions []
  (let [[prefix ns cake?] (read)]
    (dorun
     (map println
          (if cake?
            (complete/completions prefix ns)
            (bake (:require [bake.complete :as complete])
                  [prefix prefix, ns ns]
                  (complete/completions prefix ns)))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def commands
  {:validate    validate-form
   :completions completions
   :ping        #(println &quot;pong&quot;)})</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn fatal? [e]
  (and (instance? clojure.lang.Compiler$CompilerException e)
       (instance? UnsatisfiedLinkError (.getCause e))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn create [port f]
  (server-socket/create-server port
    (fn [ins outs]
      (with-streams ins outs
        (try
          (let [form (read), vars (read)]
            (clojure.main/with-bindings
              (reload)
              (binding [*vars*    vars
                        *pwd*     (:pwd vars)
                        *env*     (:env vars)
                        *opts*    (:opts vars)
                        *args*    (:args vars)
                        *script*  (:script vars)]
                (with-context (current-context)
                  (if (keyword? form)
                    (when-let [command (commands form)]
                      (command))
                    (f form))))))
          (catch Throwable e
            (print-stacktrace e)
            (when (fatal? e) (System/exit 1))))))
    0 (InetAddress/getByName &quot;localhost&quot;)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.task" name="cake.task"><h1 class="project-name">cake.task</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.task
  (:use cake
        [clojure.set :only [difference]]
        [bake.core :only [print-stacktrace log verbose?]]
        [cake.file :only [file newer? touch]]
        [useful.utils :only [verify adjoin]]
        [useful.map :only [update]]
        [uncle.core :only [*task-name*]]
        [clojure.java.io :only [writer]]
        [clojure.contrib.prxml :only [*prxml-indent* prxml]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(declare tasks)
(declare run?)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def implicit-tasks
  {'upgrade  [&quot;Upgrade cake to the most current version.&quot;]
   'ps       [&quot;List running cake jvm processes for all projects.&quot;]
   'log      [&quot;Tail the cake log file. Optionally pass the number of lines of history to show.&quot;]
   'kill     [&quot;Kill running cake jvm processes. Use -9 to force.&quot;]
   'killall  [&quot;Kill all running cake jvm processes for all projects.&quot;]
   'console  [&quot;Open a jconsole connection to the cake jvm. Optionally pass the number of tiled windows.&quot;]})</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn parse-task-opts [forms]
  (let [[deps forms] (if (set? (first forms))
                      [(first forms) (rest forms)]
                      [#{} forms])
        deps (set (map #(if-not (symbol? %) (eval %) %) deps))
        [docs forms] (split-with string? forms)
        [destruct forms] (if (map? (first forms))
                           [(first forms) (rest forms)]
                           [{} forms])
        [pred forms] (if (= :when (first forms))
                       `[~(second forms) ~(drop 2 forms)]
                       [true forms])]
    {:deps (list `quote deps) :docs (vec docs) :actions forms :destruct destruct :pred pred}))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn append-task! [name task]
  (let [tasks-var (or (resolve 'task-defs)
                      (intern *ns* 'task-defs (atom {})))]
    (swap! @tasks-var update name adjoin task)))</pre></tr><tr><td class="docs"><p>Converts a vector of the form [prefix sym1 sym1] to (prefix.sym1 prefix.sym2)</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- expand-prefix
  [ns]
  (if (sequential? ns)
    (map #(symbol (str (name (first ns)) &quot;.&quot; (name %)))
         (rest ns))
    (list ns)))</pre></tr><tr><td class="docs"><p>Require all the specified namespaces and add them to the list of task namespaces.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro require-tasks!
  [namespaces]
  (let [namespaces (mapcat expand-prefix namespaces)]
    `(do (defonce ~'required-tasks (atom []))
         (apply require '~namespaces)
         (swap! ~'required-tasks into '~namespaces))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- resolve-var [ns sym]
  (when-let [ns (find-ns ns)]
    (when-let [var (ns-resolve ns sym)]
      @@var)))</pre></tr><tr><td class="docs"><p>Returns all required task namespaces for the given namespace (including transitive requirements).</p>
</td><td class="codes" /><pre class="brush: clojure">(defn task-namespaces
  [namespace]
  (try (require namespace)
       (catch java.io.FileNotFoundException e
         (when (and (not= 'tasks namespace)
                    (not= &quot;deps&quot; (first *args*)))
           (println &quot;warning: unable to find tasks namespace&quot; namespace)
           (println &quot;  if you've added a new plugin to :dev-dependencies you must run 'cake deps' to install it&quot;))))
  (into [namespace]
        (mapcat task-namespaces
                (resolve-var namespace 'required-tasks))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn default-tasks []
  (if (= &quot;global&quot; (:artifact-id *project*))
    '[cake.tasks.global  tasks]
    '[cake.tasks.default tasks]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn combine-task [task1 task2]
  (when-not (= {:replace true} task2)
    (let [task1 (or (when-not (:replace task2) task1)
                    {:actions [] :docs [] :deps #{}})]
      (adjoin (update task1 :deps difference (:remove-deps task2))
              (select-keys task2 [:actions :docs :deps])))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-tasks []
  (reduce
   (fn [tasks ns]
     (if-let [ns-tasks (resolve-var ns 'task-defs)]
       (merge-with combine-task tasks ns-tasks)
       tasks))
   {}
   (mapcat task-namespaces
           (into (default-tasks) (:tasks *project*)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn task-run-file [taskname]
  (file &quot;.cake&quot; &quot;run&quot; taskname))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn run-file-task? [target-file deps]
  (let [{file-deps true task-deps false} (group-by string? deps)]
    (or (not (.exists target-file))
        (some #(newer? % target-file)
              (into file-deps
                    (map #(task-run-file %)
                         task-deps)))
        (empty? deps))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- expand-defile-path [path]
  (file (.replaceAll path &quot;\\+context\\+&quot; (str (:context *project*)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmulti generate-file
  (fn [forms]
    (let [parts (-&gt; *File* (.toString) (.split &quot;\\.&quot;))]
      (when (&lt; 1 (count parts))
        (-&gt; parts last keyword)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro with-outfile [&amp; forms]
  `(with-open [f# (writer *File*)]
     (binding [*out* f#]
       ~@forms)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod generate-file nil
  [forms]
  (with-outfile
    (doseq [form forms]
      (println form))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod generate-file :clj
  [forms]
  (with-outfile
    (doseq [form forms]
      (prn form)
      (println))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod generate-file :xml
  [forms]
  (with-outfile
    (binding [*prxml-indent* 2]
      (prxml forms))
    (println)))</pre></tr><tr><td class="docs"><p>Execute task actions in order. Construct file output if task is a defile</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- run-actions
  [task]
  (let [results (doall (for [action (:actions task) :when action]
                         (action *opts*)))]
    (when *File*
      (when-let [output (seq (remove nil? results))]
        (log &quot;generating file&quot;)
        (generate-file output)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro without-circular-deps [taskname &amp; forms]
  `(do (verify (not= :in-progress (run? ~taskname))
               (str &quot;circular dependency found in task: &quot; ~taskname))
       (when-not (run? ~taskname)
         (set! run? (assoc run? ~taskname :in-progress))
         ~@forms
         (set! run? (assoc run? ~taskname true)))))</pre></tr><tr><td class="docs"><p>Execute the specified task after executing all prerequisite tasks.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn run-task
  [taskname]
  (if-not (bound? #'tasks)
    ;; create the tasks and run? bindings if it hasn't been done yet.
    (binding [tasks (get-tasks)
              run?  {}]
      (run-task taskname))
    (let [task (get tasks taskname)]
      (if (and (nil? task)
               (not (string? taskname)))
        (println &quot;unknown task:&quot; taskname)
        (without-circular-deps taskname
          (doseq [dep (:deps task)] (run-task dep)) ;; run dependencies
          (binding [*current-task* taskname
                    *task-name*    (name taskname)
                    *File* (if-not (symbol? taskname) (expand-defile-path taskname))]
            (when (verbose?)
              (log &quot;Starting...&quot;))
            (run-actions task))
          (when (symbol? taskname)
            (touch (task-run-file taskname) :verbose false)))))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.bake" name="cake.tasks.bake"><h1 class="project-name">cake.tasks.bake</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.bake
  (:use cake.core
        [useful.compress :only [unsmash]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask eat
  (while (not (.ready *in*))
    (println &quot;the cake is a lie.&quot;)
    (Thread/sleep 300)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask bake
  (println (unsmash &quot;eJyVlL2ugzAMhXeewgNSB5BXIiSUJQuDk52H4dmv7fTy40CgVtWGxP56fOK2gdtAIsLm/hwwEdXO\nAYh8NWHlr6gCAPlVEzERMcRdl44L/cd4z9Dyjnvd69K3KnTIEXnBh+Ntt+yUw4xKapvrUaXLGYLW\no5xqWAgXRIAPl27P2rXYrxBRwwv0tMcBwvRJ5fGb25roF4IvopUPDiATJwjNnIFZZ14JC9usJOmO\nBQxHQsit45aZCVFN4YWz1dmhmc6QbBouh8SgzNXWexWIZS/h8pIK9VGnC9K+8wQxCJfnM967+gDJ\n99tZYetp5CuQWQeluFcnBvZvlKAq8BYgl4/hpbEcbQmAk6wfjZXGEAez+QtEHqvzXgGs4knR0ovi\nXlQXY/5iMkdb408/zWfD4vFP5argkN/Y/QnxIrX4r/sM5kKG5g8YvTMj&quot;)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.check" name="cake.tasks.check"><h1 class="project-name">cake.tasks.check</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Check syntax and warn on reflection.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.check
  (:use cake
        cake.core
        [cake.file :only [file rmdir]]
        [cake.project :only [reset-classloaders!]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask check #{compile-java}
  &quot;Check syntax and warn on reflection.&quot;
  (reset-classloaders!)
  (bake (:use [bake.core :only [log print-stacktrace]]
              [bake.find-namespaces :only [find-clojure-sources-in-dir
                                           read-file-ns-decl]]
              [bake.nsdeps :only [deps-from-ns-decl]]) []
              (binding [*warn-on-reflection* true]
                (doseq [src-file (mapcat #(find-clojure-sources-in-dir
                                           (java.io.File. %))
                                         (:source-path *project*))]
                  (let [depends-on-cake-core?
                        (fn [ns-decl]
                          (contains? (deps-from-ns-decl ns-decl) 'cake.core))
                        src-file-ns-decl (read-file-ns-decl src-file)]
                    ;; Skip any namespaces that depend on cake.core, as they
                    ;; will fail.
                    (if (not (depends-on-cake-core? src-file-ns-decl))
                      (do (log &quot;Compiling namespace &quot; (second src-file-ns-decl))
                          (try
                            (load-file (.getPath src-file))
                            (catch ExceptionInInitializerError e
                              (print-stacktrace e))))
                      (do
                        (log &quot;Skipping namespace &quot; (second src-file-ns-decl))
                        (log &quot;  Reason: Dependency on cake.core&quot;)))))))
  (reset-classloaders!))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.classpath" name="cake.tasks.classpath"><h1 class="project-name">cake.tasks.classpath</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.classpath
  (:use [cake :only [*classloader*]]
        [cake.core :only [deftask]]
        [classlojure :only [get-classpath base-classloader]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask classpath
  &quot;Print the classpath for the cake and project classloaders.&quot;
  (println &quot;\ncake classpath:&quot;)
  (doseq [path (get-classpath base-classloader)]
    (println &quot; &quot; path))
  (println &quot;\nproject classpath:&quot;)
  (doseq [path (get-classpath *classloader*)]
    (println &quot; &quot; path))
  (println))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.clojars" name="cake.tasks.clojars"><h1 class="project-name">cake.tasks.clojars</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.clojars
  (:require [clojure.string :as s]
            [clojure.java.io :as io])
  (:use cake cake.core [bake.core :only [log]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def clojars-repo-url &quot;http://clojars.org/repo&quot;)
(def clojars-all-jars-url (str clojars-repo-url &quot;/all-jars.clj&quot;))
(def clojars-all-poms-url (str clojars-repo-url &quot;/all-poms.txt&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn http-get-text-seq [url] (line-seq (io/reader url)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-latest-version [library-name]
  (let [response (http-get-text-seq clojars-all-jars-url)
        lib-name (symbol library-name)]
    (second (last (filter #(= (first %) lib-name)
                          (for [line response]
                            (read-string line)))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn install
  ([library-name dev]
     (if-let [version (get-latest-version library-name)]
       (install library-name version dev)
       (println &quot;Can't find version of&quot; library-name &quot;on clojars.org\r\n&quot;
                &quot;If the library is in another repository, please provide a version argument.&quot;)))
  ([library-name library-version dev]
     (let [s-to (if dev #{&quot;:dev-deps&quot; &quot;:dev-dependencies&quot;} #{&quot;:dependencies&quot; &quot;:deps&quot;})
           project (line-seq (io/reader &quot;project.clj&quot;))]
       (if-let [dep-line (some
                          (fn [x] (and (some #(re-find (re-pattern %) x) s-to) x))
                          project)]
         (let [to (some s-to (.split dep-line &quot; &quot;))
               pad (and dep-line (-&gt; dep-line (s/split #&quot;\[&quot; 2) first count inc))]
           (spit &quot;project.clj&quot;
                 (s/replace (slurp &quot;project.clj&quot;)
                            (re-pattern (str to &quot;\\s*\\[&quot;))
                            (str to &quot; [[&quot; library-name
                                 &quot; \ library-version &quot;\&quot;]&quot;
                                 (when-not (re-find #&quot;\[\]&quot; dep-line)
                                   (str &quot;\n&quot; (s/join (repeat pad &quot; &quot;)))))))
           (log &quot;Added&quot; library-name library-version &quot;to your&quot; (str to &quot;.&quot;)))
         (println &quot;Neither&quot; (first s-to) &quot;nor&quot; (last s-to) &quot;were found in your project.clj.&quot;)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn search [terms]
  (let [response (http-get-text-seq clojars-all-jars-url)]
    (apply println &quot;\nLibraries on Clojars.org that contain: &quot; terms)
    (println &quot;--------------------------------------------------------------------------------&quot;)
    (doseq [entry (for [line response :when (every? #(.contains line %) terms)]
                    (read-string line))]
      (println &quot;  &quot; (first entry) &quot;  &quot; (second entry)))
    (println)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-pom-dir
  ([library-name version]
     (let [id-str (if (.contains library-name &quot;/&quot;)
                    (str &quot;./&quot; library-name &quot;/&quot; version &quot;/&quot;)
                    (str &quot;./&quot; library-name &quot;/&quot; library-name &quot;/&quot; version &quot;/&quot;))]
       id-str)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-pom-locations
  ([library-name version]
     (let [response (http-get-text-seq clojars-all-poms-url)
           pom-dir (get-pom-dir library-name version)]
       (for [line response :when (.startsWith line pom-dir)]
         line))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-latest-pom-location
  ([library-name version]
     (last (get-pom-locations library-name version))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn to-clojars-url
  ([file-location]
     (str clojars-repo-url &quot;/&quot; file-location)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-latest-pom-file
  ([library-name version]
     (http-get-text-seq (to-clojars-url (get-latest-pom-location library-name version)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn extract-description-text [xml]
  (when-let [desc (re-find (re-pattern (str &quot;&lt;description&gt;(.*)&lt;/description&gt;&quot;)) xml)]
    (second desc)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn description-text [xml-seq]
  (-&gt; (apply str (for [line xml-seq :when (.contains line &quot;&lt;description&gt;&quot;)]
                   line))
      (extract-description-text)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn get-library-dependencies
  [library-name version]
  (let [pom-xml (clojure.xml/parse
                 (java.io.ByteArrayInputStream.
                  (.getBytes (apply str (get-latest-pom-file library-name version)))))
        deps-xml (filter #(= (:tag %) :dependencies) (:content pom-xml))
        deps-seq (partition 3 (for [x (xml-seq deps-xml)
                                    :when (or (= (:tag x) :artifactId)
                                              (= (:tag x) :groupId)
                                              (= (:tag x) :version))]
                                (hash-map (:tag x) (first (:content x)))))]
    (into #{} (for [v deps-seq] (apply merge v)))
    (map :content (:content (first deps-xml)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn print-dependencies
  [library-name version]
  (println (str &quot;Dependencies for: &quot; library-name &quot;  &quot; version))
  (println &quot;--------------------------------------------------------------------------------&quot;)
  (doseq [d (get-library-dependencies library-name version)]
    (let [dep (apply merge (map #(hash-map (:tag %) (first (:content %))) d))]
      (println (str (:groupId dep) &quot;/&quot; (:artifactId dep) &quot;  &quot; (:version dep))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn print-description
  [library-name version]
  (let [pom-xml-seq (get-latest-pom-file library-name version)
        desc-text   (description-text pom-xml-seq)]
    (println (str &quot;Description for library: &quot; library-name &quot;  &quot; version))
    (println &quot;--------------------------------------------------------------------------------&quot;)
    (println desc-text)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn print-all-versions [library-name]
  (let [response (http-get-text-seq clojars-all-jars-url)]
    (println &quot;Available versions for library: &quot; library-name)
    (println &quot;--------------------------------------------------------------------------------&quot;)
    (doseq [entry (filter #(= (first %) (symbol library-name))
                          (for [line response]
                            (read-string line)))]
      (println &quot;  &quot; (first entry) &quot;  &quot; (second entry)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn describe
  ([library-name]
     (describe library-name (get-latest-version library-name)))
  ([library-name version]
     (println)
     (print-description  library-name version) (println)
     (print-dependencies library-name version) (println)
     (print-all-versions library-name)         (println)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask describe
  &quot;Describe a library on clojars.&quot;
  {[library-name version] :describe}
  (if (nil? library-name)
    (println &quot;Usage: cake describe &lt;library-name&gt;&quot;)
    (if version
      (describe library-name version)
      (describe library-name))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask search
  &quot;Search clojars.org for libraries.&quot;
  {terms :search}
  (if (nil? terms)
    (println &quot;Usage: cake search &lt;terms&gt;&quot;)
    (search terms)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask add
  &quot;Install a library from into your project.&quot;
  &quot;The library will be added to the :deps or :dependencies vector in your project.clj.
   If you pass the --dev option, it'll be added to :dev-deps or :dev-dependencies.&quot;
  {[library-name version] :add [dev] :dev}
  (if (nil? library-name)
    (println &quot;Usage: cake add &lt;library-name&gt; [version] [--dev]&quot;)
    (if version
      (install library-name version dev)
      (install library-name dev))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.compile" name="cake.tasks.compile"><h1 class="project-name">cake.tasks.compile</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.compile
  (:use cake
        [cake.core :only [deftask bake invoke]]
        [uncle.core :only [ant add-fileset fileset-seq]]
        [cake.file :only [file newer? mkdir file-exists?]]
        [cake.project :only [reset-classloaders! with-classloader classpath]]
        [bake.core :only [verbose? debug? log os-name os-arch]]
        [cake.utils :only [sudo prompt-read]]
        [useful.string :only [pluralize]])
  (:import [org.apache.tools.ant.taskdefs Copy Javac Java]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(declare copy-native)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn compile-java [src &amp; [dest]]
  (let [src   (if (coll? src) src [src])
        start (System/currentTimeMillis)
        dest  (file (or dest (first (:compile-path *project*))))]
    (when-let [src (seq (filter file-exists? src))]
      (ant Javac (merge {:destdir     dest
                         :classpath   (classpath)
                         :srcdir      (filter file-exists? src)
                         :fork        true
                         :verbose     (verbose?)
                         :debug       true
                         :debug-level &quot;source,lines&quot;
                         :target      &quot;1.5&quot;
                         :failonerror true}
                        (:java-compile *project*)))
      (when (some #(newer? % start) (file-seq dest))
        (reset-classloaders!)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask compile-java #{compile-native}
  (copy-native)
  (compile-java (:source-path *project*)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn compile-clojure [source-path compile-path namespaces]
  (mkdir compile-path)
  (bake (:use [bake.compile :only [compile-stale]])
    [source-path  source-path
     compile-path compile-path
     namespaces   namespaces]
    (compile-stale source-path compile-path namespaces)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn copy-native []
  (let [os-name (os-name)
        os-arch (os-arch)]
    (ant Copy {:todir (format &quot;native/%s/%s&quot; os-name os-arch)}
         (add-fileset {:dir (format &quot;build/native/%s/%s/lib&quot; os-name os-arch)}))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask compile #{compile-native compile-java}
  &quot;Compile all clojure and java source files. Use 'cake compile force' to recompile.&quot;
  (when (= &quot;force&quot; (first (:compile *opts*)))
    (invoke clean {}))
  (let [jar-classes (file &quot;build&quot; &quot;jar&quot;)]
    (mkdir jar-classes)
    (with-classloader [jar-classes]
      (compile-clojure (:source-path *project*) (first (:compile-path      *project*)) (:aot      *project*))
      (compile-clojure (:test-path   *project*) (first (:test-compile-path *project*)) (:aot-test *project*))
      (compile-clojure (:source-path *project*) (.getPath jar-classes)                 [(:main *project*)]))))</pre></tr><tr><td class="docs"><p>add actions to compile-native if you need to compile native libraries
see http://github.com/flatland/tokyocabinet for an example</p>
</td><td class="codes" /><pre class="brush: clojure">(deftask compile-native)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask install-native #{compile-native}
  (copy-native)
  (let [files (vec (map str (fileset-seq {:dir (file (:library-path *project*)
                                                     &quot;native&quot;)
                                          :includes &quot;*&quot;})))
        default &quot;/usr/lib/java/&quot;
        dest (prompt-read (format &quot;java.library.path [%s]:&quot; default))
        dest (if (=  dest) default dest)]
    (apply sudo &quot;cp&quot; (conj files dest))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.coverage" name="cake.tasks.coverage"><h1 class="project-name">cake.tasks.coverage</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.coverage
  (:use cake [cake.core :rename {bake core-bake}]
        [cake.file :only [file]]
        [useful.debug :only [?]]
        [clojure.tools.namespace :only [find-namespaces-in-dir
                                        find-clojure-sources-in-dir]]
        [clojure.java.io :only [reader]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def fake-bake false)
(defmacro bake [&amp; args]
  (if fake-bake
    (last args)
    `(core-bake ~@args)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn testable-namespaces []
  (mapcat (fn [dir]
            (find-namespaces-in-dir (java.io.File. dir)))
          (:source-path *project*)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn testable-symbols [namespaces]
  (bake [namespaces namespaces]
    (letfn [(test? [var] (not (-&gt; var meta :dont-test)))]
      (for [n namespaces
            :let [n (find-ns (doto n require))]
            :when (test? n)
            [sym var] (ns-publics n)
            :when (and (bound? var) (fn? @var) (test? var))]
        (apply symbol (map str [n sym]))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn clj-test-files []
  (apply concat (map (comp find-clojure-sources-in-dir file)
                     (:test-path *project*))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(let [end (Object.)]
  (defn read-all [reader]
    (try (doall
          (take-while (complement #{end})
                      (repeatedly #(read reader false end))))
         (catch Throwable _))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn used-symbols [file]
  (-&gt;&gt; (read-all (java.io.PushbackReader. (reader file)))
       flatten
       (filter symbol?)
       (map (comp symbol name)))) ;; strip namespace - too hard to do right</pre></tr><tr><td class="docs"><p>strip namespace - too hard to do right</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn un-tested-symbols [testables]
  (let [tested (set (mapcat used-symbols (clj-test-files)))
        untested (remove (comp tested symbol name) testables)]
    (into {} (for [[ns syms] (group-by namespace untested)]
               [ns (map name syms)]))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask coverage
  (let [testables (testable-symbols (testable-namespaces))
        needed-additions (not-empty (un-tested-symbols testables))
        untested-count (count (mapcat val needed-additions))
        tested-ratio (- 1 (/ untested-count (count testables)))
        [encouragement invert?] (cond
                       (= 1 tested-ratio)    [&quot;Great!&quot;]
                       (&lt;= 1/2 tested-ratio) [&quot;Almost done...&quot; true]
                       (zero? tested-ratio)  [&quot;Get to work!&quot;]
                       :else                 [&quot;Keep it up!&quot;])
        [fmt ratio] (if invert?
                      [&quot;still need tests.&quot; (- 1 tested-ratio)]
                      [&quot;are tested!&quot; tested-ratio])
        fmt (str &quot;%n%n%2.0f%% of public functions &quot; fmt &quot; &quot; encouragement)]
    (when needed-additions
      (print &quot;The following functions appear to be untested:&quot;)
      (let [width (apply max (map #(.length (key %)) needed-additions))
            fmt (str &quot;%n  %&quot; width &quot;s:&quot;)]
        (doseq [[ns syms] needed-additions]
          (print (format fmt ns))
          (doseq [s syms] (print (str &quot; &quot; s))))))
    (println (format fmt (* 100.0 ratio)))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.default" name="cake.tasks.default"><h1 class="project-name">cake.tasks.default</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.default
  (:use cake.core))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(require-tasks [cake.tasks help jar test ng compile deps release swank file
                version eval bake check clojars docs classpath coverage])</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask default #{help})</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.deps" name="cake.tasks.deps"><h1 class="project-name">cake.tasks.deps</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.deps
  (:use [cake :only [*opts* *project*]]
        [bake.core :only [log]]
        [cake.core :only [deftask defile]]
        [cake.tasks.jar :only [jarfile]]
        [cake.deps :only [clear-deps! fetch-deps! *overwrite* print-deps]]
        [cake.project :only [reset-classloaders!]]
        [depot.deps :only [publish]]
        [depot.pom :only [prxml-tags]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defile &quot;pom.xml&quot; #{&quot;project.clj&quot;}
  (prxml-tags :project *project*))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask deps
  &quot;Fetch dependencies specified in project.clj.&quot;
  (when (= &quot;force&quot; (first (:deps *opts*)))
    (clear-deps!))
  (binding [*overwrite* true]
    (fetch-deps!))
  (print-deps)
  (reset-classloaders!))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask update #{deps}
  &quot;Update cake plugins and restart the persistent JVM.&quot;
  (System/exit 0))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask pom #{&quot;pom.xml&quot;})</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask install #{jar pom}
  &quot;Install jar to local repository.&quot;
  (let [jar (jarfile)]
    (log &quot;Copying&quot; jar &quot;to local repository&quot;)
    (publish *project* jar &quot;pom.xml&quot;)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.docs" name="cake.tasks.docs"><h1 class="project-name">cake.tasks.docs</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.docs
  (:use cake
        [clojure.string :only [join]]
        [bake.core :only [log]]
        (cake [core :only [deftask]]
              [task :only [tasks]])))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask gen-docs #{deps}
  &quot;Generate documentation for tasks.&quot;
  &quot;If a filename is passed, documentation is written to that file. Otherwise,
it is written to tasks.md in the current directory.&quot;
  {[file] :task-docs}
  (let [file (or file &quot;tasks.md&quot;)]
    (log (str &quot;Generating documentation in &quot; file &quot;.&quot;))
    (spit
     file
     (join
      (for [[k {:keys [docs deps]}] tasks]
        (str &quot;#### &quot; k &quot;\n\n&quot;
             (when (seq docs) (str (join &quot;\n&quot; docs) &quot;\n\n&quot;))
             (when (seq deps) (str &quot;dependencies: &quot; deps &quot;\n\n&quot;))))))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.eval" name="cake.tasks.eval"><h1 class="project-name">cake.tasks.eval</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.eval
  (:use cake
        [cake.core :only [deftask bake]]
        [cake.file :only [with-root file]]
        [cake.utils :only [*readline-marker*]]
        [bake.repl :only [repl]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- read-form [string]
  (let [form (if (= &quot;-&quot; string)
               (read)
               (read-string string))]
    (if (:q *opts*)
      form
      (list 'prn form))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask eval #{compile-java}
  &quot;Eval the given forms in the project JVM.&quot;
  &quot;Read a form from stdin for each - provided.&quot;
  {forms :eval}
  (bake [forms (map read-form forms)]
        (eval `(do ~@forms))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask filter #{compile-java}
  &quot;Thread each line in stdin through the given forms, printing the results.&quot;
  &quot;The line is passed as a string with a trailing newline, and println is called with the result of the final form.&quot;
  {forms :filter}
  (bake (:use [clojure.java.io :only [reader]])
        [forms (map read-string forms)]
        (doseq [line (line-seq (reader *in*))]
          (spit &quot;/tmp/foo&quot; (prn-str `(-&gt; ~line ~@forms println)))
          (eval `(-&gt; ~line ~@forms println)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask run #{compile-java}
  &quot;Execute a script in the project jvm.&quot;
  {[script] :run}
  (bake [script (with-root *pwd* (str (file script)))
         args   (rest (drop-while (partial not= script) *args*))]
        (binding [*command-line-args* args]
          (load-file script))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask repl #{compile-java}
  &quot;Start an interactive shell with history and tab completion.&quot;
  {cake? :cake}
  (if cake?
    (repl *readline-marker*)
    (bake (:use bake.repl) [marker *readline-marker*]
          (repl marker))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.file" name="cake.tasks.file"><h1 class="project-name">cake.tasks.file</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.file
  (:use cake
        [cake.core :only [deftask]]
        [cake.task :only [run-task]]
        [uncle.core :only [ant add-fileset]]
        [cake.project :only [reset-classloaders!]]
        [cake.file :only [file]]
        [bake.core :only [log]])
  (:import (org.apache.tools.ant.taskdefs Delete Mkdir)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn clean-dir [dir]
  (when (seq (rest (file-seq dir)))
    (log &quot;Deleting&quot; (.getPath dir))
    (ant Delete {:dir dir})
    (.mkdirs dir)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask clean
  &quot;Remove cake build artifacts.&quot;
  (ant Delete {:verbose true}
    (add-fileset {:dir (file &quot;.&quot;) :includes &quot;*.jar&quot;})
    (add-fileset {:dir (file &quot;.&quot;) :includes &quot;*.war&quot;})
    (add-fileset {:dir (file &quot;.cake&quot; &quot;run&quot;) :includes &quot;*&quot;}))
  (doseq [dir [&quot;classes&quot; &quot;build&quot; &quot;test/classes&quot;]]
    (clean-dir (file dir)))
  (when (= [&quot;deps&quot;] (:clean *opts*))
    (clean-dir (file &quot;lib&quot;))
    (ant Delete {:verbose true}
      (add-fileset {:dir (file &quot;.&quot;) :includes &quot;pom.xml&quot;})))
  (reset-classloaders!))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask file
  &quot;Invoke a file task.&quot;
  (run-task (first (:file *opts*))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.global" name="cake.tasks.global"><h1 class="project-name">cake.tasks.global</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.global
  (:use cake.core))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(require-tasks [cake.tasks help deps compile swank file version new eval bake])</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask default #{help})</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.help" name="cake.tasks.help"><h1 class="project-name">cake.tasks.help</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.help
  (:use cake
        [cake.core :only [deftask]]
        [cake.task :only [tasks implicit-tasks]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def line &quot;-------------------------------------------&quot;)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn print-task [name deps docs]
  (println line)
  (let [deps (if (seq deps) (cons &quot;=&gt;&quot; deps) deps)]
    (apply println &quot;cake&quot; name deps)
    (doseq [doc docs] (println &quot;  &quot; doc))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def system-tasks #{&quot;ps&quot; &quot;kill&quot; &quot;killall&quot; &quot;log&quot; &quot;upgrade&quot; &quot;console&quot;})
(def hidden-tasks #{&quot;default&quot; &quot;eat&quot; &quot;bake&quot;})</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn taskdocs [pattern]
  (filter
   (fn [[name doc]]
     (and (not (contains? hidden-tasks name))
          (re-find pattern name)
          (or (:a *opts*) doc)))
   (into (for [[t doc] implicit-tasks] [(name t) doc])
         (for [taskname (keys tasks)]
           (let [task (get tasks taskname)]
             [(name taskname) (seq (:docs task))])))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn list-tasks [pattern system?]
  (let [taskdocs (into {} (taskdocs pattern))]
    (when (seq taskdocs)
      (let [width    (apply max (map #(count (first %)) taskdocs))
            taskdoc  (str &quot;cake %-&quot; width &quot;s  ;; %s&quot;)]
        (println line)
        (doseq [[name doc] (sort-by first taskdocs)]
          (when-not (system-tasks name)
            (println (format taskdoc name (or (first doc) )))))
        (when system?
          (println)
          (println &quot;-- system tasks ---------------------------&quot;)
          (doseq [name (sort system-tasks)]
            (println (format taskdoc name (first (taskdocs name))))))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn task-doc [&amp; task-names]
  (doseq [name task-names :let [sym (symbol name)]]
    (if-let [task (get tasks sym)]
      (print-task name (:deps task) (:docs task))
      (if-let [doc (implicit-tasks sym)]
        (print-task name [] doc)))
    (list-tasks (re-pattern name) false)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask help
  &quot;Print tasks with documentation. Use 'cake help TASK' for more details.&quot;
  &quot;Use -s to list system tasks and -a to list all tasks, including those without documentation.&quot;
  (if-let [tasks (:help *opts*)]
    (apply task-doc tasks)
    (list-tasks #&quot;^[^.]*$&quot; true)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.jar" name="cake.tasks.jar"><h1 class="project-name">cake.tasks.jar</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.jar
  (:use cake cake.core cake.file uncle.core
        [cake.deps :only [deps]]
        [bake.core :only [current-context log project-with-context]]
        [clojure.java.io :only [copy writer]]
        [clojure.string :only [join]]
        [useful.utils :only [verify]]
        [useful.map :only [into-map]])
  (:require [clojure.xml :as xml])
  (:import [org.apache.tools.ant.taskdefs Jar War Copy Delete Chmod Replace]
           [org.apache.tools.ant.types FileSet ZipFileSet]
           [org.codehaus.plexus.logging.console ConsoleLogger]
           [org.apache.maven.artifact.ant InstallTask Pom]
           [java.io File FileOutputStream]
           [java.util.jar JarFile]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn artifact [name-key ext]
  (file (str (name-key *project*)
             (when-let [context (current-context)]
               (str &quot;-&quot; context))
             ext)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn jarfile [] (artifact :jar-name &quot;.jar&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn manifest []
  (merge (:manifest *project*)
         {&quot;Created-By&quot; &quot;cake&quot;
          &quot;Built-By&quot;   (System/getProperty &quot;user.name&quot;)
          &quot;Build-Jdk&quot;  (System/getProperty &quot;java.version&quot;)
          &quot;Class-Path&quot; (:jar-classpath *project*)
          &quot;Main-Class&quot; (when-let [main (:main *project*)]
                         (-&gt; main str (.replaceAll &quot;-&quot; &quot;_&quot;)))}))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-license [task]
  (add-fileset task {:file (file &quot;LICENSE&quot;)}))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- file-mapping [from to]
  (let [from (file from)]
    (when (.exists from)
      (if (.isDirectory from)
        {:dir from :prefix to :includes &quot;**/*&quot;}
        {:file from :fullpath to}))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-file-mappings [task mappings]
  (doseq [m mappings]
    (cond (map?    m) (add-zipfileset task m)
          (string? m) (add-zipfileset task (file-mapping m m))
          (vector? m) (add-zipfileset task (apply file-mapping m)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn bakepath [&amp; opts]
  (let [bakepath (System/getProperty &quot;bake.path&quot;)]
    (merge (into-map opts)
           (if (.endsWith bakepath &quot;.jar&quot;)
             {:src bakepath}
             {:dir bakepath}))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-path [task path-name &amp; [opts]]
  (doseq [path (*project* path-name)]
    (add-zipfileset task (assoc opts :dir path))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-source-files [task &amp; [opts]]
  (when-not (:omit-source *project*)
    (add-path task :source-path (assoc opts :includes &quot;**/*.clj, **/*.java&quot;)))
  (when (:bake *project*)
    (add-zipfileset task (bakepath opts :excludes &quot;cake.clj&quot;))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn build-context []
  (ant Copy {:todir &quot;build/jar&quot; :overwrite true}
       (add-zipfileset (bakepath :includes &quot;cake.clj&quot;)))
  (let [cake-clj &quot;build/jar/cake.clj&quot;
        context (current-context)
        project (project-with-context context)]
    (ant Replace {:file cake-clj :token &quot;(comment project)&quot; :value (pr-str `(quote ~project))})
    (when (nil? context)
      (ant Replace {:file cake-clj :token &quot;(comment context)&quot; :value (pr-str `(quote ~*context*))}))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn build-jar []
  (let [maven (format &quot;META-INF/maven/%s/%s&quot; (:group-id *project*) (:artifact-id *project*))
        cake  (format &quot;META-INF/cake/%s/%s&quot;  (:group-id *project*) (:artifact-id *project*))]
    (when (:bake *project*)
      (build-context))
    (ant Jar {:dest-file (jarfile)}
      (add-manifest (manifest))
      (add-license)
      (add-source-files)
      (add-path :compile-path {:includes &quot;**/*.class&quot;})
      (add-path :resources-path)
      (add-zipfileset {:dir (file &quot;.&quot;) :prefix maven  :includes &quot;pom.xml&quot;})
      (add-zipfileset {:dir (file &quot;.&quot;) :prefix cake   :includes &quot;*.clj&quot;})
      (add-fileset    {:dir (file &quot;build&quot; &quot;jar&quot;)})
      (add-zipfileset {:dir (file &quot;native&quot;) :prefix &quot;native&quot;})
      (add-file-mappings (:jar-files *project*)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn clean [pattern]
  (when (:clean *opts*)
    (ant Delete {:dir (file &quot;.&quot;) :includes pattern})))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask jar #{compile}
  &quot;Build a jar file containing project source and class files.&quot;
  (clean &quot;*.jar&quot;)
  (build-jar))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn uberjarfile [] (artifact :uberjar-name &quot;.jar&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn jars []
  (concat [(jarfile)]
          (deps :dependencies)
          (deps :ext-dependencies)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn plexus-components [jar]
  (let [jarfile (JarFile. jar)]
    (if-let [entry (.getEntry jarfile &quot;META-INF/plexus/components.xml&quot;)]
      (-&gt;&gt; entry (.getInputStream jarfile)
           xml/parse :content (filter #(= :components (:tag %))) first :content))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn merge-plexus-components [jars dest]
  (when-let [components (seq (mapcat plexus-components jars))]
    (.mkdirs (.getParentFile dest))
    (with-open [file (writer dest)]
      (binding [*out* file]
        (xml/emit {:tag &quot;component-set&quot; :content [{:tag &quot;components&quot; :content components}]})
        (flush)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-jar-contents [task jars]
  (doseq [jar jars :let [name (.replace (.getName jar) &quot;.jar&quot; )]]
    (add-zipfileset task {:src jar :excludes &quot;META-INF/**/*, project.clj, LICENSE&quot;})
    (add-zipfileset task {:src jar :includes &quot;META-INF/**/*&quot; :prefix (str &quot;META-INF/&quot; name)})))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn build-uberjar [jarfile jars]
  (let [plexus-components (file &quot;build/uberjar/META-INF/plexus/components.xml&quot;)]
    (merge-plexus-components jars plexus-components)
    (ant Jar {:dest-file jarfile :duplicate &quot;preserve&quot;}
         (add-manifest (manifest))
         (add-jar-contents jars)
         (add-fileset {:dir (file &quot;build&quot; &quot;uberjar&quot;)}))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask uberjar #{jar}
  &quot;Create a standalone jar containing all project dependencies.&quot;
  (build-uberjar (uberjarfile) (jars)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask bin #{uberjar}
  &quot;Create a standalone console executable for your project.&quot;
  &quot;Add :main to your project.clj to specify the namespace that contains your -main function.&quot;
  (if (:main *project*)
    (let [binfile (file (:artifact-id *project*))
          uberjar (uberjarfile)]
      (when (newer? uberjar binfile)
        (log &quot;Creating standalone executable:&quot; (.getPath binfile))
        (with-open [bin (FileOutputStream. binfile)]
          (let [opts (or (get *config* &quot;jvm.opts&quot;) )
                unix (format &quot;:;exec java %s -jar $0 \&quot;$@\&quot;\n&quot; opts)
                dos  (format &quot;@echo off\r\njava %s -jar %%1 \&quot;%%~f0\&quot; %%*\r\ngoto :eof\r\n&quot; opts)]
            (.write bin (.getBytes unix))
            (.write bin (.getBytes dos)))
          (copy uberjar bin))
        (ant Chmod {:file binfile :perm &quot;+x&quot;})))
    (println &quot;Cannot create bin without :main namespace in project.clj&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn warfile [] (artifact :war-name &quot;.war&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn add-web-files [task]
  (doseq [path (:source-path *project*)]
    (add-zipfileset task {:dir path :prefix &quot;WEB-INF&quot; :includes &quot;*web.xml&quot;})
    (add-fileset    task {:dir (file path &quot;html&quot;)})))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn build-war []
  (build-context)
  (ant War {:dest-file (warfile)}
    (add-manifest (manifest))
    (add-license)
    (add-source-files {:prefix &quot;WEB-INF/classes&quot;})
    (add-web-files)
    (add-path :compile-path   {:prefix &quot;WEB-INF/classes&quot; :includes &quot;**/*.class&quot;})
    (add-path :resources-path {:prefix &quot;WEB-INF/classes&quot;})
    (add-zipfileset {:dir (file &quot;build&quot; &quot;jar&quot;)      :prefix &quot;WEB-INF/classes&quot;})
    (add-fileset    {:dir (file &quot;build&quot; &quot;war&quot;)})
    (add-file-mappings (:war-files *project*))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask war #{compile}
  &quot;Create a web archive containing project source and class files.&quot;
  (clean &quot;*.war&quot;)
  (build-war))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask uberwar #{war}
  &quot;Create a web archive containing all project dependencies.&quot;
  (let [task (ant-type War {:dest-file (warfile) :update true})]
    (doseq [jar (jars)]
      (add-zipfileset task {:file jar :prefix &quot;WEB-INF/lib&quot;}))
    (execute task)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.new" name="cake.tasks.new"><h1 class="project-name">cake.tasks.new</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.new
  (:use cake cake.core cake.file uncle.core
        [bake.core :only [log]]
        [cake.project :only [group]]
        [clojure.string :only [join]]
        [clojure.java.io :only [copy]]
        [bake.io :only [extract-resource]])
  (:import [org.apache.tools.ant.taskdefs Copy]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def default-template
&quot;(defproject +project+ \&quot;0.0.1-SNAPSHOT\&quot;
  :description \&quot;TODO: add summary of your project\&quot;
  :dependencies [[clojure \&quot;1.2.0\&quot;]])
&quot;)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def template-dir (file &quot;~&quot; &quot;.cake&quot; &quot;templates&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn rename-files [root project]
  (log &quot;Renaming directories with +project+ in their name&quot;)
  (doseq [old-file (reverse (sort-by (comp count str) (file-seq root)))
          :let [name (.getName old-file)
                replaced (.replace name &quot;+project+&quot; (.replace project &quot;-&quot; &quot;_&quot;))]
          :when (not= name replaced)]
    (.renameTo old-file (file (.getParent old-file) replaced))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn scan-replace-contents [files project]
  (log (str &quot;Replacing +project+ with '&quot; project &quot;' in all files.&quot;))
  (doseq [f (filter #(.isFile %) files)]
    (spit f (.replace (slurp f) &quot;+project+&quot; project))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn template-new [project template]
  (let [root (file *pwd* project)]
    (if (.exists root)
      (println &quot;error:&quot; project &quot;already exists in this directory&quot;)
      (do
        (log (str &quot;Creating a new project based on ~/.cake/templates/&quot; template))
        (ant Copy {:todir root}
          (add-fileset {:dir (str (file template-dir template))}))
        (rename-files root project)
        (scan-replace-contents (file-seq root) project)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn create-template [template]
  (log (str &quot;Creating template directory: ~/.cake/templates/&quot; template))
  (let [template (file template-dir template)]
    (mkdir template)
    (mkdir (file template &quot;src&quot; &quot;+project+&quot;))
    (spit (file template &quot;src&quot; &quot;+project+&quot; &quot;core.clj&quot;) &quot;(ns +project+.core)&quot;)
    (log &quot;Created template file: src/+project+/core.clj&quot;)
    (mkdir (file template &quot;test&quot;))
    (spit (file template &quot;project.clj&quot;) default-template)
    (log &quot;Created template file: project.clj&quot;)
    (spit (file template &quot;.gitignore&quot;)
          (apply str (interleave [&quot;.cake&quot; &quot;pom.xml&quot; &quot;*.jar&quot; &quot;*.war&quot; &quot;lib&quot; &quot;classes&quot; &quot;build&quot; &quot;/+project+&quot;] (repeat &quot;\n&quot;))))
    (log &quot;Created template file: .gitignore&quot;)
    (extract-resource &quot;LICENSE&quot; template)
    (log &quot;Created template LICENSE file (Eclipse Public License)&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask new
  &quot;Create scaffolding for a new project.&quot;
  &quot;You can put project templates in ~/.cake/templates. Each template is a directory with a default
   template. You can specify which template to use for your project when you call this task. If
   you don't specify which template to use, ~/.cake/templates/default will be used. It will be created if
   it does not already exist.
   New project based on the default template:  cake new aproj
   New project based on a specified template:  cake new mytemplate aproj
   New template based on the default template: cake new template mytemplate&quot;
  {[one two] :new}
  (when-not (.exists (file template-dir &quot;default&quot;))
    (create-template &quot;default&quot;))
  (if (and two (= one &quot;template&quot;))
    (create-template two)
    (apply template-new (if two [two one] [one &quot;default&quot;]))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.ng" name="cake.tasks.ng"><h1 class="project-name">cake.tasks.ng</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.ng
  (:use cake cake.core [useful.utils :only [if-ns]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(if-ns (:import vimclojure.nailgun.NGServer)
  (do
    (defn start-ng-server  [host]
      (bake [host host]
            (vimclojure.nailgun.NGServer/main  (into-array [host]))))
    (deftask ng #{compile-java}
      &quot;Start the nailgun server.&quot;
      (start-ng-server &quot;127.0.0.1&quot;))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.release" name="cake.tasks.release"><h1 class="project-name">cake.tasks.release</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.release
  (:use cake cake.core cake.file
        [bake.core :only [verbose? debug? log]]
        [cake.tasks.jar :only [jarfile uberjarfile warfile]]
        [clojure.java.io :only [reader copy]]
        [useful.utils :only [verify]]
        [cake.utils :only [prompt-read]])
  (:import [com.jcraft.jsch JSch ChannelExec Logger UserInfo JSchException UIKeyboardInteractive]
           [java.io FileInputStream]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def *session*      nil)
(def *session-opts* nil)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn keyfiles [identity]
  (if-let [identity (or identity (first (:identity *opts*)))]
    (list (if (.startsWith identity &quot;/&quot;)
            (file identity)
            (file &quot;~/.ssh&quot; identity)))
    (filter #(.exists %)
            (for [id [&quot;id_rsa&quot; &quot;id_dsa&quot; &quot;identity&quot;]]
              (file &quot;~/.ssh&quot; id)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- log-auth [username host keyfile message]
  (when (verbose?)
    (let [auth (if keyfile (.getPath keyfile) &quot;password&quot;)]
      (log (format &quot;Authenticating %s@%s using %s: %s&quot; username host auth message)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- session-connect [{:keys [host port username password passphrase keyfile] :as opts}]
  (let [jsch (JSch.)]
    (JSch/setLogger
     (proxy [Object Logger] []
       (isEnabled [level] (debug?))
       (log [level message] (println message))))
    (when keyfile (.addIdentity jsch (.getPath keyfile)))
    (try (let [username (or username (System/getProperty &quot;user.name&quot;))
               session  (.getSession jsch username host (or port 22))]
           (doto session
             (.setUserInfo
              (proxy [Object UserInfo UIKeyboardInteractive] []
                (getPassword               []    password)
                (getPassphrase             []    passphrase)
                (promptYesNo               [_]   true)
                (promptPassword            [_]   (not (nil? password)))
                (promptPassphrase          [_]   (not (nil? passphrase)))
                (promptKeyboardInteractive [&amp; _] (if password (into-array String [password])))
                (showMessage               [_])))
             (.connect))
           (set! *session-opts* opts)
           (log-auth username host keyfile &quot;Auth success&quot;)
           session)
         (catch JSchException e
           (log-auth username host keyfile (.getMessage e))
           nil))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- prompt-passphrase [keyfile]
  (or (:passphrase *session-opts*)
      (prompt-read (format &quot;Enter passphrase for key '%s'&quot; (.getPath keyfile)) :echo false)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- prompt-password []
  (or (:password *session-opts*)
      (prompt-read &quot;Password&quot; :echo false)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- start-session [{:keys [host port username identity] :as opts}]
  (or (first (remove nil?
        (for [keyfile (keyfiles identity)]
          (let [opts (assoc opts :keyfile keyfile)
                session (session-connect opts)]
            (or session
                (session-connect (assoc opts :passphrase (prompt-passphrase keyfile))))))))
      (session-connect (assoc opts :password (prompt-password)))
      (abort-task (format &quot;unable to start session to %s@%s&quot; username host))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn ssh-session* [opts &amp; commands]
  (let [hosts (or (:hosts opts) [(:host opts)])
        opts  (dissoc opts :hosts)]
    (binding [*session-opts* nil]
      (let [sessions
            (for [host hosts]
              (start-session (assoc opts :host host)))]
        (doseq [command commands, session sessions]
          (binding [*session* session]
            (command)))
        (doseq [session sessions]
          (.disconnect session))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmacro ssh-session [opts &amp; forms]
  `(ssh-session* ~opts ~@(map (partial list 'fn []) forms)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn log-host [&amp; message]
  (apply log (format &quot;[%s]&quot; (.getHost *session*)) message))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn copy-to-log [out]
  (let [out (reader out)]
    (loop []
      (when-let [line (.readLine out)]
        (log-host line)
        (recur)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn ssh-exec [command &amp; [f]]
  (let [channel (.openChannel *session* &quot;exec&quot;)]
    (.setCommand channel command)
    (let [in  (.getInputStream channel)
          out (.getOutputStream channel)
          ext (.getExtInputStream channel)]
      (.connect channel)
      (if f
        (f in out ext)
        (let [ext (reader ext)]
          (log-host command)))
      (.close out)
      (copy-to-log ext)
      (.disconnect channel))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- send-ack [out]
  (.write out (byte-array [(byte 0)]))
  (.flush out))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- wait-for-ack [in]
  (let [code (.read in)]
    (when-not (= 0 code)
      (copy in *outs*)
      (throw (Exception. (case code 1 &quot;scp error&quot; 2 &quot;scp fatal error&quot; -1 &quot;disconnect error&quot; &quot;unknown error&quot;))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn upload
  ([src] (upload src &quot;.&quot;))
  ([src dest]
     (let [src  (if (sequential? src) src [src])
           dest (or dest &quot;.&quot;)]
        (ssh-exec (str &quot;scp -r -d -t &quot; (or dest &quot;.&quot;))
          (fn [in out ext]
            (wait-for-ack in)
            (doseq [f src :let [f (file f)]]
              (log-host &quot;uploading&quot; (.getAbsolutePath f) &quot;to&quot; dest)
              (let [command (format &quot;C0644 %d %s\n&quot; (.length f) (.getName f))]
                (.write out (.getBytes command))
                (.flush out)
                (wait-for-ack in))
              (with-open [fs (FileInputStream. f)]
                (copy fs out :buffer-size 8192))
              (send-ack out)
              (wait-for-ack in)))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- lookup-file [file]
  (case file
    :jar     (jarfile)
    :uberjar (uberjarfile)
    :war     (warfile)
    file))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask release #{jar pom}
  &quot;Release project jar (to clojars by default).&quot;
  (let [release  (:release *project*)
        files    (or (:files    release) [:jar &quot;pom.xml&quot;])
        host     (or (:host     release) &quot;clojars.org&quot;)
        username (or (:username release) &quot;clojars&quot;)
        dest     (or (:dest     release) &quot;.&quot;)]
    (when (#{&quot;y&quot; &quot;Y&quot;} (prompt-read (format &quot;Are you sure you want to release to %s? [y/N]&quot; host)))
      (ssh-session {:host host :username username}
        (upload (map lookup-file files) dest)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask deploy
  &quot;Deploy project to a group of servers.&quot;
  &quot;Add :deploy to defproject or defcontext to enable. Also add any dependencies that need
   to be built before deploy e.g. (deftask deploy #{war}). Supported :deploy keys are:
     :hosts      [host1 host2 host3]
     :port       2222
     :username   \&quot;username\&quot;
     :password   \&quot;password\&quot;
     :identity   \&quot;ssh-public-key\&quot;
     :passphrase \&quot;ssh-key-passphrase\&quot;
     :pre  [\&quot;echo pre-upload commands\&quot;
            \&quot;/etc/init.d/server stop\&quot;]
     :copy [[\&quot;file1\&quot; \&quot;file2\&quot; \&quot;/dest\&quot;]
            [:war \&quot;/another/dest\&quot;]
            [:jar :uberjar \&quot;/home/username\&quot;]]
     :post [\&quot;echo remote commands\&quot;
            \&quot;/etc/init.d/server start\&quot;]
   Optionally, a list of specific nodes to deploy to may be specified, along with a context:
     cake deploy server-001 server-002 @production&quot;
  (if (:deploy *project*)
    (let [deploy  (:deploy *project*)
          nodes   (seq (:deploy *opts*))
          deploy  (if nodes (assoc deploy :hosts nodes) deploy)
          context (:context *project*)]
      (verify deploy (str &quot;no deploy options specified for context&quot; context))
      (log &quot;Deploying to&quot; context)
      (when nodes (log &quot;nodes:&quot; nodes))
      (ssh-session deploy
        (doseq [command (:pre deploy)]
          (ssh-exec command))
        (doseq [files (:copy deploy)]
          (let [dest  (last files)
                files (map lookup-file (butlast files))]
            (upload files dest)))
        (doseq [command (:post deploy)]
          (ssh-exec command))))
    (println &quot;no :deploy key in project.clj&quot;)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.swank" name="cake.tasks.swank"><h1 class="project-name">cake.tasks.swank</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.swank
  (:use cake cake.core
        [useful.utils :only [if-ns]]
        [bake.core :only [current-context]])
  (:import [java.io StringWriter PrintWriter]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def current-port (atom nil))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- serve-swank [context]
  &quot;Run swank connection thread in the project classloader.&quot;
  (fn [socket]
    (bake (:use [bake.core :only [set-context!]])
          (:require swank.swank swank.core.server)
          [socket socket, context context]
          (let [socket-serve     (ns-resolve 'swank.core.server 'socket-serve)
                connection-serve (ns-resolve 'swank.swank 'connection-serve)
                opts {:encoding (or (some #(System/getProperty %)
                                          [&quot;swank.encoding&quot; &quot;file.encoding&quot;])
                                    &quot;UTF-8&quot;)}]
            (eval (:swank-init *project*))
            (set-context! context)
            (socket-serve connection-serve socket opts)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(if-ns (:use [swank.core.server :only [start-swank-socket-server!]]
             [swank.util.net.sockets :only [make-server-socket]])
  (defn start-swank [host]
    (let [[host port] (if (.contains host &quot;:&quot;) (.split host &quot;:&quot;) [&quot;localhost&quot; host])
          out (with-out-str
                (start-swank-socket-server!
                 (make-server-socket {:port (Integer. port) :host host})
                 (serve-swank (current-context)) {}))]
      (if (.contains out &quot;java.net.BindException&quot;)
        (println &quot;unable to start swank-clojure server, port already in use&quot;)
        (do (compare-and-set! current-port nil port)
            (println &quot;started swank-clojure server on port&quot; @current-port)))))
  (defn start-swank [host]
    (println &quot;error loading swank-clojure.&quot;)
    (println &quot;see http://clojure-cake.org/swank for installation instructions&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask swank #{compile-java}
  &quot;Report status of swank server and start it if not running.&quot;
  {[host] :swank}
  (if @current-port
    (println &quot;swank currently running on port&quot; @current-port)
    (start-swank (or host &quot;localhost:4005&quot;))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.test" name="cake.tasks.test"><h1 class="project-name">cake.tasks.test</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.test
  (:use cake cake.core
        [cake.project :only [with-test-classloader]]
        [bake.find-namespaces :only [find-namespaces-in-dir]])
  (:import [java.io File]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn test-opts []
  (let [args (into (:test *opts*) (:autotest *opts*))]
    (if (empty? args)
      {:all true}
      (group-by #(cond (keyword?  %) :tags
                       (namespace %) :functions
                       :else         :namespaces)
                (map read-string args)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn run-project-tests [&amp; opts]
  (with-test-classloader
    (bake (:use bake.test
                [bake.core :only [with-context]])
          [namespaces
           (flatten (for [test-path (:test-path *project*)]
                      (find-namespaces-in-dir (java.io.File. test-path))))
           opts       (merge (test-opts) (apply hash-map opts))]
          (with-context :test
            (run-project-tests namespaces opts)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask test #{compile-java}
  &quot;Run project tests.&quot;
  &quot;Specify which tests to run as arguments like: namespace, namespace/function, or :tag&quot;
  (run-project-tests))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask autotest #{compile-java}
  &quot;Automatically run tests whenever your project code changes.&quot;
  &quot;Specify tests to run just like the test task. Specify the interval with --interval.&quot;
  (run-project-tests)
  (while true
    (run-project-tests :autotest true)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.tasks.version" name="cake.tasks.version"><h1 class="project-name">cake.tasks.version</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.tasks.version
  (:use cake cake.core uncle.core
        [bake.core :only [log]]
        [cake.utils :only [ftime]]
        [useful.map :only [update]]
        [clojure.string :only [join]]
        [cake.utils :only [git]])
  (:import [org.apache.tools.ant.taskdefs Replace]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def version-levels [:major :minor :patch])</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn defline [version]
  (format &quot;(defproject %s \&quot;%s\ (:artifact-id *project*) version))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn version-map [version]
  (let [[version snapshot] (.split version &quot;-&quot;)]
    (into {:snapshot snapshot}
          (map vector
               version-levels
               (map #(Integer/parseInt %)
                    (.split version &quot;\\.&quot;))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn version-str [version]
  (str (join &quot;.&quot; (map #(or (version %) 0) version-levels))
       (when (version :snapshot) &quot;-SNAPSHOT&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn bump
  ([] (bump (version-map (:version *project*))
            (first (filter *opts* version-levels))
            (:snapshot *opts*)))
  ([version level snapshot?]
      (let [snapshot (when-not snapshot? :snapshot)
            level    (or level (when-not (:snapshot version) :patch))
            version  (if snapshot? (assoc version :snapshot true) version)]
        (if level
          (reduce dissoc (update version level inc)
                  (conj (take-while (partial not= level) (reverse version-levels)) snapshot))
          (dissoc version snapshot)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn update-version [action]
  (let [new-version (if (= &quot;bump&quot; action) (version-str (bump)) action)]
    (ant Replace {:file &quot;project.clj&quot;
                  :token (defline (:version *project*))
                  :value (defline new-version)})
    new-version))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask version
  &quot;Display project version. Use 'bump [--major --minor --patch --snapshot]' to increment.&quot;
  (if-let [action (first (:version *opts*))]
    (println (:artifact-id *project*)
             (:version *project*)
             &quot;-&gt;&quot;
             (:artifact-id *project*)
             (update-version action))
    (println (:artifact-id *project*) (:version *project*))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn snapshot? [version]
  (.endsWith version &quot;SNAPSHOT&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn snapshot-timestamp [version]
  (if (snapshot? version)
    (let [t (java.util.Calendar/getInstance)]
      (.replaceAll version &quot;SNAPSHOT&quot; (str (ftime &quot;Ymd&quot; t) &quot;.&quot; (ftime &quot;HMS&quot; t))))
    version))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftask tag
  &quot;Create a git tag for the current version.&quot;
  (let [version (snapshot-timestamp (:version *project*))]
    (git &quot;tag&quot; &quot;-fa&quot; version &quot;-m&quot; (format &quot;'version %s'&quot; version))
    (log &quot;created git tag&quot; version)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.utils.server-socket" name="cake.utils.server-socket"><h1 class="project-name">cake.utils.server-socket</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Copyright (c) Craig McDaniel, Jan 2009. All rights reserved.
The use and distribution terms for this software are covered by the
Eclipse Public License 1.0 (http://opensource.org/licenses/eclipse-1.0.php)
which can be found in the file epl-v10.html at the root of this distribution.
By using this software in any fashion, you are agreeing to be bound by
the terms of this license.
You must not remove this notice, or any other, from this software.</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Server socket library - includes REPL on socket</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>renamed from clojure.contrib.server-socket to avoid conflicts</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns
  #^{:author &quot;Craig McDaniel&quot;
     :doc }
  cake.utils.server-socket
  (:import (java.net InetAddress ServerSocket Socket SocketException)
           (java.io InputStreamReader OutputStream OutputStreamWriter PrintWriter)
           (clojure.lang LineNumberingPushbackReader))
  (:use [clojure.main :only (repl)]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- on-thread [f]
  (doto (Thread. #^Runnable f)
    (.start)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- close-socket [#^Socket s]
  (when-not (.isClosed s)
    (doto s
      (.shutdownInput)
      (.shutdownOutput)
      (.close))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- accept-fn [#^Socket s connections fun]
  (let [ins (.getInputStream s)
        outs (.getOutputStream s)]
    (on-thread #(do
                  (dosync (commute connections conj s))
                  (try
                   (fun ins outs)
                   (catch SocketException e))
                  (close-socket s)
                  (dosync (commute connections disj s))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defstruct server-def :server-socket :connections)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- create-server-aux [fun #^ServerSocket ss]
  (let [connections (ref #{})]
    (on-thread #(when-not (.isClosed ss)
                  (try
                   (accept-fn (.accept ss) connections fun)
                   (catch SocketException e))
                  (recur)))
    (struct-map server-def :server-socket ss :connections connections)))</pre></tr><tr><td class="docs"><p>Creates a server socket on port. Upon accept, a new thread is
  created which calls:</p>

<p>  (fun input-stream output-stream)</p>

<p>  Optional arguments support specifying a listen backlog and binding
  to a specific endpoint.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn create-server
  ([port fun backlog #^InetAddress bind-addr]
     (create-server-aux fun (ServerSocket. port backlog bind-addr)))
  ([port fun backlog]
     (create-server-aux fun (ServerSocket. port backlog)))
  ([port fun]
     (create-server-aux fun (ServerSocket. port))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn close-server [server]
  (doseq [s @(:connections server)]
    (close-socket s))
  (dosync (ref-set (:connections server) #{}))
  (.close #^ServerSocket (:server-socket server)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn connection-count [server]
  (count @(:connections server)))</pre></tr><tr><td class="docs"><p>REPL on a socket</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- socket-repl [ins outs]
  (binding [*in* (LineNumberingPushbackReader. (InputStreamReader. ins))
            *out* (OutputStreamWriter. outs)
            *err* (PrintWriter. #^OutputStream outs true)]
    (repl)))</pre></tr><tr><td class="docs"><p>create a repl on a socket</p>
</td><td class="codes" /><pre class="brush: clojure">(defn create-repl-server
  ([port backlog #^InetAddress bind-addr]
     (create-server port socket-repl backlog bind-addr))
  ([port backlog]
     (create-server port socket-repl backlog))
  ([port]
     (create-server port socket-repl)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#cake.utils" name="cake.utils"><h1 class="project-name">cake.utils</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns cake.utils
  (:use cake
        [cake.file :only [file]]
        [uncle.core :only [ant args argline]]
        [bake.core :only [os-name]])
  (:import (org.apache.tools.ant.taskdefs ExecTask)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def *readline-marker* nil)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn prompt-read [prompt &amp; opts]
  (let [opts (apply hash-map opts)
        echo (if (false? (:echo opts)) &quot;@&quot; )]
    (println (str echo *readline-marker* prompt))
    (read-line)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn sudo [&amp; arglist]
  (let [password (prompt-read &quot;Password&quot; :echo false)
	opts {:dir *root*
	      :input-string (str password &quot;\n&quot;)}]
    (if (= &quot;linux&quot; (os-name))
      (ant ExecTask (assoc opts :executable &quot;script&quot;)
        (argline (apply str &quot;-q -c 'sudo -S &quot;
                        (interpose &quot; &quot; (conj arglist &quot;' /dev/null&quot;)))))
      (ant ExecTask (assoc opts :executable &quot;sudo&quot;)
        (args (apply vector &quot;-S&quot; arglist))))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn cake-exec [&amp; params]
  (ant ExecTask {:executable &quot;ruby&quot; :dir *root* :failonerror true}
    (args *script* params (str &quot;--project=&quot; *root*))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn git [&amp; params]
  (if (.exists (file &quot;.git&quot;))
    (ant ExecTask {:executable &quot;git&quot; :dir *root* :failonerror true}
      (args params))
    (println &quot;warning:&quot; *root* &quot;is not a git repository&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn ftime [string time]
  (format (apply str (map #(str &quot;%1$t&quot; %) string)) time))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr></table><div class="footer">Generated by <a href="https://github.com/fogus/marginalia">Marginalia</a>.&nbsp;&nbsp;Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a><div id="floating-toc"><ul><li class="floating-toc-li" id="floating-toc_cake.core">cake.core</li><li class="floating-toc-li" id="floating-toc_cake.deps">cake.deps</li><li class="floating-toc-li" id="floating-toc_cake.file">cake.file</li><li class="floating-toc-li" id="floating-toc_cake.main">cake.main</li><li class="floating-toc-li" id="floating-toc_cake.project">cake.project</li><li class="floating-toc-li" id="floating-toc_cake.server">cake.server</li><li class="floating-toc-li" id="floating-toc_cake.task">cake.task</li><li class="floating-toc-li" id="floating-toc_cake.tasks.bake">cake.tasks.bake</li><li class="floating-toc-li" id="floating-toc_cake.tasks.check">cake.tasks.check</li><li class="floating-toc-li" id="floating-toc_cake.tasks.classpath">cake.tasks.classpath</li><li class="floating-toc-li" id="floating-toc_cake.tasks.clojars">cake.tasks.clojars</li><li class="floating-toc-li" id="floating-toc_cake.tasks.compile">cake.tasks.compile</li><li class="floating-toc-li" id="floating-toc_cake.tasks.coverage">cake.tasks.coverage</li><li class="floating-toc-li" id="floating-toc_cake.tasks.default">cake.tasks.default</li><li class="floating-toc-li" id="floating-toc_cake.tasks.deps">cake.tasks.deps</li><li class="floating-toc-li" id="floating-toc_cake.tasks.docs">cake.tasks.docs</li><li class="floating-toc-li" id="floating-toc_cake.tasks.eval">cake.tasks.eval</li><li class="floating-toc-li" id="floating-toc_cake.tasks.file">cake.tasks.file</li><li class="floating-toc-li" id="floating-toc_cake.tasks.global">cake.tasks.global</li><li class="floating-toc-li" id="floating-toc_cake.tasks.help">cake.tasks.help</li><li class="floating-toc-li" id="floating-toc_cake.tasks.jar">cake.tasks.jar</li><li class="floating-toc-li" id="floating-toc_cake.tasks.new">cake.tasks.new</li><li class="floating-toc-li" id="floating-toc_cake.tasks.ng">cake.tasks.ng</li><li class="floating-toc-li" id="floating-toc_cake.tasks.release">cake.tasks.release</li><li class="floating-toc-li" id="floating-toc_cake.tasks.swank">cake.tasks.swank</li><li class="floating-toc-li" id="floating-toc_cake.tasks.test">cake.tasks.test</li><li class="floating-toc-li" id="floating-toc_cake.tasks.version">cake.tasks.version</li><li class="floating-toc-li" id="floating-toc_cake.utils.server-socket">cake.utils.server-socket</li><li class="floating-toc-li" id="floating-toc_cake.utils">cake.utils</li></ul></div></div><script type="text/javascript">SyntaxHighlighter.defaults['gutter'] = false;
       SyntaxHighlighter.all()</script></body></html>